<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fennix Userspace: Userspace/apps/base/busybox/networking/tls.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fennix Userspace
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Fennix Userspace Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tls.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (C) 2017 Denys Vlasenko</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Licensed under GPLv2, see file LICENSE in this source tree.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//config:config TLS</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//config:   bool #No description makes it a hidden option</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//config:   default n</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//Note:</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//Config.src also defines FEATURE_TLS_SHA1 option</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls.o</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_pstm.o</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_pstm_montgomery_reduce.o</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_pstm_mul_comba.o</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_pstm_sqr_comba.o</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_aes.o</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_aesgcm.o</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_rsa.o</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_fe.o</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//kbuild:lib-$(CONFIG_TLS) += tls_sp_c32.o</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d79/tls_8h.html">tls.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// Usually enabled. You can disable some of them to force only</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// specific ciphers to be advertized to server.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// (this would not exclude code to handle disabled ciphers, no code size win)</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7f94151579cdfcbc800f105f34eb4002">   28</a></span>&#160;<span class="preprocessor">#define ALLOW_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256       1</span></div>
<div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a152bb318366725ff282862bdb879c4ba">   29</a></span>&#160;<span class="preprocessor">#define ALLOW_ECDHE_RSA_WITH_AES_128_CBC_SHA256         1</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aed3e2cf47e9fb0e450f57fa5ecb66ad4">   30</a></span>&#160;<span class="preprocessor">#define ALLOW_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256       1</span></div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2f3a2adc76a0f9a7727eb21b7f3f0b24">   31</a></span>&#160;<span class="preprocessor">#define ALLOW_ECDHE_RSA_WITH_AES_128_GCM_SHA256         1</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a68e5b663cedb46bb2fe35d546fe8dd29">   32</a></span>&#160;<span class="preprocessor">#define ALLOW_RSA_WITH_AES_128_CBC_SHA256       1</span></div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae6eb035c662d7e6d4a4e0dcf863fec8d">   33</a></span>&#160;<span class="preprocessor">#define ALLOW_RSA_WITH_AES_256_CBC_SHA256       1</span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0681bb67727c2a6f8c87aa71b3ea692f">   34</a></span>&#160;<span class="preprocessor">#define ALLOW_RSA_WITH_AES_128_GCM_SHA256       1</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6a30ed926de7c078a4d0e034eb714a7f">   35</a></span>&#160;<span class="preprocessor">#define ALLOW_CURVE_P256        1</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0ed4142828e820e1aa9bea863a34a288">   36</a></span>&#160;<span class="preprocessor">#define ALLOW_CURVE_X25519      1</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// For testing (does everything except encrypting).</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// works against &quot;openssl s_server -cipher NULL&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// and against wolfssl-3.9.10-stable/examples/server/server.c:</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af60cb3c889da6403866b3087adf587c3">   41</a></span>&#160;<span class="preprocessor">#define ALLOW_RSA_NULL_SHA256                   0</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5ed33eac6dfa25672a289c18fa48322a">   43</a></span>&#160;<span class="preprocessor">#define TLS_DEBUG      0</span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3a9bd59a617b1ab088efb1abb9b9b562">   44</a></span>&#160;<span class="preprocessor">#define TLS_DEBUG_HASH 0</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a48d4d058784c09d5f9acbc395983b7be">   45</a></span>&#160;<span class="preprocessor">#define TLS_DEBUG_DER  0</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a825fce3f42c85c60e76e7e3d5a779cfb">   46</a></span>&#160;<span class="preprocessor">#define TLS_DEBUG_FIXED_SECRETS 0</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor"># define dump_raw_out(...) dump_hex(__VA_ARGS__)</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2a404bab8b6e8c6c7d0a4039dd91b99b">   50</a></span>&#160;<span class="preprocessor"># define dump_raw_out(...) ((void)0)</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor"># define dump_raw_in(...) dump_hex(__VA_ARGS__)</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a333b9382c44248475f73712fea669957">   55</a></span>&#160;<span class="preprocessor"># define dump_raw_in(...) ((void)0)</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#if TLS_DEBUG</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor"># define dbg(...) fprintf(stderr, __VA_ARGS__)</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">   61</a></span>&#160;<span class="preprocessor"># define dbg(...) ((void)0)</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#if TLS_DEBUG_DER</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor"># define dbg_der(...) fprintf(stderr, __VA_ARGS__)</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2b239b202d79a7f1ce309d36d4221d31">   67</a></span>&#160;<span class="preprocessor"># define dbg_der(...) ((void)0)</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">//TLS 1.2</span></div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">   72</a></span>&#160;<span class="preprocessor">#define TLS_MAJ 3</span></div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">   73</a></span>&#160;<span class="preprocessor">#define TLS_MIN 3</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#affdc252da7a09312e24f379b8d1f1330">   75</a></span>&#160;<span class="preprocessor">#define RECORD_TYPE_CHANGE_CIPHER_SPEC  20 </span><span class="comment">/* 0x14 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1220507db99ba87bb7b45b03ec9b9f0b">   76</a></span>&#160;<span class="preprocessor">#define RECORD_TYPE_ALERT               21 </span><span class="comment">/* 0x15 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a222955be70285ace97b0fffa2b082f5d">   77</a></span>&#160;<span class="preprocessor">#define RECORD_TYPE_HANDSHAKE           22 </span><span class="comment">/* 0x16 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6535ec67b879b714910dd2318b2aee41">   78</a></span>&#160;<span class="preprocessor">#define RECORD_TYPE_APPLICATION_DATA    23 </span><span class="comment">/* 0x17 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad3596b319b7da2d60c41a6c38c218a17">   80</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_HELLO_REQUEST         0  </span><span class="comment">/* 0x00 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8dabadc98219d027206899deb1561143">   81</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_CLIENT_HELLO          1  </span><span class="comment">/* 0x01 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a4d11f3d0264027abeb2a55e2a9a3e40b">   82</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_SERVER_HELLO          2  </span><span class="comment">/* 0x02 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad40cbe543a67075c40bbbb2d89262ee1">   83</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_HELLO_VERIFY_REQUEST  3  </span><span class="comment">/* 0x03 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad9e14ddcbd32b90b0a9dee34201e64f9">   84</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_NEW_SESSION_TICKET    4  </span><span class="comment">/* 0x04 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a80578323a028f7c97df09fcf86095374">   85</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_CERTIFICATE           11 </span><span class="comment">/* 0x0b */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a04e8d99b04258c8ba86e7a02aa9c97ee">   86</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_SERVER_KEY_EXCHANGE   12 </span><span class="comment">/* 0x0c */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac9e8bf191ea759b5700441d0a9d807dd">   87</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_CERTIFICATE_REQUEST   13 </span><span class="comment">/* 0x0d */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab20655e202f5053dec1ab4671afb04b2">   88</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_SERVER_HELLO_DONE     14 </span><span class="comment">/* 0x0e */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9a2c367e596da7cc19f7ec10cee60138">   89</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_CERTIFICATE_VERIFY    15 </span><span class="comment">/* 0x0f */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af6fec2c761a9132b14de85d3fe0ecbb1">   90</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_CLIENT_KEY_EXCHANGE   16 </span><span class="comment">/* 0x10 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac9f5d59963e64f2edd81e2642566eaaf">   91</a></span>&#160;<span class="preprocessor">#define HANDSHAKE_FINISHED              20 </span><span class="comment">/* 0x14 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ada0b6681bb0250388a3ee284783a1a06">   93</a></span>&#160;<span class="preprocessor">#define TLS_EMPTY_RENEGOTIATION_INFO_SCSV       0x00FF </span><span class="comment">/* not a real cipher id... */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aad3170a2d46bb017413e2870b9ca8e2c">   95</a></span>&#160;<span class="preprocessor">#define SSL_NULL_WITH_NULL_NULL                 0x0000</span></div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2ac6e89d54c76fe0aa32ca8842683f21">   96</a></span>&#160;<span class="preprocessor">#define SSL_RSA_WITH_NULL_MD5                   0x0001</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a585bc22cf528ae62e01ec655dfac994d">   97</a></span>&#160;<span class="preprocessor">#define SSL_RSA_WITH_NULL_SHA                   0x0002</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aee3e63d7f22d018172084c17b7c7a1c9">   98</a></span>&#160;<span class="preprocessor">#define SSL_RSA_WITH_RC4_128_MD5                0x0004</span></div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aff2ba231bc1f6a3c434de35619afe858">   99</a></span>&#160;<span class="preprocessor">#define SSL_RSA_WITH_RC4_128_SHA                0x0005</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#adedb1a3a43af5127f3d82bc4c8c6df80">  100</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_IDEA_CBC_SHA               0x0007  </span><span class="comment">/* 7 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a720456172cafe8858ea2d83c80bf009a">  101</a></span>&#160;<span class="preprocessor">#define SSL_RSA_WITH_3DES_EDE_CBC_SHA           0x000A  </span><span class="comment">/* 10 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a31d99e6a7a4545020fc8054f1cf1dd85">  103</a></span>&#160;<span class="preprocessor">#define SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA       0x0016  </span><span class="comment">/* 22 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6dc39ed8b31ab66840fc1ce571399abb">  104</a></span>&#160;<span class="preprocessor">#define SSL_DH_anon_WITH_RC4_128_MD5            0x0018  </span><span class="comment">/* 24 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afae8f9181cd366e7dc82ae176e4031fc">  105</a></span>&#160;<span class="preprocessor">#define SSL_DH_anon_WITH_3DES_EDE_CBC_SHA       0x001B  </span><span class="comment">/* 27 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a160e2286953c5ca7c436f2c9df205313">  106</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_128_CBC_SHA            0x002F  </span><span class="comment">/*SSLv3   Kx=RSA   Au=RSA   Enc=AES(128) Mac=SHA1 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aab1a72487e5a66ec94a42eb8e88a09f7">  107</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_128_CBC_SHA        0x0033  </span><span class="comment">/* 51 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17ab6c4ed311b2637ae45383a60e916d">  108</a></span>&#160;<span class="preprocessor">#define TLS_DH_anon_WITH_AES_128_CBC_SHA        0x0034  </span><span class="comment">/* 52 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a30ca15463d73a648cb95ea79e64606e3">  109</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_256_CBC_SHA            0x0035  </span><span class="comment">/* 53 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a65276549afb8b9be55964d1b16d7299a">  110</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_256_CBC_SHA        0x0039  </span><span class="comment">/* 57 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af44372f74db7022defb88d3f384ba9ff">  111</a></span>&#160;<span class="preprocessor">#define TLS_DH_anon_WITH_AES_256_CBC_SHA        0x003A  </span><span class="comment">/* 58 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae388fc0dbac04b3d5717fd447eaec61d">  112</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_NULL_SHA256                0x003B  </span><span class="comment">/* 59 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a54355abc9101b3aa02477e02f76b46bd">  113</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_128_CBC_SHA256         0x003C  </span><span class="comment">/* 60 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a049cb14aa5985691cbcf3e9414141878">  114</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_256_CBC_SHA256         0x003D  </span><span class="comment">/* 61 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7a57810f4fe1339ae63ca4771661ad04">  115</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_128_CBC_SHA256     0x0067  </span><span class="comment">/* 103 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5c8a49fea187f9bc19c43520f22d960b">  116</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_256_CBC_SHA256     0x006B  </span><span class="comment">/* 107 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac2b351a80dba61fd99ce858986b9ce7b">  117</a></span>&#160;<span class="preprocessor">#define TLS_PSK_WITH_AES_128_CBC_SHA            0x008C  </span><span class="comment">/* 140 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ace82139ba8e6700726abfa5c77245fbe">  118</a></span>&#160;<span class="preprocessor">#define TLS_PSK_WITH_AES_256_CBC_SHA            0x008D  </span><span class="comment">/* 141 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a01627f31497f42e8d272161fa6973bf6">  119</a></span>&#160;<span class="preprocessor">#define TLS_DHE_PSK_WITH_AES_128_CBC_SHA        0x0090  </span><span class="comment">/* 144 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac8af95f28962ba51d15872e90a6748a5">  120</a></span>&#160;<span class="preprocessor">#define TLS_DHE_PSK_WITH_AES_256_CBC_SHA        0x0091  </span><span class="comment">/* 145 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8cf517312374fc31c0bce3b2d9b79acd">  121</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_SEED_CBC_SHA               0x0096  </span><span class="comment">/* 150 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a47cae4f1051ae290a4706ed1107c6606">  122</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_128_GCM_SHA256         0x009C  </span><span class="comment">/*TLSv1.2 Kx=RSA   Au=RSA   Enc=AESGCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a275538776fa5a59590823e1c671aed67">  123</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_256_GCM_SHA384         0x009D  </span><span class="comment">/*TLSv1.2 Kx=RSA   Au=RSA   Enc=AESGCM(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3dc8b4ef99deb86586540f85e9c65d01">  124</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_128_GCM_SHA256     0x009E  </span><span class="comment">/*TLSv1.2 Kx=DH    Au=RSA   Enc=AESGCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a35101dd242f84d4c2d1d9d7b0d866a7b">  125</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_256_GCM_SHA384     0x009F  </span><span class="comment">/*TLSv1.2 Kx=DH    Au=RSA   Enc=AESGCM(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afa7197cce7a58d79f5befd6e2d983762">  126</a></span>&#160;<span class="preprocessor">#define TLS_DH_anon_WITH_AES_128_GCM_SHA256     0x00A6  </span><span class="comment">/* RFC 5288 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aec69288da16558e26fbbbe412a680e4b">  127</a></span>&#160;<span class="preprocessor">#define TLS_DH_anon_WITH_AES_256_GCM_SHA384     0x00A7  </span><span class="comment">/* RFC 5288 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1676d111553c1755ca80e87b79408679">  128</a></span>&#160;<span class="preprocessor">#define TLS_PSK_WITH_AES_128_CBC_SHA256         0x00AE  </span><span class="comment">/* 174 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5a8c3f6ccf5ad9a631482cd9a44226e8">  129</a></span>&#160;<span class="preprocessor">#define TLS_PSK_WITH_AES_256_CBC_SHA384         0x00AF  </span><span class="comment">/* 175 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a809a74c346fd5e9b0e614304cadb3e00">  130</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA     0xC004  </span><span class="comment">/* 49156 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a97381c3874fcdbebe366ff26c3c023fe">  131</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA     0xC005  </span><span class="comment">/* 49157 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5c065d6a1ed19fefcca6bf712188f2ea">  132</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA    0xC009  </span><span class="comment">/*TLSv1   Kx=ECDH  Au=ECDSA Enc=AES(128) Mac=SHA1 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac5bbbda5d30db5b78213e0a53c41e5f6">  133</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA    0xC00A  </span><span class="comment">/*TLSv1   Kx=ECDH  Au=ECDSA Enc=AES(256) Mac=SHA1 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa91806e0632eb2034cade163f96e08b2">  134</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_RSA_WITH_AES_128_CBC_SHA       0xC00E  </span><span class="comment">/* 49166 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a82177482378436bd1be8a62bb003f7de">  135</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_RSA_WITH_AES_256_CBC_SHA       0xC00F  </span><span class="comment">/* 49167 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7f0f5245bc820bbc208a4b30e3ea3302">  136</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA     0xC012  </span><span class="comment">/* 49170 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61caecb35301de4dba9ea87288f58b91">  137</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA      0xC013  </span><span class="comment">/*TLSv1   Kx=ECDH  Au=RSA   Enc=AES(128) Mac=SHA1 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9889f63e65374add6ecf1b0243c381f4">  138</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA      0xC014  </span><span class="comment">/*TLSv1   Kx=ECDH  Au=RSA   Enc=AES(256) Mac=SHA1 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8deaf30dea0d20b76db0a22ea133683d">  139</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_anon_WITH_AES_128_CBC_SHA      0xC018  </span><span class="comment">/* RFC 4492 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0e0e618ba0a09d6e2c8c5fadf9d188f4">  140</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_anon_WITH_AES_256_CBC_SHA      0xC019  </span><span class="comment">/* RFC 4492 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a401c11fa2f370f504deb0aaecca8d9ad">  141</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 0xC023  </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=AES(128) Mac=SHA256 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af16b4ac6bd9cc610c408b1be8f7b4d2e">  142</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 0xC024  </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=AES(256) Mac=SHA384 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a10f10a84c77909bb5e3d484b3f904a0b">  143</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256  0xC025  </span><span class="comment">/* 49189 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0f8e1a381e135f77525a9c6393eb924f">  144</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384  0xC026  </span><span class="comment">/* 49190 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acdd0b724733e8b6e408cc7ce53b6d0db">  145</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256   0xC027  </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=RSA   Enc=AES(128) Mac=SHA256 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab25ddd336d25df6621b1436be12450eb">  146</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384   0xC028  </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=RSA   Enc=AES(256) Mac=SHA384 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5f88bf757bb85ecfe28fd5264e2721a8">  147</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256    0xC029  </span><span class="comment">/* 49193 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afd26d3c412c9b7a99d9b15fdc78a67eb">  148</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384    0xC02A  </span><span class="comment">/* 49194 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">/* RFC 5288 &quot;AES Galois Counter Mode (GCM) Cipher Suites for TLS&quot; */</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3d7ef0a6518f1f638f2348d99eefb17a">  150</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 0xC02B  </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=AESGCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af72ed33cfc1e9977b62253dae53923e2">  151</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 0xC02C  </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=AESGCM(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a26d67663de7dae18c51969bcdc3bd70d">  152</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256  0xC02D  </span><span class="comment">/* 49197 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aef3dcb9d6fae59e0efb4d5dc4997f5c4">  153</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384  0xC02E  </span><span class="comment">/* 49198 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3654359382307a986b1834a812c69f64">  154</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256   0xC02F  </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=RSA   Enc=AESGCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5d287e13f2484dd37398fa342fdef7b4">  155</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384   0xC030  </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=RSA   Enc=AESGCM(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a616422519509b4a667e98a1e4dbfebc8">  156</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256    0xC031  </span><span class="comment">/* 49201 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ade1889f8b954d53bc910e1e016679d39">  157</a></span>&#160;<span class="preprocessor">#define TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384    0xC032  </span><span class="comment">/* 49202 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a21c57f86ab2bb68a2436ecddaf69a7b4">  158</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA      0xC035</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17ca9c450c5228938a75f964f90db9cb">  159</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA      0xC036</span></div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#adc45f48d71a6fd3c0d3bfd46dc4dfabf">  160</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256   0xC037</span></div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a19782b5bb8923092f3268f6ce5ef2f76">  161</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA384   0xC038</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">/* From http://wiki.mozilla.org/Security/Server_Side_TLS */</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">/* and &#39;openssl ciphers -V -stdname&#39; */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0bc31dea187e19a84ea02749de509a63">  165</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_128_CCM                      0xC09C </span><span class="comment">/*TLSv1.2 Kx=RSA   Au=RSA   Enc=AESCCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2df7b23c7917aad60d1654e3826ca388">  166</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_256_CCM                      0xC09D </span><span class="comment">/*TLSv1.2 Kx=RSA   Au=RSA   Enc=AESCCM(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6c93ed48205031a19333788624a47b01">  167</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_128_CCM                  0xC09E </span><span class="comment">/*TLSv1.2 Kx=DH    Au=RSA   Enc=AESCCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3d03a1a519d0b0b81d855bd9e34a320a">  168</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_256_CCM                  0xC09F </span><span class="comment">/*TLSv1.2 Kx=DH    Au=RSA   Enc=AESCCM(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a565e29a90172e7eb87bc09db33485ea9">  169</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_128_CCM_8                    0xC0A0 </span><span class="comment">/*TLSv1.2 Kx=RSA   Au=RSA   Enc=AESCCM8(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a4e834323b40bc42a0b89ce69ca6fc75f">  170</a></span>&#160;<span class="preprocessor">#define TLS_RSA_WITH_AES_256_CCM_8                    0xC0A1 </span><span class="comment">/*TLSv1.2 Kx=RSA   Au=RSA   Enc=AESCCM8(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac18f8b5ce841e70e80c0f57250c44863">  171</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_128_CCM_8                0xC0A2 </span><span class="comment">/*TLSv1.2 Kx=DH    Au=RSA   Enc=AESCCM8(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a605206196f3cf23bf9f93541e4bfdf34">  172</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_AES_256_CCM_8                0xC0A3 </span><span class="comment">/*TLSv1.2 Kx=DH    Au=RSA   Enc=AESCCM8(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a487efc0ff5a09743878ca5c52896b325">  173</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_128_CCM              0xC0AC </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=AESCCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9d1ee1bea891d61cdad224755a2e0072">  174</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_256_CCM              0xC0AD </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=AESCCM(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5831ef2a636580afc137f3132e7233e9">  175</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8            0xC0AE </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=AESCCM8(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afd03144e2fea9b2ee57bd55564bc2ea7">  176</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_AES_256_CCM_8            0xC0AF </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=AESCCM8(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a483320297992acc12c5cc5e801f144d3">  177</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256   0xCCA8 </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=RSA   Enc=CHACHA20/POLY1305(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a853d3ab3506517d61f18d4ffa610d6fc">  178</a></span>&#160;<span class="preprocessor">#define TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 0xCCA9 </span><span class="comment">/*TLSv1.2 Kx=ECDH  Au=ECDSA Enc=CHACHA20/POLY1305(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af6b2416addb77fc354d3cf198f64aa6e">  179</a></span>&#160;<span class="preprocessor">#define TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256     0xCCAA </span><span class="comment">/*TLSv1.2 Kx=DH    Au=RSA   Enc=CHACHA20/POLY1305(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad99d010ce10246c2f28dd95d82aacae2">  181</a></span>&#160;<span class="preprocessor">#define TLS_AES_128_GCM_SHA256                        0x1301 </span><span class="comment">/*TLSv1.3 Kx=any   Au=any   Enc=AESGCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a113044f98597022ad8f8bc35aa06f9c5">  182</a></span>&#160;<span class="preprocessor">#define TLS_AES_256_GCM_SHA384                        0x1302 </span><span class="comment">/*TLSv1.3 Kx=any   Au=any   Enc=AESGCM(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1fd998a580e8d1967290fd852d061254">  183</a></span>&#160;<span class="preprocessor">#define TLS_CHACHA20_POLY1305_SHA256                  0x1303 </span><span class="comment">/*TLSv1.3 Kx=any   Au=any   Enc=CHACHA20/POLY1305(256) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8ea3efe20abf6ad015aa261fc70eb028">  184</a></span>&#160;<span class="preprocessor">#define TLS_AES_128_CCM_SHA256                        0x1304 </span><span class="comment">/*TLSv1.3 Kx=any   Au=any   Enc=AESCCM(128) Mac=AEAD */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">/* Might go to libbb.h */</span></div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb93440f0b18431d1be9f5b0d98904ee">  187</a></span>&#160;<span class="preprocessor">#define TLS_MAX_CRYPTBLOCK_SIZE 16</span></div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8e5b1766844eb48b2a9fdacb9ce26f14">  188</a></span>&#160;<span class="preprocessor">#define TLS_MAX_OUTBUF          (1 &lt;&lt; 14)</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keyword">enum</span> {</div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">  191</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">SHA_INSIZE</a>     = 64,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad61a29ae1d927dd634c2efbff44b8a18">  193</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad61a29ae1d927dd634c2efbff44b8a18">AES128_KEYSIZE</a> = 16,</div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0aa2ef4fc31647cb6840883c00ec5a49b7">  194</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0aa2ef4fc31647cb6840883c00ec5a49b7">AES256_KEYSIZE</a> = 32,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">  196</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">RSA_PREMASTER_SIZE</a> = 48,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">  198</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> = 5,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">/* 8 = 3+5. 3 extra bytes result in record data being 32-bit aligned */</span></div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">  201</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a> = 8 + <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>, <span class="comment">/* header + IV */</span></div>
<div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad6a2447a142236ed15d5c103c8d22075">  202</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad6a2447a142236ed15d5c103c8d22075">OUTBUF_SFX</a> = <a class="code" href="../../d7/dd7/libbb_8h.html#a6d262c2876457dc50108802ded585abc">TLS_MAX_MAC_SIZE</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb93440f0b18431d1be9f5b0d98904ee">TLS_MAX_CRYPTBLOCK_SIZE</a>, <span class="comment">/* MAC + padding */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// RFC 5246:</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// | 6.2.1. Fragmentation</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// |  The record layer fragments information blocks into TLSPlaintext</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// |  records carrying data in chunks of 2^14 bytes or less.  Client</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// |  message boundaries are not preserved in the record layer (i.e.,</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// |  multiple client messages of the same ContentType MAY be coalesced</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// |  into a single TLSPlaintext record, or a single message MAY be</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// |  fragmented across several records)</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// |...</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// |  length</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// |    The length (in bytes) of the following TLSPlaintext.fragment.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// |    The length MUST NOT exceed 2^14.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// |...</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// | 6.2.2. Record Compression and Decompression</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// |...</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// |  Compression must be lossless and may not increase the content length</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// |  by more than 1024 bytes.  If the decompression function encounters a</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">// |  TLSCompressed.fragment that would decompress to a length in excess of</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// |  2^14 bytes, it MUST report a fatal decompression failure error.</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// |...</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// |  length</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// |    The length (in bytes) of the following TLSCompressed.fragment.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// |    The length MUST NOT exceed 2^14 + 1024.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// |...</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// | 6.2.3.  Record Payload Protection</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// |  The encryption and MAC functions translate a TLSCompressed</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">// |  structure into a TLSCiphertext.  The decryption functions reverse</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// |  the process.  The MAC of the record also includes a sequence</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// |  number so that missing, extra, or repeated messages are</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// |  detectable.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// |...</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// |  length</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// |    The length (in bytes) of the following TLSCiphertext.fragment.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// |    The length MUST NOT exceed 2^14 + 2048.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">  238</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">MAX_INBUF</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + (1 &lt;&lt; 14) + 2048,</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">/* Bits for tls-&gt;flags */</span></div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab38dc88e6d70f9206569c50c1d895b85">  241</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab38dc88e6d70f9206569c50c1d895b85">NEED_EC_KEY</a>            = 1 &lt;&lt; 0,</div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ac39e3e35406c535eefd6407179d18a8d">  242</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ac39e3e35406c535eefd6407179d18a8d">GOT_CERT_RSA_KEY_ALG</a>   = 1 &lt;&lt; 1,</div>
<div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0aae97981bebec903c5e016514d81ee11e">  243</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0aae97981bebec903c5e016514d81ee11e">GOT_CERT_ECDSA_KEY_ALG</a> = 1 &lt;&lt; 2, <span class="comment">// so far unused</span></div>
<div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad0b8160a079f0c3fdcfc1f46c68e4b1f">  244</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad0b8160a079f0c3fdcfc1f46c68e4b1f">GOT_EC_KEY</a>             = 1 &lt;&lt; 3,</div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a971b66d3a2f12dd1f58a1cd048814193">  245</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a971b66d3a2f12dd1f58a1cd048814193">GOT_EC_CURVE_X25519</a>    = 1 &lt;&lt; 4, <span class="comment">// else P256</span></div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2">  246</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2">ENCRYPTION_AESGCM</a>      = 1 &lt;&lt; 5, <span class="comment">// else AES-SHA (or NULL-SHA if ALLOW_RSA_NULL_SHA256=1)</span></div>
<div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a341620e2929e799f062087e23e49d5e1">  247</a></span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a341620e2929e799f062087e23e49d5e1">ENCRYPT_ON_WRITE</a>       = 1 &lt;&lt; 6,</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;};</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html">  250</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> {</div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">  251</a></span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">type</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">  252</a></span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">proto_maj</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d34e2d988fc19f2480bab352b6376d0">proto_min</a>;</div>
<div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">  253</a></span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;};</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html">  256</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d5/de3/structtls__handshake__data">tls_handshake_data</a> {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">/* In bbox, md5/sha1/sha256 ctx&#39;s are the same structure */</span></div>
<div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a087b69ab91f3b4fa570daccc680043af">  258</a></span>&#160;    <a class="code" href="../../d3/dd3/structmd5__ctx__t.html">md5sha_ctx_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a087b69ab91f3b4fa570daccc680043af">handshake_hash_ctx</a>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">  260</a></span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">client_and_server_rand32</a>[2 * 32];</div>
<div class="line"><a name="l00261"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">  261</a></span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>[48];</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">//TODO: store just the DER key here, parse/use/delete it when sending client key</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">//this way it will stay key type agnostic here.</span></div>
<div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">  265</a></span>&#160;    <a class="code" href="../../d4/df3/tls__rsa_8h.html#d2/d73/structpsRsaKey__t">psRsaKey_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">server_rsa_pub_key</a>;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">/* peer&#39;s elliptic curve key data */</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">/* for x25519, it contains one point in first 32 bytes */</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">/* for P256, it contains x,y point pair, each 32 bytes long */</span></div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a360c5e94b1f215558f06d59c710de87d">  270</a></span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a360c5e94b1f215558f06d59c710de87d">ecc_pub_key32</a>[2 * 32];</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">/* HANDSHAKE HASH: */</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">//unsigned saved_client_hello_size;</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">//uint8_t saved_client_hello[1];</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;};</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae77ce99bbd9b7699102e28cc744d3825">  278</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae77ce99bbd9b7699102e28cc744d3825">get24be</a>(<span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">return</span> 0x100*(0x100*<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[0] + <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[1]) + <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[2];</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;}</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="preprocessor">#if TLS_DEBUG</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">/* Nondestructively see the current hash value */</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor"># if TLS_DEBUG_HASH</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> sha_peek(<a class="code" href="../../d3/dd3/structmd5__ctx__t.html">md5sha_ctx_t</a> *<a class="code" href="../../d0/dd6/setxid_8c.html#d5/d06/structctx">ctx</a>, <span class="keywordtype">void</span> *<a class="code" href="../../d6/dc6/termcap_8c.html#dd/da2/structbuffer">buffer</a>)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;{</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="../../d3/dd3/structmd5__ctx__t.html">md5sha_ctx_t</a> ctx_copy = *<a class="code" href="../../d1/ddc/musl_2src_2malloc_2mallocng_2malloc_8c.html#aaabfc6451d990d9a5312948a8f4d8473">ctx</a>; <span class="comment">/* struct copy */</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/dd7/libbb_8h.html#a5b67932d25a41873f6841c48833c4778">sha_end</a>(&amp;ctx_copy, <a class="code" href="../../d6/dc6/termcap_8c.html#dd/da2/structbuffer">buffer</a>);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="../../db/dd4/sm__loop_8c.html#ac27eda88ff3c79f2d9f14fb5c682c418">vp</a>, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;{</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordtype">char</span> hexbuf[32 * 1024 + 4];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> = <a class="code" href="../../db/dd4/sm__loop_8c.html#ac27eda88ff3c79f2d9f14fb5c682c418">vp</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#afe523b6f7b92441d4dc28a330d46c245">bin2hex</a>(hexbuf, (<span class="keywordtype">void</span>*)<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>, len)[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(fmt, hexbuf);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af2f7e6ef152a4947a46b0a367ae69909">dump_tls_record</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="../../db/dd4/sm__loop_8c.html#ac27eda88ff3c79f2d9f14fb5c682c418">vp</a>, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;{</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> = <a class="code" href="../../db/dd4/sm__loop_8c.html#ac27eda88ff3c79f2d9f14fb5c682c418">vp</a>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">while</span> (len &gt; 0) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordtype">unsigned</span> xhdr_len;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">if</span> (len &lt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>) {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;&lt; |%s|\n&quot;</span>, <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>, len);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        xhdr_len = 0x100*<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[3] + <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[4];</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&lt; hdr_type:%u ver:%u.%u len:%u&quot;</span>, <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[0], <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[1], <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[2], xhdr_len);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> += <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        len -= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">if</span> (len &gt;= 4 &amp;&amp; <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[-<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>] == <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a222955be70285ace97b0fffa2b082f5d">RECORD_TYPE_HANDSHAKE</a>) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="keywordtype">unsigned</span> len24 = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae77ce99bbd9b7699102e28cc744d3825">get24be</a>(<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> + 1);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot; type:%u len24:%u&quot;</span>, <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[0], len24);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">if</span> (xhdr_len &gt; len)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            xhdr_len = len;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot; |%s|\n&quot;</span>, <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>, xhdr_len);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> += xhdr_len;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        len -= xhdr_len;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">  328</a></span>&#160;<span class="preprocessor"># define dump_hex(...) ((void)0)</span></div>
<div class="line"><a name="l00329"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af2f7e6ef152a4947a46b0a367ae69909">  329</a></span>&#160;<span class="preprocessor"># define dump_tls_record(...) ((void)0)</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a59d1a3325c8c18009268226036a074a2">  332</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/dd7/libbb_8h.html#a9e5609718f2d1fe5ead7714b3d45223b">FAST_FUNC</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a59d1a3325c8c18009268226036a074a2">tls_get_random</a>(<span class="keywordtype">void</span> *<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, <span class="keywordtype">unsigned</span> len)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;{</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (len != <a class="code" href="../../d7/dd7/libbb_8h.html#aee37d677b0719b1ffcefe1406c7c47f5">open_read_close</a>(<span class="stringliteral">&quot;/dev/urandom&quot;</span>, <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, len))</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;}</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab517f4a374d088f9545c1af5136a20e1">  338</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab517f4a374d088f9545c1af5136a20e1">xorbuf3</a>(<span class="keywordtype">void</span> *<a class="code" href="../../df/d84/arping_8c.html#a21e72f66ad6f15c4dcb2c8afbb57d7dd">dst</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *src1, <span class="keyword">const</span> <span class="keywordtype">void</span> *src2, <span class="keywordtype">unsigned</span> <a class="code" href="../../d2/dd6/dd_8c.html#ac74ae34e9c58234aacabb6867b245c58">count</a>)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;{</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *d = <a class="code" href="../../df/d84/arping_8c.html#a21e72f66ad6f15c4dcb2c8afbb57d7dd">dst</a>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d3/d84/lgamma__r_8c.html#a1ff9ee3251659529629e761b307fada6">s1</a> = src1;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a>* <a class="code" href="../../d3/d84/lgamma__r_8c.html#a6f99aff13f96e26313f4fdfb4fbe5b1d">s2</a> = src2;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="../../d2/dd6/dd_8c.html#ac74ae34e9c58234aacabb6867b245c58">count</a>--)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        *d++ = *<a class="code" href="../../d3/d84/lgamma__r_8c.html#a1ff9ee3251659529629e761b307fada6">s1</a>++ ^ *<a class="code" href="../../d3/d84/lgamma__r_8c.html#a6f99aff13f96e26313f4fdfb4fbe5b1d">s2</a>++;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a92c445bf59ecea2f4453d2d90d4abd75">  347</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/dd7/libbb_8h.html#a9e5609718f2d1fe5ead7714b3d45223b">FAST_FUNC</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a92c445bf59ecea2f4453d2d90d4abd75">xorbuf</a>(<span class="keywordtype">void</span> *<a class="code" href="../../df/d84/arping_8c.html#a21e72f66ad6f15c4dcb2c8afbb57d7dd">dst</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="../../df/d84/arping_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">unsigned</span> <a class="code" href="../../d2/dd6/dd_8c.html#ac74ae34e9c58234aacabb6867b245c58">count</a>)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;{</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab517f4a374d088f9545c1af5136a20e1">xorbuf3</a>(<a class="code" href="../../df/d84/arping_8c.html#a21e72f66ad6f15c4dcb2c8afbb57d7dd">dst</a>, <a class="code" href="../../df/d84/arping_8c.html#a21e72f66ad6f15c4dcb2c8afbb57d7dd">dst</a>, <a class="code" href="../../df/d84/arping_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="../../d2/dd6/dd_8c.html#ac74ae34e9c58234aacabb6867b245c58">count</a>);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a58e6839560679f7f99491ed40f73231e">  352</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/dd7/libbb_8h.html#a9e5609718f2d1fe5ead7714b3d45223b">FAST_FUNC</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a58e6839560679f7f99491ed40f73231e">xorbuf_aligned_AES_BLOCK_SIZE</a>(<span class="keywordtype">void</span> *<a class="code" href="../../df/d84/arping_8c.html#a21e72f66ad6f15c4dcb2c8afbb57d7dd">dst</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="../../df/d84/arping_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *d = <a class="code" href="../../df/d84/arping_8c.html#a21e72f66ad6f15c4dcb2c8afbb57d7dd">dst</a>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *<a class="code" href="../../df/d19/arpping_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a> = <a class="code" href="../../df/d84/arping_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    d[0] ^= <a class="code" href="../../df/d19/arpping_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a>[0];</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor">#if ULONG_MAX &lt;= 0xffffffffffffffff</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    d[1] ^= <a class="code" href="../../df/d19/arpping_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a>[1];</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor"> #if ULONG_MAX == 0xffffffff</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    d[2] ^= <a class="code" href="../../df/d19/arpping_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a>[2];</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    d[3] ^= <a class="code" href="../../df/d19/arpping_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a>[3];</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor"> #endif</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#if !TLS_DEBUG_HASH</span></div>
<div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a859e8181c002d45232991f43512b7246">  367</a></span>&#160;<span class="preprocessor"># define hash_handshake(tls, fmt, buffer, len) \</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="preprocessor">         hash_handshake(tls, buffer, len)</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00370"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aedd1f273ec6b3939d9999e3e19a9dff6">  370</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a859e8181c002d45232991f43512b7246">hash_handshake</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="../../d6/dc6/termcap_8c.html#dd/da2/structbuffer">buffer</a>, <span class="keywordtype">unsigned</span> len)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;{</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a9acf0ed0d96489152914d089c778713a">md5sha_hash</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a087b69ab91f3b4fa570daccc680043af">handshake_hash_ctx</a>, <a class="code" href="../../d6/dc6/termcap_8c.html#dd/da2/structbuffer">buffer</a>, len);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="preprocessor">#if TLS_DEBUG_HASH</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>[<a class="code" href="../../d7/dd7/libbb_8h.html#a6d262c2876457dc50108802ded585abc">TLS_MAX_MAC_SIZE</a>];</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(fmt, <a class="code" href="../../d6/dc6/termcap_8c.html#dd/da2/structbuffer">buffer</a>, len);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot; (%u bytes) &quot;</span>, (<span class="keywordtype">int</span>)len);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        len = sha_peek(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a087b69ab91f3b4fa570daccc680043af">handshake_hash_ctx</a>, <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">if</span> (ENABLE_FEATURE_TLS_SHA1 &amp;&amp; len == <a class="code" href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13daa403a6ccafdf7f0e2d6615f70dfd371d">SHA1_OUTSIZE</a>)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;sha1:%s\n&quot;</span>, <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>, len);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">if</span> (len == <a class="code" href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da0bc3102f049b590dff06d0ed0360796e">SHA256_OUTSIZE</a>)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;sha256:%s\n&quot;</span>, <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>, len);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;sha???:%s\n&quot;</span>, <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>, len);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="preprocessor">#if !ENABLE_FEATURE_TLS_SHA1</span></div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">  391</a></span>&#160;<span class="preprocessor"># define TLS_MAC_SIZE(tls) SHA256_OUTSIZE</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="preprocessor"># define TLS_MAC_SIZE(tls) (tls)-&gt;MAC_size</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">// RFC 2104:</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">// HMAC(key, text) based on a hash H (say, sha256) is:</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">// ipad = [0x36 x INSIZE]</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">// opad = [0x5c x INSIZE]</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">// HMAC(key, text) = H((key XOR opad) + H((key XOR ipad) + text))</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">// H(key XOR opad) and H(key XOR ipad) can be precomputed</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">// if we often need HMAC hmac with the same key.</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">// text is often given in disjoint pieces.</span></div>
<div class="line"><a name="l00406"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html">  406</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#db/dcc/structhmac__precomputed">hmac_precomputed</a> {</div>
<div class="line"><a name="l00407"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0d3a7ba9c02b5936c01bfec5968cf701">  407</a></span>&#160;    <a class="code" href="../../d3/dd3/structmd5__ctx__t.html">md5sha_ctx_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0d3a7ba9c02b5936c01bfec5968cf701">hashed_key_xor_ipad</a>;</div>
<div class="line"><a name="l00408"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad688a0955360a4c03d1134b154e93913">  408</a></span>&#160;    <a class="code" href="../../d3/dd3/structmd5__ctx__t.html">md5sha_ctx_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad688a0955360a4c03d1134b154e93913">hashed_key_xor_opad</a>;</div>
<div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3470fab88480f3122875e6bf12972147">  409</a></span>&#160;} <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3470fab88480f3122875e6bf12972147">hmac_precomputed_t</a>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9b7722837b5b510ec2aa4e126afc403a">  411</a></span>&#160;<span class="keyword">typedef</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9b7722837b5b510ec2aa4e126afc403a">md5sha_begin_func</a>(<a class="code" href="../../d3/dd3/structmd5__ctx__t.html">md5sha_ctx_t</a> *<a class="code" href="../../d0/dd6/setxid_8c.html#d5/d06/structctx">ctx</a>) <a class="code" href="../../d7/dd7/libbb_8h.html#a9e5609718f2d1fe5ead7714b3d45223b">FAST_FUNC</a>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="preprocessor">#if !ENABLE_FEATURE_TLS_SHA1</span></div>
<div class="line"><a name="l00413"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a091527eb31e6f2ec4e81aea8a7249b33">  413</a></span>&#160;<span class="preprocessor">#define hmac_begin(pre,key,key_size,begin) \</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="preprocessor">    hmac_begin(pre,key,key_size)</span></div>
<div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6756696bd68e8b60d37f7c5a68aec3d">  415</a></span>&#160;<span class="preprocessor">#define begin sha256_begin</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad50f6165068307a4ca96867d3a3414e7">  417</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a091527eb31e6f2ec4e81aea8a7249b33">hmac_begin</a>(<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#db/dcc/structhmac__precomputed">hmac_precomputed_t</a> *pre, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *key, <span class="keywordtype">unsigned</span> key_size, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9b7722837b5b510ec2aa4e126afc403a">md5sha_begin_func</a> *<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6756696bd68e8b60d37f7c5a68aec3d">begin</a>)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;{</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> key_xor_ipad[<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">SHA_INSIZE</a>];</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> key_xor_opad[<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">SHA_INSIZE</a>];</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">//  uint8_t tempkey[SHA1_OUTSIZE &lt; SHA256_OUTSIZE ? SHA256_OUTSIZE : SHA1_OUTSIZE];</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">// &quot;The authentication key can be of any length up to INSIZE, the</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">// block length of the hash function.  Applications that use keys longer</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// than INSIZE bytes will first hash the key using H and then use the</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// resultant OUTSIZE byte string as the actual key to HMAC.&quot;</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (key_size &gt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">SHA_INSIZE</a>) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#aa7873f1b32526ae11612363558a2aa90">bb_simple_error_msg_and_die</a>(<span class="stringliteral">&quot;HMAC key&gt;64&quot;</span>); <span class="comment">//does not happen (yet?)</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">//      md5sha_ctx_t ctx;</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">//      begin(&amp;ctx);</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">//      md5sha_hash(&amp;ctx, key, key_size);</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">//      key_size = sha_end(&amp;ctx, tempkey);</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">//      //key = tempkey; - right? RIGHT? why does it work without this?</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">//      // because SHA_INSIZE is 64, but hmac() is always called with</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">//      // key_size = tls-&gt;MAC_size = SHA1/256_OUTSIZE (20 or 32),</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">//      // and prf_hmac_sha256() -&gt; hmac_sha256() key sizes are:</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">//      // - RSA_PREMASTER_SIZE is 48</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">//      // - CURVE25519_KEYSIZE is 32</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">//      // - master_secret[] is 48</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a> = 0; <a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a> &lt; key_size; <a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>++) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        key_xor_ipad[<a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>] = key[<a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>] ^ 0x36;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        key_xor_opad[<a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>] = key[<a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>] ^ 0x5c;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">for</span> (; <a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a> &lt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">SHA_INSIZE</a>; <a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>++) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        key_xor_ipad[<a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>] = 0x36;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        key_xor_opad[<a class="code" href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a>] = 0x5c;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6756696bd68e8b60d37f7c5a68aec3d">begin</a>(&amp;pre-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0d3a7ba9c02b5936c01bfec5968cf701">hashed_key_xor_ipad</a>);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6756696bd68e8b60d37f7c5a68aec3d">begin</a>(&amp;pre-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad688a0955360a4c03d1134b154e93913">hashed_key_xor_opad</a>);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a9acf0ed0d96489152914d089c778713a">md5sha_hash</a>(&amp;pre-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0d3a7ba9c02b5936c01bfec5968cf701">hashed_key_xor_ipad</a>, key_xor_ipad, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">SHA_INSIZE</a>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a9acf0ed0d96489152914d089c778713a">md5sha_hash</a>(&amp;pre-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad688a0955360a4c03d1134b154e93913">hashed_key_xor_opad</a>, key_xor_opad, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">SHA_INSIZE</a>);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor">#undef begin</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae00dcdfc46a1dc668a87478b16476c73">  459</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae00dcdfc46a1dc668a87478b16476c73">hmac_sha_precomputed_v</a>(</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#db/dcc/structhmac__precomputed">hmac_precomputed_t</a> *pre,</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>,</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#af53f622e3b6c080daeb167c1955d7ec1">va_list</a> va)</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;{</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d4/d49/vi_8c.html#a1144b296168b3bd3f9c04d75f4d5b94c">text</a>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">unsigned</span> len;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">/* pre-&gt;hashed_key_xor_ipad contains unclosed &quot;H((key XOR ipad) +&quot; state */</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">/* pre-&gt;hashed_key_xor_opad contains unclosed &quot;H((key XOR opad) +&quot; state */</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">/* calculate out = H((key XOR ipad) + text) */</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">while</span> ((<a class="code" href="../../d4/d49/vi_8c.html#a1144b296168b3bd3f9c04d75f4d5b94c">text</a> = <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#a81ebe6ea6253b0c6618e29de70fe10eb">va_arg</a>(va, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a>*)) != <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../d4/d49/vi_8c.html#a176a37bacb55f480893e743ae5bb55db">text_size</a> = <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#a81ebe6ea6253b0c6618e29de70fe10eb">va_arg</a>(va, <span class="keywordtype">unsigned</span>);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#a9acf0ed0d96489152914d089c778713a">md5sha_hash</a>(&amp;pre-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0d3a7ba9c02b5936c01bfec5968cf701">hashed_key_xor_ipad</a>, <a class="code" href="../../d4/d49/vi_8c.html#a1144b296168b3bd3f9c04d75f4d5b94c">text</a>, <a class="code" href="../../d4/d49/vi_8c.html#a176a37bacb55f480893e743ae5bb55db">text_size</a>);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    len = <a class="code" href="../../d7/dd7/libbb_8h.html#a5b67932d25a41873f6841c48833c4778">sha_end</a>(&amp;pre-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0d3a7ba9c02b5936c01bfec5968cf701">hashed_key_xor_ipad</a>, <a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">/* out = H((key XOR opad) + out) */</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a9acf0ed0d96489152914d089c778713a">md5sha_hash</a>(&amp;pre-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad688a0955360a4c03d1134b154e93913">hashed_key_xor_opad</a>, <a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>, len);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/dd7/libbb_8h.html#a5b67932d25a41873f6841c48833c4778">sha_end</a>(&amp;pre-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad688a0955360a4c03d1134b154e93913">hashed_key_xor_opad</a>, <a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a161e5e32461eaeb74bad1a262fc31113">  482</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a161e5e32461eaeb74bad1a262fc31113">hmac_sha_precomputed</a>(<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#db/dcc/structhmac__precomputed">hmac_precomputed_t</a> *pre_init, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>, ...)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;{</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#db/dcc/structhmac__precomputed">hmac_precomputed_t</a> pre;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#af53f622e3b6c080daeb167c1955d7ec1">va_list</a> va;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">unsigned</span> len;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#ade24ac546ea93fde2353ed2db8e89c66">va_start</a>(va, <a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    pre = *pre_init; <span class="comment">/* struct copy */</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae00dcdfc46a1dc668a87478b16476c73">hmac_sha_precomputed_v</a>(&amp;pre, <a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>, va);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#acd9b3b9085ec072324c5fdac2b40304e">va_end</a>(va);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;}</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="preprocessor">#if !ENABLE_FEATURE_TLS_SHA1</span></div>
<div class="line"><a name="l00496"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a4035149b7cdecc1ceac5879991677acd">  496</a></span>&#160;<span class="preprocessor">#define hmac(tls,out,key,key_size,...) \</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor">    hmac(out,key,key_size, __VA_ARGS__)</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a805c40bebf1382d303e0982f45bdde35">  499</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a4035149b7cdecc1ceac5879991677acd">hmac</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *key, <span class="keywordtype">unsigned</span> key_size, ...)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;{</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#db/dcc/structhmac__precomputed">hmac_precomputed_t</a> pre;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#af53f622e3b6c080daeb167c1955d7ec1">va_list</a> va;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordtype">unsigned</span> len;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#ade24ac546ea93fde2353ed2db8e89c66">va_start</a>(va, key_size);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a091527eb31e6f2ec4e81aea8a7249b33">hmac_begin</a>(&amp;pre, key, key_size,</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            (ENABLE_FEATURE_TLS_SHA1 &amp;&amp; tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a> == <a class="code" href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13daa403a6ccafdf7f0e2d6615f70dfd371d">SHA1_OUTSIZE</a>)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                ? <a class="code" href="../../d7/dd7/libbb_8h.html#adb46d65124188e0a902aa1e0cb2f6b58">sha1_begin</a></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                : <a class="code" href="../../d7/dd7/libbb_8h.html#a333b9a46277181b82f5053bcf6129d86">sha256_begin</a></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    );</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae00dcdfc46a1dc668a87478b16476c73">hmac_sha_precomputed_v</a>(&amp;pre, <a class="code" href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a>, va);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="../../d1/dba/libc_2include_2stdarg_8h.html#acd9b3b9085ec072324c5fdac2b40304e">va_end</a>(va);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;}</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">// RFC 5246:</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">// 5.  HMAC and the Pseudorandom Function</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">//...</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">// In this section, we define one PRF, based on HMAC.  This PRF with the</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">// SHA-256 hash function is used for all cipher suites defined in this</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">// document and in TLS documents published prior to this document when</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">// TLS 1.2 is negotiated.</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">// ^^^^^^^^^^^^^ IMPORTANT!</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">//               PRF uses sha256 regardless of cipher for all ciphers</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">//               defined by RFC 5246. It&#39;s not sha1 for AES_128_CBC_SHA!</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">//               However, for _SHA384 ciphers, it&#39;s sha384. See RFC 5288,5289.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">//...</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">//    P_hash(secret, seed) = HMAC_hash(secret, A(1) + seed) +</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">//                           HMAC_hash(secret, A(2) + seed) +</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">//                           HMAC_hash(secret, A(3) + seed) + ...</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">// where + indicates concatenation.</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">// A() is defined as:</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">//    A(0) = seed</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">//    A(1) = HMAC_hash(secret, A(0)) = HMAC_hash(secret, seed)</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">//    A(i) = HMAC_hash(secret, A(i-1))</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">// P_hash can be iterated as many times as necessary to produce the</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">// required quantity of data.  For example, if P_SHA256 is being used to</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">// create 80 bytes of data, it will have to be iterated three times</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">// (through A(3)), creating 96 bytes of output data; the last 16 bytes</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">// of the final iteration will then be discarded, leaving 80 bytes of</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">// output data.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">// TLS&#39;s PRF is created by applying P_hash to the secret as:</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">//    PRF(secret, label, seed) = P_&lt;hash&gt;(secret, label + seed)</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">// The label is an ASCII string.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">// RFC 5288:</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">// For cipher suites ending with _SHA256, the PRF is the TLS PRF</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">// with SHA-256 as the hash function.</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">// For cipher suites ending with _SHA384, the PRF is the TLS PRF</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">// with SHA-384 as the hash function.</span></div>
<div class="line"><a name="l00556"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa2dc08633a73a135c328a2ca9f19ae93">  556</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa2dc08633a73a135c328a2ca9f19ae93">prf_hmac_sha256</a>(<span class="comment">/*tls_state_t *tls,*/</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d4/dcd/nmeter_8c.html#a9f42c0960c4e20484468e09947a3f876">outbuf</a>, <span class="keywordtype">unsigned</span> outbuf_size,</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d6/d23/wi__stuff_8c.html#a6fd173f304efa919e66bbe8a265da9e8">secret</a>, <span class="keywordtype">unsigned</span> secret_size,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/dff/diff_8c.html#a194c3fb843a8ae50f9ed19d4ee4f42de">label</a>,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../de/dcc/awk_8c.html#aa887dc9b7db48419c8d0dcaf198f8d2c">seed</a>, <span class="keywordtype">unsigned</span> seed_size)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;{</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#db/dcc/structhmac__precomputed">hmac_precomputed_t</a> pre;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> a[<a class="code" href="../../d7/dd7/libbb_8h.html#a6d262c2876457dc50108802ded585abc">TLS_MAX_MAC_SIZE</a>];</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *out_p = <a class="code" href="../../d4/dcd/nmeter_8c.html#a9f42c0960c4e20484468e09947a3f876">outbuf</a>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordtype">unsigned</span> label_size = <a class="code" href="../../dc/da4/libc_2include_2string_8h.html#a008e171a518fe0e0352f31b245e03875">strlen</a>(<a class="code" href="../../d6/dff/diff_8c.html#a194c3fb843a8ae50f9ed19d4ee4f42de">label</a>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordtype">unsigned</span> MAC_size = <a class="code" href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da0bc3102f049b590dff06d0ed0360796e">SHA256_OUTSIZE</a>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">/* In P_hash() calculation, &quot;seed&quot; is &quot;label + seed&quot;: */</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="preprocessor">#define SEED   label, label_size, seed, seed_size</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="preprocessor">#define A      a, MAC_size</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a091527eb31e6f2ec4e81aea8a7249b33">hmac_begin</a>(&amp;pre, <a class="code" href="../../d6/d23/wi__stuff_8c.html#a6fd173f304efa919e66bbe8a265da9e8">secret</a>, secret_size, <a class="code" href="../../d7/dd7/libbb_8h.html#a333b9a46277181b82f5053bcf6129d86">sha256_begin</a>);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">/* A(1) = HMAC_hash(secret, seed) */</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a161e5e32461eaeb74bad1a262fc31113">hmac_sha_precomputed</a>(&amp;pre, a, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad350bae49f72ba58d73027f1316e38b8">SEED</a>, <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="comment">/* HMAC_hash(secret, A(1) + seed) */</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">if</span> (outbuf_size &lt;= MAC_size) {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="comment">/* Last, possibly incomplete, block */</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="comment">/* (use a[] as temp buffer) */</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a161e5e32461eaeb74bad1a262fc31113">hmac_sha_precomputed</a>(&amp;pre, a, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a955f504eccf76b4eb2489c0adab03121">A</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad350bae49f72ba58d73027f1316e38b8">SEED</a>, <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(out_p, a, outbuf_size);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="comment">/* Not last block. Store directly to result buffer */</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a161e5e32461eaeb74bad1a262fc31113">hmac_sha_precomputed</a>(&amp;pre, out_p, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a955f504eccf76b4eb2489c0adab03121">A</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad350bae49f72ba58d73027f1316e38b8">SEED</a>, <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        out_p += MAC_size;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        outbuf_size -= MAC_size;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="comment">/* A(2) = HMAC_hash(secret, A(1)) */</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a161e5e32461eaeb74bad1a262fc31113">hmac_sha_precomputed</a>(&amp;pre, a, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a955f504eccf76b4eb2489c0adab03121">A</a>, <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor">#undef A</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#undef SECRET</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#undef SEED</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">  598</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keyword">const</span> <span class="keywordtype">char</span> *expected, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;{</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#aecf5d6000202e19c5831942dd4c87a87">bb_error_msg</a>(<span class="stringliteral">&quot;got bad TLS record (len:%d) while expecting %s&quot;</span>, len, expected);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">if</span> (len &gt; 0) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">if</span> (len &gt; 99)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            len = 99; <span class="comment">/* don&#39;t flood, a few lines should be enough */</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <a class="code" href="../../dc/d4d/libc_2include_2stdio_8h.html#ad9291335f34e874c8431285d705bc3aa">fprintf</a>(<a class="code" href="../../dc/d4d/libc_2include_2stdio_8h.html#a5ce35bd5ba5021fd3b2e951e8f497656">stderr</a>, <span class="stringliteral">&quot; %02x&quot;</span>, *<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>++);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            len--;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        } <span class="keywordflow">while</span> (len != 0);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#a0dbd8f58654dfb2a07a1944c18a4afe5">fputc</a>(<span class="charliteral">&#39;\n&#39;</span>, <a class="code" href="../../dc/d4d/libc_2include_2stdio_8h.html#a5ce35bd5ba5021fd3b2e951e8f497656">stderr</a>);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;}</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2686a68bb7c89e7b9d3612beb4360e11">  614</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5606771cd63cad022b13c591fecf4fde">tls_error_die</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">int</span> <a class="code" href="../../dd/d7b/powertop_8c.html#d4/d85/structline">line</a>)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;{</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af2f7e6ef152a4947a46b0a367ae69909">dump_tls_record</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a4d3816142588e0e452454e4760bcc0">ofs_to_buffered</a> + tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad069bd9aa4a41a4c95e408882a67ca1a">buffered_size</a>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a1992b68ae7d01f7da91e31e351ca3b33">bb_error_msg_and_die</a>(<span class="stringliteral">&quot;tls error at line %d cipher:%04x&quot;</span>, <a class="code" href="../../dd/d7b/powertop_8c.html#d4/d85/structline">line</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a1d74dab2b4a31237fec264b4ebb3ede6">cipher_id</a>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div>
<div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5606771cd63cad022b13c591fecf4fde">  619</a></span>&#160;<span class="preprocessor">#define tls_error_die(tls) tls_error_die(tls, __LINE__)</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="preprocessor">#if 0 </span><span class="comment">//UNUSED</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> tls_free_inbuf(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;{</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad069bd9aa4a41a4c95e408882a67ca1a">buffered_size</a> == 0) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <a class="code" href="../../d5/db0/dynlink_8c.html#a2c6efa7679f8cd9f61af96e105017560">free</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">inbuf_size</a> = 0;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> = <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;}</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3127dcb28fa0efcf6be6157085ce1dd6">  632</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3127dcb28fa0efcf6be6157085ce1dd6">tls_free_outbuf</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;{</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="../../d5/db0/dynlink_8c.html#a2c6efa7679f8cd9f61af96e105017560">free</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a>);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a42bf5406f0aa223cb210c2669a9ec40b">outbuf_size</a> = 0;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> = <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;}</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad08080727341a265d82ff2761fa7bddc">  639</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad08080727341a265d82ff2761fa7bddc">tls_get_outbuf</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;{</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> (len &gt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8e5b1766844eb48b2a9fdacb9ce26f14">TLS_MAX_OUTBUF</a>)</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    len += <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad6a2447a142236ed15d5c103c8d22075">OUTBUF_SFX</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a42bf5406f0aa223cb210c2669a9ec40b">outbuf_size</a> &lt; len) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a42bf5406f0aa223cb210c2669a9ec40b">outbuf_size</a> = len;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> = <a class="code" href="../../db/d0a/tre_8h.html#a40740062faf2d95d4935112447c464ef">xrealloc</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a>, len);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">return</span> tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;}</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3ecbfa237736e9525fb3bd26bba53f3f">  651</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3ecbfa237736e9525fb3bd26bba53f3f">tls_get_zeroed_outbuf</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;{</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordtype">void</span> *record = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad08080727341a265d82ff2761fa7bddc">tls_get_outbuf</a>(tls, len);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <a class="code" href="../../da/d68/apps_2base_2bash_2lib_2sh_2memset_8c.html#a19588d2006eb37347ebae632befc20e5">memset</a>(record, 0, len);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">return</span> record;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;}</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a398a3c9c7f69709d0f6473e82d8a3a67">  658</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a398a3c9c7f69709d0f6473e82d8a3a67">xwrite_encrypted_and_hmac_signed</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">unsigned</span> <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <span class="keywordtype">unsigned</span> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;{</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> *xhdr;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> padding_length;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    xhdr = (<span class="keywordtype">void</span>*)(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> - <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af60cb3c889da6403866b3087adf587c3">ALLOW_RSA_NULL_SHA256</a> <span class="comment">/* if &quot;no encryption&quot; can&#39;t be selected */</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;     || tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a1d74dab2b4a31237fec264b4ebb3ede6">cipher_id</a> != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae388fc0dbac04b3d5717fd447eaec61d">TLS_RSA_WITH_NULL_SHA256</a> <span class="comment">/* or if it wasn&#39;t selected */</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    ) {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        xhdr = (<span class="keywordtype">void</span>*)(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> - <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> - <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>); <span class="comment">/* place for IV */</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">type</a> = <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">proto_maj</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d34e2d988fc19f2480bab352b6376d0">proto_min</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">/* fake unencrypted record len for MAC calculation */</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; 8;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &amp; 0xff;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">/* Calculate MAC signature */</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a4035149b7cdecc1ceac5879991677acd">hmac</a>(tls, <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <span class="comment">/* result */</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2cdb203347dbcef4eca0eb64e34eaafb">client_write_MAC_key</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">TLS_MAC_SIZE</a>(tls),</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        &amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8c34aa7cb37e568a3c571396a1f7a819">write_seq64_be</a>, <span class="keyword">sizeof</span>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8c34aa7cb37e568a3c571396a1f7a819">write_seq64_be</a>),</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        xhdr, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>,</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>,</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    );</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8c34aa7cb37e568a3c571396a1f7a819">write_seq64_be</a> = <a class="code" href="../../de/d03/platform_8h.html#ab25ec83fd461ee2a3c98f6abdfad0e23">SWAP_BE64</a>(1 + <a class="code" href="../../de/d03/platform_8h.html#ab25ec83fd461ee2a3c98f6abdfad0e23">SWAP_BE64</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8c34aa7cb37e568a3c571396a1f7a819">write_seq64_be</a>));</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> += <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">TLS_MAC_SIZE</a>(tls);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// RFC 5246:</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">// 6.2.3.1.  Null or Standard Stream Cipher</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="comment">// Stream ciphers (including BulkCipherAlgorithm.null; see Appendix A.6)</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">// convert TLSCompressed.fragment structures to and from stream</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">// TLSCiphertext.fragment structures.</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">//    stream-ciphered struct {</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="comment">//        opaque content[TLSCompressed.length];</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="comment">//        opaque MAC[SecurityParameters.mac_length];</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="comment">//    } GenericStreamCipher;</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="comment">// The MAC is generated as:</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">//    MAC(MAC_write_key, seq_num +</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">//                          TLSCompressed.type +</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="comment">//                          TLSCompressed.version +</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">//                          TLSCompressed.length +</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="comment">//                          TLSCompressed.fragment);</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="comment">// where &quot;+&quot; denotes concatenation.</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="comment">// seq_num</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">//    The sequence number for this record.</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">// MAC</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">//    The MAC algorithm specified by SecurityParameters.mac_algorithm.</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">// Note that the MAC is computed before encryption.  The stream cipher</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">// encrypts the entire block, including the MAC.</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">//...</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="comment">// Appendix C.  Cipher Suite Definitions</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">//...</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// MAC       Algorithm    mac_length  mac_key_length</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="comment">// --------  -----------  ----------  --------------</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="comment">// SHA       HMAC-SHA1       20            20</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="comment">// SHA256    HMAC-SHA256     32            32</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af60cb3c889da6403866b3087adf587c3">ALLOW_RSA_NULL_SHA256</a></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;     &amp;&amp; tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a1d74dab2b4a31237fec264b4ebb3ede6">cipher_id</a> == <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae388fc0dbac04b3d5717fd447eaec61d">TLS_RSA_WITH_NULL_SHA256</a></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    ) {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="comment">/* No encryption, only signing */</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; 8;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &amp; 0xff;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2a404bab8b6e8c6c7d0a4039dd91b99b">dump_raw_out</a>(<span class="stringliteral">&quot;&gt;&gt; %s\n&quot;</span>, xhdr, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#a406e6e7d1c51da582c1e82632b1f2bce">xwrite</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#adcd945f007cfde4259ee212d57e5a472">ofd</a>, xhdr, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;wrote %u bytes (NULL crypt, SHA256 hash)\n&quot;</span>, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="comment">// 6.2.3.2.  CBC Block Cipher</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">// For block ciphers (such as 3DES or AES), the encryption and MAC</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">// functions convert TLSCompressed.fragment structures to and from block</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">// TLSCiphertext.fragment structures.</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">//    struct {</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="comment">//        opaque IV[SecurityParameters.record_iv_length];</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="comment">//        block-ciphered struct {</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="comment">//            opaque content[TLSCompressed.length];</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="comment">//            opaque MAC[SecurityParameters.mac_length];</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">//            uint8 padding[GenericBlockCipher.padding_length];</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="comment">//            uint8 padding_length;</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">//        };</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">//    } GenericBlockCipher;</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">//...</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">// IV</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">//    The Initialization Vector (IV) SHOULD be chosen at random, and</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">//    MUST be unpredictable.  Note that in versions of TLS prior to 1.1,</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">//    there was no IV field (...).  For block ciphers, the IV length is</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">//    of length SecurityParameters.record_iv_length, which is equal to the</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">//    SecurityParameters.block_size.</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// padding</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">//    Padding that is added to force the length of the plaintext to be</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="comment">//    an integral multiple of the block cipher&#39;s block length.</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="comment">// padding_length</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">//    The padding length MUST be such that the total size of the</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">//    GenericBlockCipher structure is a multiple of the cipher&#39;s block</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="comment">//    length.  Legal values range from zero to 255, inclusive.</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="comment">//...</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">// Appendix C.  Cipher Suite Definitions</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">//...</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">//                         Key      IV   Block</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">// Cipher        Type    Material  Size  Size</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="comment">// ------------  ------  --------  ----  -----</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">// AES_128_CBC   Block      16      16     16</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="comment">// AES_256_CBC   Block      32      16     16</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a59d1a3325c8c18009268226036a074a2">tls_get_random</a>(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> - <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>, <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>); <span class="comment">/* IV */</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;before crypt: 5 hdr + %u data + %u hash bytes\n&quot;</span>,</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> - <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">TLS_MAC_SIZE</a>(tls), <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">TLS_MAC_SIZE</a>(tls));</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="comment">/* Fill IV and padding in outbuf */</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">// RFC is talking nonsense:</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">//    &quot;Padding that is added to force the length of the plaintext to be</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="comment">//    an integral multiple of the block cipher&#39;s block length.&quot;</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">// WRONG. _padding+padding_length_, not just _padding_,</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">// pads the data.</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="comment">// IOW: padding_length is the last byte of padding[] array,</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">// contrary to what RFC depicts.</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="comment">// What actually happens is that there is always padding.</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">// If you need one byte to reach BLOCKSIZE, this byte is 0x00.</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// If you need two bytes, they are both 0x01.</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">// If you need three, they are 0x02,0x02,0x02. And so on.</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">// If you need no bytes to reach BLOCKSIZE, you have to pad a full</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">// BLOCKSIZE with bytes of value (BLOCKSIZE-1).</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">// It&#39;s ok to have more than minimum padding, but we do minimum.</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    padding_length = (~<a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>) &amp; (<a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a> - 1);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>[<a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>++] = padding_length; <span class="comment">/* padding */</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    } <span class="keywordflow">while</span> ((<a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &amp; (<a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a> - 1)) != 0);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="comment">/* Encrypt content+MAC+padding in place */</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="../../da/d19/tls__aes_8c.html#a34a82569675a176e57996083ad34608f">aes_cbc_encrypt</a>(</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        &amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a81d69881a03f3e32b71188d9c9835723">aes_encrypt</a>, <span class="comment">/* selects 128/256 */</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> - <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>, <span class="comment">/* IV */</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <span class="comment">/* plaintext */</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> <span class="comment">/* ciphertext */</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    );</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="comment">/* Write out */</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;writing 5 + %u IV + %u encrypted bytes, padding_length:0x%02x\n&quot;</span>,</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, padding_length);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> += <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>;     <span class="comment">/* + IV */</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; 8;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &amp; 0xff;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2a404bab8b6e8c6c7d0a4039dd91b99b">dump_raw_out</a>(<span class="stringliteral">&quot;&gt;&gt; %s\n&quot;</span>, xhdr, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a406e6e7d1c51da582c1e82632b1f2bce">xwrite</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#adcd945f007cfde4259ee212d57e5a472">ofd</a>, xhdr, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;wrote %u bytes\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;}</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">/* Example how GCM encryption combines nonce, aad, input and generates</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment"> * &quot;header | exp_nonce | encrypted output | tag&quot;:</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment"> * nonce:0d 6a 26 31 00 00 00 00 00 00 00 01 (implicit 4 bytes (derived from master secret), then explicit 8 bytes)</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment"> * aad:  00 00 00 00 00 00 00 01 17 03 03 00 1c</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment"> * in:   47 45 54 20 2f 69 6e 64 65 78 2e 68 74 6d 6c 20 48 54 54 50 2f 31 2e 30 0d 0a 0d 0a &quot;GET /index.html HTTP/1.0\r\n\r\n&quot; (0x1c bytes)</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment"> * out:  f7 8a b2 8f 78 0e f6 d5 76 17 2e b5 6d 46 59 56 8b 46 9f 0b d9 2c 35 28 13 66 19 be</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment"> * tag:  c2 86 ce 4a 50 4a d0 aa 50 b3 76 5c 49 2a 3f 33</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment"> * sent: 17 03 03 00 34|00 00 00 00 00 00 00 01|f7 8a b2 8f 78 0e f6 d5 76 17 2e b5 6d 46 59 56 8b 46 9f 0b d9 2c 35 28 13 66 19 be|c2 86 ce 4a 50 4a d0 aa 50 b3 76 5c 49 2a 3f 33</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment"> * .............................................^^ buf points here</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00825"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6f27a434f9d903a806798e640b84a24">  825</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6f27a434f9d903a806798e640b84a24">xwrite_encrypted_aesgcm</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">unsigned</span> <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <span class="keywordtype">unsigned</span> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;{</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="preprocessor">#define COUNTER(v) (*(uint32_t*)(v + 12))</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> aad[13 + 3] <a class="code" href="../../df/d79/tls_8h.html#aaec8c82c4cf6763030d4e6d0c96dd4fe">ALIGNED_long</a>;   <span class="comment">/* +3 creates [16] buffer, simplifying GHASH() */</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> nonce[12 + 4] <a class="code" href="../../df/d79/tls_8h.html#aaec8c82c4cf6763030d4e6d0c96dd4fe">ALIGNED_long</a>; <span class="comment">/* +4 creates space for AES block counter */</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> scratch[<a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>] <a class="code" href="../../df/d79/tls_8h.html#aaec8c82c4cf6763030d4e6d0c96dd4fe">ALIGNED_long</a>; <span class="comment">//[16]</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> authtag[<a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>] <a class="code" href="../../df/d79/tls_8h.html#aaec8c82c4cf6763030d4e6d0c96dd4fe">ALIGNED_long</a>; <span class="comment">//[16]</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> *xhdr;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordtype">unsigned</span> remaining;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a2095b9bffea4b2656950c6c0419edbf1">uint64_t</a> t64;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a>; <span class="comment">/* see above for the byte it points to */</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;xwrite_encrypted_aesgcm plaintext:%s\n&quot;</span>, <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    xhdr = (<span class="keywordtype">void</span>*)(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> - 8 - <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">type</a> = <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>; <span class="comment">/* do it here so that &quot;type&quot; param no longer used */</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    aad[8] = <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    aad[9] = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    aad[10] = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    aad[11] = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; 8;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="comment">/* set aad[12], and clear aad[13..15] */</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a148c12e9a5cdf45e8af24cdd4765306f">COUNTER</a>(aad) = <a class="code" href="../../de/d03/platform_8h.html#a3154d0c2e8d9f1dd3410e9408cad21a2">SWAP_LE32</a>(<a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &amp; 0xff);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(nonce, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8e61995c5e80de8de0758d4e3cd2d813">client_write_IV</a>, 4);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    t64 = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8c34aa7cb37e568a3c571396a1f7a819">write_seq64_be</a>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="../../de/d03/platform_8h.html#a903630c9a9341ff79b33bcdf3f133fb4">move_to_unaligned64</a>(nonce + 4, t64);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <a class="code" href="../../de/d03/platform_8h.html#a903630c9a9341ff79b33bcdf3f133fb4">move_to_unaligned64</a>(aad,       t64);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="../../de/d03/platform_8h.html#a903630c9a9341ff79b33bcdf3f133fb4">move_to_unaligned64</a>(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> - 8,   t64);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">/* seq64 is not used later in this func, can increment here */</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8c34aa7cb37e568a3c571396a1f7a819">write_seq64_be</a> = <a class="code" href="../../de/d03/platform_8h.html#ab25ec83fd461ee2a3c98f6abdfad0e23">SWAP_BE64</a>(1 + <a class="code" href="../../de/d03/platform_8h.html#ab25ec83fd461ee2a3c98f6abdfad0e23">SWAP_BE64</a>(t64));</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <a class="code" href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a> = 1;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    remaining = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">while</span> (remaining != 0) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <a class="code" href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a>++;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a148c12e9a5cdf45e8af24cdd4765306f">COUNTER</a>(nonce) = <a class="code" href="../../d8/d16/include_2arpa_2inet_8h.html#afa0e455458258ff4741c5c3b2c737756">htonl</a>(<a class="code" href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a>); <span class="comment">/* yes, first cnt here is 2 (!) */</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <a class="code" href="../../da/d19/tls__aes_8c.html#a7adc23b56bee623cd7a5414445e83000">aes_encrypt_one_block</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a81d69881a03f3e32b71188d9c9835723">aes_encrypt</a>, nonce, scratch);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a> = remaining &gt; <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a> ? <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a> : remaining;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a92c445bf59ecea2f4453d2d90d4abd75">xorbuf</a>(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, scratch, <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a>);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> += <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        remaining -= <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <a class="code" href="../../d5/dd2/tls__aesgcm_8c.html#ab44e9d0fcf31a177ee3a1d782dc2d386">aesgcm_GHASH</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a9ea11289d0d3d9ed7c24e05d45641e89">H</a>, aad, <span class="comment">/*sizeof(aad),*/</span> tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a>, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, authtag <span class="comment">/*, sizeof(authtag)*/</span>);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a148c12e9a5cdf45e8af24cdd4765306f">COUNTER</a>(nonce) = <a class="code" href="../../d8/d16/include_2arpa_2inet_8h.html#afa0e455458258ff4741c5c3b2c737756">htonl</a>(1);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <a class="code" href="../../da/d19/tls__aes_8c.html#a7adc23b56bee623cd7a5414445e83000">aes_encrypt_one_block</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a81d69881a03f3e32b71188d9c9835723">aes_encrypt</a>, nonce, scratch);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a58e6839560679f7f99491ed40f73231e">xorbuf_aligned_AES_BLOCK_SIZE</a>(authtag, scratch);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, authtag, <span class="keyword">sizeof</span>(authtag));</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160; </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="comment">/* Write out */</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    xhdr = (<span class="keywordtype">void</span>*)(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a> - 8 - <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> += 8 + <span class="keyword">sizeof</span>(authtag);</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment">/*xhdr-&gt;type = type; - already is */</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">proto_maj</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d34e2d988fc19f2480bab352b6376d0">proto_min</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; 8;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &amp; 0xff;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> += <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2a404bab8b6e8c6c7d0a4039dd91b99b">dump_raw_out</a>(<span class="stringliteral">&quot;&gt;&gt; %s\n&quot;</span>, xhdr, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a406e6e7d1c51da582c1e82632b1f2bce">xwrite</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#adcd945f007cfde4259ee212d57e5a472">ofd</a>, xhdr, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;wrote %u bytes\n&quot;</span>, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="preprocessor">#undef COUNTER</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;}</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a99d80378865343f69b5f50b1414fce94">  896</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a99d80378865343f69b5f50b1414fce94">xwrite_encrypted</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">unsigned</span> <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <span class="keywordtype">unsigned</span> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;{</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">if</span> (!(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2">ENCRYPTION_AESGCM</a>)) {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a398a3c9c7f69709d0f6473e82d8a3a67">xwrite_encrypted_and_hmac_signed</a>(tls, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6f27a434f9d903a806798e640b84a24">xwrite_encrypted_aesgcm</a>(tls, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>);</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;}</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; </div>
<div class="line"><a name="l00905"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aae81cd08d01440ba7f9489e3141aa349">  905</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aae81cd08d01440ba7f9489e3141aa349">xwrite_handshake_record</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">unsigned</span> <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;{</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> *xhdr = (<span class="keywordtype">void</span>*)(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> - <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">type</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a222955be70285ace97b0fffa2b082f5d">RECORD_TYPE_HANDSHAKE</a>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">proto_maj</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a>;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d34e2d988fc19f2480bab352b6376d0">proto_min</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a>;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; 8;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a> = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &amp; 0xff;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2a404bab8b6e8c6c7d0a4039dd91b99b">dump_raw_out</a>(<span class="stringliteral">&quot;&gt;&gt; %s\n&quot;</span>, xhdr, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a406e6e7d1c51da582c1e82632b1f2bce">xwrite</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#adcd945f007cfde4259ee212d57e5a472">ofd</a>, xhdr, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;wrote %u bytes\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;}</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa98352b3587a985366c092e548025daa">  920</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa98352b3587a985366c092e548025daa">xwrite_and_update_handshake_hash</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">unsigned</span> <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;{</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">if</span> (!(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a341620e2929e799f062087e23e49d5e1">ENCRYPT_ON_WRITE</a>)) {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aae81cd08d01440ba7f9489e3141aa349">xwrite_handshake_record</a>(tls, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="comment">/* Handshake hash does not include record headers */</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">outbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a859e8181c002d45232991f43512b7246">hash_handshake</a>(tls, <span class="stringliteral">&quot;&gt;&gt; hash:%s&quot;</span>, <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a99d80378865343f69b5f50b1414fce94">xwrite_encrypted</a>(tls, <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a222955be70285ace97b0fffa2b082f5d">RECORD_TYPE_HANDSHAKE</a>);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;}</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aaf98a8ebe0ffc4e0179476f6535a9c10">  934</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aaf98a8ebe0ffc4e0179476f6535a9c10">tls_has_buffered_record</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;{</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordtype">int</span> buffered = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad069bd9aa4a41a4c95e408882a67ca1a">buffered_size</a>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> *xhdr;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordtype">int</span> rec_size;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160; </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">if</span> (buffered &lt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>)</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    xhdr = (<span class="keywordtype">void</span>*)(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a4d3816142588e0e452454e4760bcc0">ofs_to_buffered</a>);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    rec_size = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + (0x100 * xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a> + xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a>);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">if</span> (buffered &lt; rec_size)</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">return</span> rec_size;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;}</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a58e7212b6d8f7451aeaa2c52883afa56">  949</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a58e7212b6d8f7451aeaa2c52883afa56">alert_text</a>(<span class="keywordtype">int</span> <a class="code" href="../../d0/d6b/compress_8c.html#a814f6dab3b0678113d97a3684282934a">code</a>)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;{</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">//10 unexpected_message</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="comment">//20 bad_record_mac</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="comment">//21 decryption_failed</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">//22 record_overflow</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">//30 decompression_failure</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="comment">//40 handshake_failure</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="comment">//41 no_certificate</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">//42 bad_certificate</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="comment">//43 unsupported_certificate</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="comment">//44 certificate_revoked</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="comment">//45 certificate_expired</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="comment">//46 certificate_unknown</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="comment">//47 illegal_parameter</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="comment">//48 unknown_ca</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="comment">//49 access_denied</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="comment">//50 decode_error</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">//51 decrypt_error</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="comment">//52 too_many_cids_requested</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="comment">//60 export_restriction</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">//70 protocol_version</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">//71 insufficient_security</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="comment">//80 internal_error</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="comment">//86 inappropriate_fallback</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="comment">//90 user_canceled</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="comment">//100 no_renegotiation</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">//109 missing_extension</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">//110 unsupported_extension</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">//111 certificate_unobtainable</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">//112 unrecognized_name</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">//113 bad_certificate_status_response</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">//114 bad_certificate_hash_value</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="comment">//115 unknown_psk_identity</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">//116 certificate_required</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">//120 no_application_protocol</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d6b/compress_8c.html#a814f6dab3b0678113d97a3684282934a">code</a>) {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">case</span> 20:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;bad MAC&quot;</span>;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">case</span> 50:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;decode error&quot;</span>;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">case</span> 40:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;handshake failure&quot;</span>;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">case</span> 51:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;decrypt error&quot;</span>;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordflow">case</span> 80:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;internal error&quot;</span>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">case</span> 112: <span class="keywordflow">return</span> <span class="stringliteral">&quot;unrecognized name&quot;</span>;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d4/db1/apps_2base_2bash_2lib_2sh_2snprintf_8c.html#a1ac817b5f23758eecbaa62dde9068b70">itoa</a>(<a class="code" href="../../d0/d6b/compress_8c.html#a814f6dab3b0678113d97a3684282934a">code</a>);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;}</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afc398ad29c76454f6a4ae795a471881b">  996</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afc398ad29c76454f6a4ae795a471881b">tls_aesgcm_decrypt</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, <span class="keywordtype">int</span> <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;{</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="preprocessor">#define COUNTER(v) (*(uint32_t*)(v + 12))</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">//uint8_t aad[13 + 3] ALIGNED_long; /* +3 creates [16] buffer, simplifying GHASH() */</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> nonce[12 + 4] <a class="code" href="../../df/d79/tls_8h.html#aaec8c82c4cf6763030d4e6d0c96dd4fe">ALIGNED_long</a>; <span class="comment">/* +4 creates space for AES block counter */</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> scratch[<a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>] <a class="code" href="../../df/d79/tls_8h.html#aaec8c82c4cf6763030d4e6d0c96dd4fe">ALIGNED_long</a>; <span class="comment">//[16]</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="comment">//uint8_t authtag[AES_BLOCK_SIZE] ALIGNED_long; //[16]</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordtype">unsigned</span> remaining;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a>;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="comment">//memcpy(aad, buf, 8);</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="comment">//aad[8] = type;</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="comment">//aad[9] = TLS_MAJ;</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="comment">//aad[10] = TLS_MIN;</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">//aad[11] = size &gt;&gt; 8;</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment"></span>    <span class="comment">//COUNTER(aad) = SWAP_LE32(size &amp; 0xff);</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(nonce,     tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8a2e906eabcc782224d0052ccd982bac">server_write_IV</a>, 4);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(nonce + 4, <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, 8);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <a class="code" href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a> = 1;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    remaining = <a class="code" href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordflow">while</span> (remaining != 0) {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a>;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <a class="code" href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a>++;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a148c12e9a5cdf45e8af24cdd4765306f">COUNTER</a>(nonce) = <a class="code" href="../../d8/d16/include_2arpa_2inet_8h.html#afa0e455458258ff4741c5c3b2c737756">htonl</a>(<a class="code" href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a>); <span class="comment">/* yes, first cnt here is 2 (!) */</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <a class="code" href="../../da/d19/tls__aes_8c.html#a7adc23b56bee623cd7a5414445e83000">aes_encrypt_one_block</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a88fa0c83bbd38b4af978843d8a48070e">aes_decrypt</a>, nonce, scratch);</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a> = remaining &gt; <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a> ? <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a> : remaining;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab517f4a374d088f9545c1af5136a20e1">xorbuf3</a>(<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, scratch, <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> + 8, <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a>);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> += <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a>;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        remaining -= <a class="code" href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a>;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="comment">//aesgcm_GHASH(tls-&gt;H, aad, tls-&gt;inbuf + RECHDR_LEN, size, authtag);</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="comment">//COUNTER(nonce) = htonl(1);</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="comment">//aes_encrypt_one_block(&amp;tls-&gt;aes_encrypt, nonce, scratch);</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="comment">//xorbuf_aligned_AES_BLOCK_SIZE(authtag, scratch);</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="comment">//memcmp(buf, authtag, sizeof(authtag)) || DIE(&quot;HASH DOES NOT MATCH!&quot;);</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="preprocessor">#undef COUNTER</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;}</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160; </div>
<div class="line"><a name="l01041"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ced00f2b51163b6af88d6de7673cebc"> 1041</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ced00f2b51163b6af88d6de7673cebc">tls_xread_record</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keyword">const</span> <span class="keywordtype">char</span> *expected)</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;{</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> *xhdr;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordtype">int</span> sz;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; again:</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;ofs_to_buffered:%u buffered_size:%u\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a4d3816142588e0e452454e4760bcc0">ofs_to_buffered</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad069bd9aa4a41a4c95e408882a67ca1a">buffered_size</a>);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad069bd9aa4a41a4c95e408882a67ca1a">buffered_size</a>;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> != 0) {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <a class="code" href="../../dc/da4/libc_2include_2string_8h.html#a802c986820d3866639922b6bc9484f90">memmove</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a4d3816142588e0e452454e4760bcc0">ofs_to_buffered</a>, <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a>);</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="comment">//dbg(&quot;&lt;&lt; remaining at %d [%d] &quot;, tls-&gt;ofs_to_buffered, total);</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="comment">//dump_raw_in(&quot;&lt;&lt; %s\n&quot;, tls-&gt;inbuf, total);</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <a class="code" href="../../d7/d8c/libc_2include_2errno_8h.html#ab03f640d90fbc5bcb75285d08a0f25ed">errno</a> = 0;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">MAX_INBUF</a>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="keywordtype">int</span> rem;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> &gt;= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> &amp;&amp; <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a> == <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">MAX_INBUF</a>) {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            xhdr = (<span class="keywordtype">void</span>*)tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + (0x100 * xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a> + xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a>);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160; </div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a> &gt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">MAX_INBUF</a> <span class="comment">/* malformed input (too long) */</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;             || xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">proto_maj</a> != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;             || xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d34e2d988fc19f2480bab352b6376d0">proto_min</a> != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            ) {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                sz = <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> &lt; <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a> ? <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> : <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a>;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, expected, sz);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;xhdr type:%d ver:%d.%d len:%d\n&quot;</span>,</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">type</a>, xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">proto_maj</a>, xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d34e2d988fc19f2480bab352b6376d0">proto_min</a>,</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                0x100 * xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">len16_hi</a> + xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">len16_lo</a></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            );</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        }</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="comment">/* if total &gt;= target, we have a full packet (and possibly more)... */</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> - <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a> &gt;= 0)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="comment">/* input buffer is grown only as needed */</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        rem = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">inbuf_size</a> - <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a>;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="keywordflow">if</span> (rem == 0) {</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">inbuf_size</a> += <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">MAX_INBUF</a> / 8;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">inbuf_size</a> &gt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">MAX_INBUF</a>)</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">inbuf_size</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">MAX_INBUF</a>;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;inbuf_size:%d\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">inbuf_size</a>);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            rem = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">inbuf_size</a> - <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> = <a class="code" href="../../db/d0a/tre_8h.html#a40740062faf2d95d4935112447c464ef">xrealloc</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">inbuf_size</a>);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        }</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        sz = <a class="code" href="../../d7/dd7/libbb_8h.html#afd9749b5c9728a4e5d0f2c00663a89af">safe_read</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a24e6feeade1f420ae684358c71ede5cc">ifd</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a>, rem);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordflow">if</span> (sz &lt;= 0) {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="keywordflow">if</span> (sz == 0 &amp;&amp; <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> == 0) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                <span class="comment">/* &quot;Abrupt&quot; EOF, no TLS shutdown (seen from kernel.org) */</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;EOF (without TLS shutdown) from peer\n&quot;</span>);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad069bd9aa4a41a4c95e408882a67ca1a">buffered_size</a> = 0;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#ad3b9a4415e25d8fb7e9980347357dc95">bb_perror_msg_and_die</a>(<span class="stringliteral">&quot;short read, have only %d&quot;</span>, <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a333b9382c44248475f73712fea669957">dump_raw_in</a>(<span class="stringliteral">&quot;&lt;&lt; %s\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a>, sz);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> += sz;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad069bd9aa4a41a4c95e408882a67ca1a">buffered_size</a> = <a class="code" href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a> - <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a>;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a5a4d3816142588e0e452454e4760bcc0">ofs_to_buffered</a> = <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a>;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="comment">//dbg(&quot;&lt;&lt; stashing at %d [%d] &quot;, tls-&gt;ofs_to_buffered, tls-&gt;buffered_size);</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="comment">//dump_hex(&quot;&lt;&lt; %s\n&quot;, tls-&gt;inbuf + tls-&gt;ofs_to_buffered, tls-&gt;buffered_size);</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    sz = <a class="code" href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a> - <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="comment">/* Needs to be decrypted? */</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">min_encrypted_len_on_read</a> != 0) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="keywordflow">if</span> (sz &lt; (<span class="keywordtype">int</span>)tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">min_encrypted_len_on_read</a>)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#a1992b68ae7d01f7da91e31e351ca3b33">bb_error_msg_and_die</a>(<span class="stringliteral">&quot;bad encrypted len:%u&quot;</span>, sz);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2">ENCRYPTION_AESGCM</a>) {</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            <span class="comment">/* AESGCM */</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            sz -= 8 + <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>; <span class="comment">/* we will overwrite nonce, drop hash */</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afc398ad29c76454f6a4ae795a471881b">tls_aesgcm_decrypt</a>(tls, <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>, sz);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;encrypted size:%u\n&quot;</span>, sz);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">min_encrypted_len_on_read</a> &gt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">TLS_MAC_SIZE</a>(tls)) {</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            <span class="comment">/* AES+SHA */</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            <span class="keywordtype">int</span> padding_len;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;            <span class="keywordflow">if</span> (sz &amp; (<a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>-1))</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                <a class="code" href="../../d7/dd7/libbb_8h.html#a1992b68ae7d01f7da91e31e351ca3b33">bb_error_msg_and_die</a>(<span class="stringliteral">&quot;bad encrypted len:%u&quot;</span>, sz);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <span class="comment">/* Decrypt content+MAC+padding, moving it over IV in the process */</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            sz -= <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>; <span class="comment">/* we will overwrite IV now */</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            <a class="code" href="../../da/d19/tls__aes_8c.html#ada549d14f782d402febbb2c5a5099afa">aes_cbc_decrypt</a>(</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                &amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a88fa0c83bbd38b4af978843d8a48070e">aes_decrypt</a>, <span class="comment">/* selects 128/256 */</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>, <span class="comment">/* IV */</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> + <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>, sz, <span class="comment">/* ciphertext */</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> <span class="comment">/* plaintext */</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            );</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            padding_len = <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[sz - 1];</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;encrypted size:%u type:0x%02x padding_length:0x%02x\n&quot;</span>, sz, <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[0], padding_len);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            padding_len++;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            sz -= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">TLS_MAC_SIZE</a>(tls) + padding_len; <span class="comment">/* drop MAC and padding */</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            <span class="comment">/* if nonzero, then it&#39;s TLS_RSA_WITH_NULL_SHA256: drop MAC */</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            <span class="comment">/* else: no encryption yet on input, subtract zero = NOP */</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            sz -= tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">min_encrypted_len_on_read</a>;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    }</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keywordflow">if</span> (sz &lt; 0)</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#aa7873f1b32526ae11612363558a2aa90">bb_simple_error_msg_and_die</a>(<span class="stringliteral">&quot;encrypted data too short&quot;</span>);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160; </div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="comment">//dump_hex(&quot;&lt;&lt; %s\n&quot;, tls-&gt;inbuf, RECHDR_LEN + sz);</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160; </div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    xhdr = (<span class="keywordtype">void</span>*)tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <a class="code" href="../../db/dd4/sm__loop_8c.html#a45a537235d3d9968fa1c984289b3c3c6">if</a> (xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">type</a> == <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1220507db99ba87bb7b45b03ec9b9f0b">RECORD_TYPE_ALERT</a> &amp;&amp; sz &gt;= 2) {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;ALERT size:%d level:%d description:%d\n&quot;</span>, sz, <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[0], <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[1]);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[0] == 2) { <span class="comment">/* fatal */</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#a1992b68ae7d01f7da91e31e351ca3b33">bb_error_msg_and_die</a>(<span class="stringliteral">&quot;TLS %s from peer (alert code %d): %s&quot;</span>,</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                <span class="stringliteral">&quot;error&quot;</span>,</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                <a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[1], <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a58e7212b6d8f7451aeaa2c52883afa56">alert_text</a>(<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[1])</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            );</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[0] == 1) { <span class="comment">/* warning */</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a>[1] == 0) { <span class="comment">/* &quot;close_notify&quot; warning: it&#39;s EOF */</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;EOF (TLS encoded) from peer\n&quot;</span>);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                sz = 0;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            }</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">//This possibly needs to be cached and shown only if</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">//a fatal alert follows</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">//          bb_error_msg(&quot;TLS %s from peer (alert code %d): %s&quot;,</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">//              &quot;warning&quot;,</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">//              p[1], alert_text(p[1])</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">//          );</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            <span class="comment">/* discard it, get next record */</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            <span class="keywordflow">goto</span> again;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        }</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <span class="comment">/* p[0] not 1 or 2: not defined in protocol */</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        sz = 0;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">/* RFC 5246 is not saying it explicitly, but sha256 hash</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">     * in our FINISHED record must include data of incoming packets too!</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>[0] == <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a222955be70285ace97b0fffa2b082f5d">RECORD_TYPE_HANDSHAKE</a></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">/* HANDSHAKE HASH: */</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="comment">// &amp;&amp; do_we_know_which_hash_to_use /* server_hello() might not know it in the future! */</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    ) {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a859e8181c002d45232991f43512b7246">hash_handshake</a>(tls, <span class="stringliteral">&quot;&lt;&lt; hash:%s&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>, sz);</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>:</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;got block len:%u\n&quot;</span>, sz);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordflow">return</span> sz;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;}</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160; </div>
<div class="line"><a name="l01198"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3737e635cffa96318a9f77a759b21cef"> 1198</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3737e635cffa96318a9f77a759b21cef">binary_to_pstm</a>(<a class="code" href="../../d4/de5/tls__pstm_8h.html#db/d47/structpstm__int">pstm_int</a> *pstm_n, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *bin_ptr, <span class="keywordtype">unsigned</span> len)</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;{</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <a class="code" href="../../d4/de5/tls__pstm_8h.html#a361367bd256cf6bb7e1b0ce3c359eb2f">pstm_init_for_read_unsigned_bin</a>(<span class="comment">/*pool:*/</span> <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pstm_n, len);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <a class="code" href="../../d2/db1/tls__pstm_8c.html#a19b8a04f00f931070fd700037d4f6017">pstm_read_unsigned_bin</a>(pstm_n, bin_ptr, len);</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="comment">//return bin_ptr + len;</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;}</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment"> * DER parsing routines</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a32829e624b2b9c8af7f8ae93ac1885cb"> 1208</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a32829e624b2b9c8af7f8ae93ac1885cb">get_der_len</a>(<a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> **bodyp, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *der, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>)</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;{</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="keywordtype">unsigned</span> len, len1;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a> - der &lt; 2)</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">//  if ((der[0] &amp; 0x1f) == 0x1f) /* not single-byte item code? */</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment">//      xfunc_die();</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    len = der[1]; <span class="comment">/* maybe it&#39;s short len */</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordflow">if</span> (len &gt;= 0x80) {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        <span class="comment">/* no, it&#39;s long */</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160; </div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">if</span> (len == 0x80 || <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a> - der &lt; (<span class="keywordtype">int</span>)(len - 0x7e)) {</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            <span class="comment">/* 0x80 is &quot;0 bytes of len&quot;, invalid DER: must use short len if can */</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;            <span class="comment">/* need 3 or 4 bytes for 81, 82 */</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160; </div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        len1 = der[2]; <span class="comment">/* if (len == 0x81) it&#39;s &quot;ii 81 xx&quot;, fetch xx */</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        <span class="keywordflow">if</span> (len &gt; 0x82) {</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;            <span class="comment">/* &gt;0x82 is &quot;3+ bytes of len&quot;, should not happen realistically */</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        }</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">if</span> (len == 0x82) { <span class="comment">/* it&#39;s &quot;ii 82 xx yy&quot; */</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            len1 = 0x100*len1 + der[3];</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            der += 1; <span class="comment">/* skip [yy] */</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        }</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        der += 1; <span class="comment">/* skip [xx] */</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        len = len1;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">//      if (len &lt; 0x80)</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">//          xfunc_die(); /* invalid DER: must use short len if can */</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    }</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    der += 2; <span class="comment">/* skip [code]+[1byte] */</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160; </div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a> - der &lt; (<span class="keywordtype">int</span>)len)</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    *bodyp = der;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;}</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a28b6aee24119df52de6eafae6008208e"> 1250</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a28b6aee24119df52de6eafae6008208e">enter_der_item</a>(<a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *der, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> **endp)</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;{</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *new_der;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordtype">unsigned</span> len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a32829e624b2b9c8af7f8ae93ac1885cb">get_der_len</a>(&amp;new_der, der, *endp);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2b239b202d79a7f1ce309d36d4221d31">dbg_der</a>(<span class="stringliteral">&quot;entered der @%p:0x%02x len:%u inner_byte @%p:0x%02x\n&quot;</span>, der, der[0], len, new_der, new_der[0]);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="comment">/* Move &quot;end&quot; position to cover only this item */</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    *endp = new_der + len;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">return</span> new_der;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;}</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988"> 1260</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(<a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *der, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;{</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *new_der;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordtype">unsigned</span> len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a32829e624b2b9c8af7f8ae93ac1885cb">get_der_len</a>(&amp;new_der, der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>);</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="comment">/* Skip body */</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    new_der += len;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2b239b202d79a7f1ce309d36d4221d31">dbg_der</a>(<span class="stringliteral">&quot;skipped der 0x%02x, next byte 0x%02x\n&quot;</span>, der[0], new_der[0]);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordflow">return</span> new_der;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;}</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af73b278cbf5e785605d467071ea344d8"> 1270</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af73b278cbf5e785605d467071ea344d8">der_binary_to_pstm</a>(<a class="code" href="../../d4/de5/tls__pstm_8h.html#db/d47/structpstm__int">pstm_int</a> *pstm_n, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *der, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;{</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *bin_ptr;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordtype">unsigned</span> len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a32829e624b2b9c8af7f8ae93ac1885cb">get_der_len</a>(&amp;bin_ptr, der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>);</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160; </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2b239b202d79a7f1ce309d36d4221d31">dbg_der</a>(<span class="stringliteral">&quot;binary bytes:%u, first:0x%02x\n&quot;</span>, len, bin_ptr[0]);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3737e635cffa96318a9f77a759b21cef">binary_to_pstm</a>(pstm_n, bin_ptr, len);</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;}</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a36ef8ca992ba3de99b5c988d86211275"> 1279</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a36ef8ca992ba3de99b5c988d86211275">find_key_in_der_cert</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *der, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;{</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">/* Certificate is a DER-encoded data structure. Each DER element has a length,</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment"> * which makes it easy to skip over large compound elements of any complexity</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment"> * without parsing them. Example: partial decode of kernel.org certificate:</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment"> *  SEQ 0x05ac/1452 bytes (Certificate): 308205ac</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment"> *    SEQ 0x0494/1172 bytes (tbsCertificate): 30820494</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment"> *      [ASN_CONTEXT_SPECIFIC | ASN_CONSTRUCTED | 0] 3 bytes: a003</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment"> *        INTEGER (version): 0201 02</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment"> *      INTEGER 0x11 bytes (serialNumber): 0211 00 9f85bf664b0cddafca508679501b2be4</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment"> *      //^^^^^^note: matrixSSL also allows [ASN_CONTEXT_SPECIFIC | ASN_PRIMITIVE | 2] = 0x82 type</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment"> *      SEQ 0x0d bytes (signatureAlgo): 300d</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment"> *        OID 9 bytes: 0609 2a864886f70d01010b (OID_SHA256_RSA_SIG 42.134.72.134.247.13.1.1.11)</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment"> *        NULL: 0500</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment"> *      SEQ 0x5f bytes (issuer): 305f</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment"> *        SET 11 bytes: 310b</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment"> *          SEQ 9 bytes: 3009</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment"> *            OID 3 bytes: 0603 550406</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"> *            Printable string &quot;FR&quot;: 1302 4652</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment"> *        SET 14 bytes: 310e</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment"> *          SEQ 12 bytes: 300c</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment"> *            OID 3 bytes: 0603 550408</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment"> *            Printable string &quot;Paris&quot;: 1305 5061726973</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment"> *        SET 14 bytes: 310e</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment"> *          SEQ 12 bytes: 300c</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment"> *            OID 3 bytes: 0603 550407</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment"> *            Printable string &quot;Paris&quot;: 1305 5061726973</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment"> *        SET 14 bytes: 310e</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment"> *          SEQ 12 bytes: 300c</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment"> *            OID 3 bytes: 0603 55040a</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment"> *            Printable string &quot;Gandi&quot;: 1305 47616e6469</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment"> *        SET 32 bytes: 3120</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment"> *          SEQ 30 bytes: 301e</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment"> *            OID 3 bytes: 0603 550403</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment"> *            Printable string &quot;Gandi Standard SSL CA 2&quot;: 1317 47616e6469205374616e646172642053534c2043412032</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment"> *      SEQ 30 bytes (validity): 301e</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment"> *        TIME &quot;161011000000Z&quot;: 170d 3136313031313030303030305a</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment"> *        TIME &quot;191011235959Z&quot;: 170d 3139313031313233353935395a</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment"> *      SEQ 0x5b/91 bytes (subject): 305b //I did not decode this</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment"> *          3121301f060355040b1318446f6d61696e20436f</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment"> *          6e74726f6c2056616c6964617465643121301f06</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment"> *          0355040b1318506f73697469766553534c204d75</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment"> *          6c74692d446f6d61696e31133011060355040313</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment"> *          0a6b65726e656c2e6f7267</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment"> *      SEQ 0x01a2/418 bytes (subjectPublicKeyInfo): 308201a2</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment"> *        SEQ 13 bytes (algorithm): 300d</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment"> *          OID 9 bytes: 0609 2a864886f70d010101 (OID_RSA_KEY_ALG 42.134.72.134.247.13.1.1.1)</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment"> *          NULL: 0500</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment"> *        BITSTRING 0x018f/399 bytes (publicKey): 0382018f</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment"> *          ????: 00</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment"> *          //after the zero byte, it appears key itself uses DER encoding:</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment"> *          SEQ 0x018a/394 bytes: 3082018a</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment"> *            INTEGER 0x0181/385 bytes (modulus): 02820181</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment"> *                  00b1ab2fc727a3bef76780c9349bf3</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment"> *                  ...24 more blocks of 15 bytes each...</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment"> *                  90e895291c6bc8693b65</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment"> *            INTEGER 3 bytes (exponent): 0203 010001</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment"> *      [ASN_CONTEXT_SPECIFIC | ASN_CONSTRUCTED | 0x3] 0x01e5 bytes (X509v3 extensions): a38201e5</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment"> *        SEQ 0x01e1 bytes: 308201e1</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment"> *        ...</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment"> * Certificate is a sequence of three elements:</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment"> *  tbsCertificate (SEQ)</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment"> *  signatureAlgorithm (AlgorithmIdentifier)</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment"> *  signatureValue (BIT STRING)</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment"> * In turn, tbsCertificate is a sequence of:</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment"> *  version</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment"> *  serialNumber</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment"> *  signatureAlgo (AlgorithmIdentifier)</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment"> *  issuer (Name, has complex structure)</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment"> *  validity (Validity, SEQ of two Times)</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment"> *  subject (Name)</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment"> *  subjectPublicKeyInfo (SEQ)</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment"> *  ...</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment"> * subjectPublicKeyInfo is a sequence of:</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment"> *  algorithm (AlgorithmIdentifier)</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment"> *  publicKey (BIT STRING)</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment"> * We need Certificate.tbsCertificate.subjectPublicKeyInfo.publicKey</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment"> * Example of an ECDSA key:</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment"> *      SEQ 0x59 bytes (subjectPublicKeyInfo): 3059</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment"> *        SEQ 0x13 bytes (algorithm): 3013</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment"> *          OID 7 bytes: 0607 2a8648ce3d0201   (OID_ECDSA_KEY_ALG 42.134.72.206.61.2.1)</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment"> *          OID 8 bytes: 0608 2a8648ce3d030107 (OID_EC_prime256v1 42.134.72.206.61.3.1.7)</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment"> *        BITSTRING 0x42 bytes (publicKey): 0342</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment"> *          0004 53af f65e 50cc 7959 7e29 0171 c75c</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment"> *          7335 e07d f45b 9750 b797 3a38 aebb 2ac6</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment"> *          8329 2748 e77e 41cb d482 2ce6 05ec a058</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment"> *          f3ab d561 2f4c d845 9ad3 7252 e3de bd3b</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment"> *          9012</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a> = der + len;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160; </div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="comment">/* enter &quot;Certificate&quot; item: [der, end) will be only Cert */</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a28b6aee24119df52de6eafae6008208e">enter_der_item</a>(der, &amp;<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>);</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160; </div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="comment">/* enter &quot;tbsCertificate&quot; item: [der, end) will be only tbsCert */</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a28b6aee24119df52de6eafae6008208e">enter_der_item</a>(der, &amp;<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>);</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160; </div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">     * Skip version field only if it is present. For a v1 certificate, the</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">     * version field won&#39;t be present since v1 is the default value for the</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">     * version field and fields with default values should be omitted (see</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">     * RFC 5280 sections 4.1 and 4.1.2.1). If the version field is present</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">     * it will have a tag class of 2 (context-specific), bit 6 as 1</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">     * (constructed), and a tag number of 0 (see ITU-T X.690 sections 8.1.2</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">     * and 8.14).</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="comment">/* bits 7-6: 10 */</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="comment">/* bit 5: 1 */</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="comment">/* bits 4-0: 00000 */</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordflow">if</span> (der[0] == 0xa0)</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* version */</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160; </div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="comment">/* skip up to subjectPublicKeyInfo */</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* serialNumber */</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* signatureAlgo */</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* issuer */</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* validity */</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* subject */</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="comment">/* enter subjectPublicKeyInfo */</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a28b6aee24119df52de6eafae6008208e">enter_der_item</a>(der, &amp;<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>);</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    { <span class="comment">/* check subjectPublicKeyInfo.algorithm */</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> OID_RSA_KEY_ALG[] <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6fdabf8c5e75c237e9c930b1ec6dbd1a">ALIGN1</a> = {</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;            0x30,0x0d, <span class="comment">// SEQ 13 bytes</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            0x06,0x09, 0x2a,0x86,0x48,0x86,0xf7,0x0d,0x01,0x01,0x01, <span class="comment">//OID_RSA_KEY_ALG 42.134.72.134.247.13.1.1.1</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;            <span class="comment">//0x05,0x00, // NULL</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        };</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> OID_ECDSA_KEY_ALG[] <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6fdabf8c5e75c237e9c930b1ec6dbd1a">ALIGN1</a> = {</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            0x30,0x13, <span class="comment">// SEQ 0x13 bytes</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;            0x06,0x07, 0x2a,0x86,0x48,0xce,0x3d,0x02,0x01,      <span class="comment">//OID_ECDSA_KEY_ALG 42.134.72.206.61.2.1</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <span class="comment">//allow any curve code for now...</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="comment">//  0x06,0x08, 0x2a,0x86,0x48,0xce,0x3d,0x03,0x01,0x07, //OID_EC_prime256v1 42.134.72.206.61.3.1.7</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;            <span class="comment">//RFC 3279:</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            <span class="comment">//42.134.72.206.61.3     is ellipticCurve</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;            <span class="comment">//42.134.72.206.61.3.0   is c-TwoCurve</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            <span class="comment">//42.134.72.206.61.3.1   is primeCurve</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;            <span class="comment">//42.134.72.206.61.3.1.7 is curve_secp256r1</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        };</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/d32/musl_2include_2string_8h.html#a0849c52baadd8269575bc57e2273d862">memcmp</a>(der, OID_RSA_KEY_ALG, <span class="keyword">sizeof</span>(OID_RSA_KEY_ALG)) == 0) {</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;RSA key\n&quot;</span>);</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> |= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ac39e3e35406c535eefd6407179d18a8d">GOT_CERT_RSA_KEY_ALG</a>;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/d32/musl_2include_2string_8h.html#a0849c52baadd8269575bc57e2273d862">memcmp</a>(der, OID_ECDSA_KEY_ALG, <span class="keyword">sizeof</span>(OID_ECDSA_KEY_ALG)) == 0) {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;ECDSA key\n&quot;</span>);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            <span class="comment">//UNUSED: tls-&gt;flags |= GOT_CERT_ECDSA_KEY_ALG;</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#aa7873f1b32526ae11612363558a2aa90">bb_simple_error_msg_and_die</a>(<span class="stringliteral">&quot;not RSA or ECDSA cert&quot;</span>);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    }</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160; </div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ac39e3e35406c535eefd6407179d18a8d">GOT_CERT_RSA_KEY_ALG</a>) {</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        <span class="comment">/* parse RSA key: */</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="comment">//based on getAsnRsaPubKey(), pkcs1ParsePrivBin() is also of note</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        <span class="comment">/* skip subjectPublicKeyInfo.algorithm */</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="comment">/* enter subjectPublicKeyInfo.publicKey */</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="comment">//die_if_not_this_der_type(der, end, 0x03); /* must be BITSTRING */</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a28b6aee24119df52de6eafae6008208e">enter_der_item</a>(der, &amp;<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160; </div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;key bytes:%u, first:0x%02x\n&quot;</span>, (<span class="keywordtype">int</span>)(<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a> - der), der[0]);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a> - der &lt; 14)</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <span class="comment">/* example format:</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">         * ignore bits: 00</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">         * SEQ 0x018a/394 bytes: 3082018a</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">         *   INTEGER 0x0181/385 bytes (modulus): 02820181 XX...XXX</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment">         *   INTEGER 3 bytes (exponent): 0203 010001</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="keywordflow">if</span> (*der != 0) <span class="comment">/* &quot;ignore bits&quot;, should be 0 */</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a>();</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        der++;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a28b6aee24119df52de6eafae6008208e">enter_der_item</a>(der, &amp;<a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* enter SEQ */</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <span class="comment">/* memset(tls-&gt;hsd-&gt;server_rsa_pub_key, 0, sizeof(tls-&gt;hsd-&gt;server_rsa_pub_key)); - already is */</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af73b278cbf5e785605d467071ea344d8">der_binary_to_pstm</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">server_rsa_pub_key</a>.<a class="code" href="../../d4/df3/tls__rsa_8h.html#aed5d7d3cfb979efaa3c34f6bf311cee8">N</a>, der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* modulus */</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        der = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a>(der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>);</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af73b278cbf5e785605d467071ea344d8">der_binary_to_pstm</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">server_rsa_pub_key</a>.<a class="code" href="../../d4/df3/tls__rsa_8h.html#a142358ea657b08ae6cf5525bb092f12c">e</a>, der, <a class="code" href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a>); <span class="comment">/* exponent */</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">server_rsa_pub_key</a>.<a class="code" href="../../d4/df3/tls__rsa_8h.html#a8f2f8a55979096b94b0a7658a756c484">size</a> = <a class="code" href="../../d2/db1/tls__pstm_8c.html#aa9328c5801bb852e3fd2170bb33598e6">pstm_unsigned_bin_size</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">server_rsa_pub_key</a>.<a class="code" href="../../d4/df3/tls__rsa_8h.html#aed5d7d3cfb979efaa3c34f6bf311cee8">N</a>);</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;server_rsa_pub_key.size:%d\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">server_rsa_pub_key</a>.<a class="code" href="../../d4/df3/tls__rsa_8h.html#a8f2f8a55979096b94b0a7658a756c484">size</a>);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="comment">/* else: ECDSA key. It is not used for generating encryption keys,</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">     * it is used only to sign the EC public key (which comes in ServerKey message).</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment">     * Since we do not verify cert validity, verifying signature on EC public key</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">     * wouldn&#39;t add any security. Thus, we do nothing here.</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;}</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160; </div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment"> * TLS Handshake routines</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac3d09a13305957afd7599d4f92dbf0bd"> 1471</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac3d09a13305957afd7599d4f92dbf0bd">tls_xread_handshake_block</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">int</span> min_len)</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;{</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> *xhdr;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordtype">int</span> len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ced00f2b51163b6af88d6de7673cebc">tls_xread_record</a>(tls, <span class="stringliteral">&quot;handshake record&quot;</span>);</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160; </div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    xhdr = (<span class="keywordtype">void</span>*)tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <a class="code" href="../../db/dd4/sm__loop_8c.html#a45a537235d3d9968fa1c984289b3c3c6">if</a> (len &lt; min_len</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;     || xhdr-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">type</a> != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a222955be70285ace97b0fffa2b082f5d">RECORD_TYPE_HANDSHAKE</a></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    ) {</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;handshake record&quot;</span>, len);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;got HANDSHAKE\n&quot;</span>);</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;}</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; </div>
<div class="line"><a name="l01486"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2acf5a199836fd199ff326e1446dac84"> 1486</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d03/platform_8h.html#aa1dec568e79152c892dcf63f445cbd7a">ALWAYS_INLINE</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2acf5a199836fd199ff326e1446dac84">fill_handshake_record_hdr</a>(<span class="keywordtype">void</span> *<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, <span class="keywordtype">unsigned</span> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>, <span class="keywordtype">unsigned</span> len)</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;{</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keyword">struct </span>handshake_hdr {</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> len24_hi, len24_mid, len24_lo;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    } *<a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a> = <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    len -= 4;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>-&gt;type = <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>-&gt;len24_hi  = len &gt;&gt; 16;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>-&gt;len24_mid = len &gt;&gt; 8;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <a class="code" href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a>-&gt;len24_lo  = len &amp; 0xff;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;}</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160; </div>
<div class="line"><a name="l01500"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a88d1fbaaaab3a6bf00fc377c8bade1e3"> 1500</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a88d1fbaaaab3a6bf00fc377c8bade1e3">send_client_hello_and_alloc_hsd</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keyword">const</span> <span class="keywordtype">char</span> *sni)</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;{</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="preprocessor">#define NUM_CIPHERS (0 \</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="preprocessor">    + 4 * ENABLE_FEATURE_TLS_SHA1 \</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="preprocessor">    + ALLOW_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 \</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="preprocessor">    + ALLOW_ECDHE_RSA_WITH_AES_128_CBC_SHA256 \</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="preprocessor">    + ALLOW_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 \</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="preprocessor">    + ALLOW_ECDHE_RSA_WITH_AES_128_GCM_SHA256 \</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="preprocessor">    + 2 * ENABLE_FEATURE_TLS_SHA1 \</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="preprocessor">    + ALLOW_RSA_WITH_AES_128_CBC_SHA256 \</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="preprocessor">    + ALLOW_RSA_WITH_AES_256_CBC_SHA256 \</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="preprocessor">    + ALLOW_RSA_WITH_AES_128_GCM_SHA256 \</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="preprocessor">    + ALLOW_RSA_NULL_SHA256 \</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="preprocessor">    )</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> ciphers[] = {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        0x00,2 * (1 + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a68c6144816dda1e31ee6b895663959ca">NUM_CIPHERS</a>), <span class="comment">//len16_be</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        0x00,0xFF, <span class="comment">//not a cipher - TLS_EMPTY_RENEGOTIATION_INFO_SCSV</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <span class="comment">/* ^^^^^^ RFC 5746 Renegotiation Indication Extension - some servers will refuse to work with us otherwise */</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;#<span class="keywordflow">if</span> ENABLE_FEATURE_TLS_SHA1</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        0xC0,0x09, <span class="comment">// 1 TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA - ok: wget https://is.gd/</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        0xC0,0x0A, <span class="comment">// 2 TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA - ok: wget https://is.gd/</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        0xC0,0x13, <span class="comment">// 3 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA - ok: openssl s_server ... -cipher ECDHE-RSA-AES128-SHA</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        0xC0,0x14, <span class="comment">// 4 TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA - ok: openssl s_server ... -cipher ECDHE-RSA-AES256-SHA (might fail with older openssl)</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="comment">//  0xC0,0x18, //   TLS_ECDH_anon_WITH_AES_128_CBC_SHA</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="comment">//  0xC0,0x19, //   TLS_ECDH_anon_WITH_AES_256_CBC_SHA</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;#endif</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7f94151579cdfcbc800f105f34eb4002">ALLOW_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</a></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        0xC0,0x23, <span class="comment">// 5 TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 - ok: wget https://is.gd/</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;#endif</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="comment">//  0xC0,0x24, //   TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 - can&#39;t do SHA384 yet</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a152bb318366725ff282862bdb879c4ba">ALLOW_ECDHE_RSA_WITH_AES_128_CBC_SHA256</a></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        0xC0,0x27, <span class="comment">// 6 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 - ok: openssl s_server ... -cipher ECDHE-RSA-AES128-SHA256</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;#endif</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="comment">//  0xC0,0x28, //   TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 - can&#39;t do SHA384 yet</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aed3e2cf47e9fb0e450f57fa5ecb66ad4">ALLOW_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</a></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        0xC0,0x2B, <span class="comment">// 7 TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 - ok: wget https://is.gd/</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;#endif</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="comment">//  0xC0,0x2C, //   TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 - wget https://is.gd/: &quot;TLS error from peer (alert code 20): bad MAC&quot;</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">//TODO: GCM_SHA384 ciphers can be supported, only need sha384-based PRF?</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2f3a2adc76a0f9a7727eb21b7f3f0b24">ALLOW_ECDHE_RSA_WITH_AES_128_GCM_SHA256</a></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        0xC0,0x2F, <span class="comment">// 8 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 - ok: openssl s_server ... -cipher ECDHE-RSA-AES128-GCM-SHA256</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;#endif</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="comment">//  0xC0,0x30, //   TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 - openssl s_server ... -cipher ECDHE-RSA-AES256-GCM-SHA384: &quot;decryption failed or bad record mac&quot;</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="comment">//possibly these too:</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;#<span class="keywordflow">if</span> ENABLE_FEATURE_TLS_SHA1</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="comment">//  0xC0,0x35, //   TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="comment">//  0xC0,0x36, //   TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;#endif</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="comment">//  0xC0,0x37, //   TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="comment">//  0xC0,0x38, //   TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA384 - can&#39;t do SHA384 yet</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;#<span class="keywordflow">if</span> ENABLE_FEATURE_TLS_SHA1</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        0x00,0x2F, <span class="comment">// 9 TLS_RSA_WITH_AES_128_CBC_SHA - ok: openssl s_server ... -cipher AES128-SHA</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        0x00,0x35, <span class="comment">//10 TLS_RSA_WITH_AES_256_CBC_SHA - ok: openssl s_server ... -cipher AES256-SHA</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;#endif</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a68e5b663cedb46bb2fe35d546fe8dd29">ALLOW_RSA_WITH_AES_128_CBC_SHA256</a></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        0x00,0x3C, <span class="comment">//11 TLS_RSA_WITH_AES_128_CBC_SHA256 - ok: openssl s_server ... -cipher AES128-SHA256</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;#endif</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae6eb035c662d7e6d4a4e0dcf863fec8d">ALLOW_RSA_WITH_AES_256_CBC_SHA256</a></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        0x00,0x3D, <span class="comment">//12 TLS_RSA_WITH_AES_256_CBC_SHA256 - ok: openssl s_server ... -cipher AES256-SHA256</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;#endif</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0681bb67727c2a6f8c87aa71b3ea692f">ALLOW_RSA_WITH_AES_128_GCM_SHA256</a></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        0x00,0x9C, <span class="comment">//13 TLS_RSA_WITH_AES_128_GCM_SHA256 - ok: openssl s_server ... -cipher AES128-GCM-SHA256</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;#endif</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="comment">//  0x00,0x9D, //   TLS_RSA_WITH_AES_256_GCM_SHA384 - openssl s_server ... -cipher AES256-GCM-SHA384: &quot;decryption failed or bad record mac&quot;</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af60cb3c889da6403866b3087adf587c3">ALLOW_RSA_NULL_SHA256</a></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        0x00,0x3B, <span class="comment">//   TLS_RSA_WITH_NULL_SHA256</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;#endif</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        0x01,0x00, <span class="comment">//not a cipher - comprtypes_len, comprtype</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    };</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keyword">struct </span>client_hello {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> len24_hi, len24_mid, len24_lo;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> proto_maj, proto_min;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> rand32[32];</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> session_id_len;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        <span class="comment">/* uint8_t session_id[]; */</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> cipherid_len16_hi, cipherid_len16_lo;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> cipherid[2 * (1 + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a68c6144816dda1e31ee6b895663959ca">NUM_CIPHERS</a>)]; <span class="comment">/* actually variable */</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> comprtypes_len;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> comprtypes[1]; <span class="comment">/* actually variable */</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    };</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="comment">// https://www.iana.org/assignments/tls-extensiontype-values/tls-extensiontype-values.xhtml</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> extensions[] = {</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        <span class="comment">// is.gd responds with &quot;handshake failure&quot; to our hello if there&#39;s no supported_groups</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        0x00,0x0a, <span class="comment">//extension_type: &quot;supported_groups&quot;</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            0x00,2 * (1 + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6a30ed926de7c078a4d0e034eb714a7f">ALLOW_CURVE_P256</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0ed4142828e820e1aa9bea863a34a288">ALLOW_CURVE_X25519</a>), <span class="comment">//ext len</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            0x00,2 * (0 + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6a30ed926de7c078a4d0e034eb714a7f">ALLOW_CURVE_P256</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0ed4142828e820e1aa9bea863a34a288">ALLOW_CURVE_X25519</a>), <span class="comment">//list len</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="preprocessor">#if ALLOW_CURVE_P256</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            0x00,0x17, <span class="comment">//curve_secp256r1 (aka P256, aka prime256v1)</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <span class="comment">//0x00,0x18, //curve_secp384r1</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            <span class="comment">//0x00,0x19, //curve_secp521r1</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="preprocessor">#if ALLOW_CURVE_X25519</span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            0x00,0x1d, <span class="comment">//curve_x25519 (RFC 7748)</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            <span class="comment">//0x00,0x1e, //curve_x448 (RFC 7748)</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160; </div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <span class="comment">//0x00,0x0b,0x00,0x04,0x03,0x00,0x01,0x02, //extension_type: &quot;ec_point_formats&quot;</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        <span class="comment">//0x00,0x16,0x00,0x00, //extension_type: &quot;encrpypt-then-mac&quot;</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="comment">//0x00,0x17,0x00,0x00, //extension_type: &quot;extended_master&quot;</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <span class="comment">//0x00,0x23,0x00,0x00, //extension_type: &quot;session_ticket&quot;</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <span class="comment">// kojipkgs.fedoraproject.org responds with alert code 80 (&quot;internal error&quot;)</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="comment">// to our hello without signature_algorithms.</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        <span class="comment">// It is satisfied with just 0x04,0x01.</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        0x00,0x0d, <span class="comment">//extension_type: &quot;signature_algorithms&quot; (RFC5246 section 7.4.1.4.1):</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="preprocessor">#define SIGALGS (3 + 3 * ENABLE_FEATURE_TLS_SHA1)</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            0x00,2 * (1 + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afa7392a2c6f6c8a1f596942b27ca9725">SIGALGS</a>), <span class="comment">//ext len</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            0x00,2 * (0 + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afa7392a2c6f6c8a1f596942b27ca9725">SIGALGS</a>), <span class="comment">//list len</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;            <span class="comment">//Format: two bytes</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;            <span class="comment">// byte 1: 0:none,1:md5,2:sha1,3:sha224,4:sha256,5:sha384,6:sha512</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;            <span class="comment">// byte 2: 1:rsa,2:dsa,3:ecdsa</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            <span class="comment">// (note that TLS 1.3 changes this, see RFC8446 section 4.2.3)</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="preprocessor">#if ENABLE_FEATURE_TLS_SHA1</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;            0x02,0x01, <span class="comment">//sha1 + rsa</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            0x02,0x02, <span class="comment">//sha1 + dsa</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;            0x02,0x03, <span class="comment">//sha1 + ecdsa</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            0x04,0x01, <span class="comment">//sha256 + rsa - kojipkgs.fedoraproject.org wants this</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            0x04,0x02, <span class="comment">//sha256 + dsa</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            0x04,0x03, <span class="comment">//sha256 + ecdsa</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">// GNU Wget 1.18 to cdn.kernel.org sends these extensions:</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">// 0055</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">//   0005 0005 0100000000 - status_request</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">//   0000 0013 0011 00 000e 63646e 2e 6b65726e656c 2e 6f7267 - server_name</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">//   ff01 0001 00 - renegotiation_info</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">//   0023 0000 - session_ticket</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">//   000a 0008 0006001700180019 - supported_groups</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">//   000b 0002 0100 - ec_point_formats</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">//   000d 0016 0014 0401 0403 0501 0503 0601 0603 0301 0303 0201 0203 - signature_algorithms</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">// wolfssl library sends this option, RFC 7627 (closes a security weakness, some servers may require it. TODO?):</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">//   0017 0000 - extended master secret</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    };</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="keyword">struct </span>client_hello *record;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *ptr;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="keywordtype">int</span> len;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="keywordtype">int</span> ext_len;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <span class="keywordtype">int</span> sni_len = sni ? <a class="code" href="../../d1/d45/apps_2base_2bash_2lib_2sh_2strnlen_8c.html#afc92d2231e45d19988c7894aa2a07f0c">strnlen</a>(sni, 127 - 5) : 0;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160; </div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    ext_len = 0;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    ext_len += <span class="keyword">sizeof</span>(extensions);</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="keywordflow">if</span> (sni_len)</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        ext_len += 9 + sni_len;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160; </div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="comment">/* +2 is for &quot;len of all extensions&quot; 2-byte field */</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    len = <span class="keyword">sizeof</span>(*record) + 2 + ext_len;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    record = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3ecbfa237736e9525fb3bd26bba53f3f">tls_get_zeroed_outbuf</a>(tls, len);</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160; </div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2acf5a199836fd199ff326e1446dac84">fill_handshake_record_hdr</a>(record, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8dabadc98219d027206899deb1561143">HANDSHAKE_CLIENT_HELLO</a>, len);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    record-&gt;proto_maj = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a>;    <span class="comment">/* the &quot;requested&quot; version of the protocol, */</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    record-&gt;proto_min = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a>;    <span class="comment">/* can be higher than one in record headers */</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a59d1a3325c8c18009268226036a074a2">tls_get_random</a>(record-&gt;rand32, <span class="keyword">sizeof</span>(record-&gt;rand32));</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a825fce3f42c85c60e76e7e3d5a779cfb">TLS_DEBUG_FIXED_SECRETS</a>)</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        <a class="code" href="../../da/d68/apps_2base_2bash_2lib_2sh_2memset_8c.html#a19588d2006eb37347ebae632befc20e5">memset</a>(record-&gt;rand32, 0x11, <span class="keyword">sizeof</span>(record-&gt;rand32));</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="comment">/* record-&gt;session_id_len = 0; - already is */</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160; </div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a0fc08f11f6c83dbc94a75ca49d29fae8">BUILD_BUG_ON</a>(<span class="keyword">sizeof</span>(ciphers) != 2 * (1 + 1 + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a68c6144816dda1e31ee6b895663959ca">NUM_CIPHERS</a> + 1));</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(&amp;record-&gt;cipherid_len16_hi, ciphers, <span class="keyword">sizeof</span>(ciphers));</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160; </div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    ptr = (<span class="keywordtype">void</span>*)(record + 1);</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    *ptr++ = ext_len &gt;&gt; 8;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    *ptr++ = ext_len;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="keywordflow">if</span> (sni_len) {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        <span class="comment">//ptr[0] = 0;             //</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="comment">//ptr[1] = 0;             //extension_type</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <span class="comment">//ptr[2] = 0;         //</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        ptr[3] = sni_len + 5; <span class="comment">//list len</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="comment">//ptr[4] = 0;             //</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        ptr[5] = sni_len + 3;     <span class="comment">//len of 1st SNI</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <span class="comment">//ptr[6] = 0;         //name type</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        <span class="comment">//ptr[7] = 0;             //</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        ptr[8] = sni_len;         <span class="comment">//name len</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        ptr = <a class="code" href="../../d0/dfd/mempcpy_8c.html#a7ac7c0f43132e3acf013e0c71a58cdc9">mempcpy</a>(&amp;ptr[9], sni, sni_len);</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    }</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(ptr, extensions, <span class="keyword">sizeof</span>(extensions));</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160; </div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a> = <a class="code" href="../../d7/dd7/libbb_8h.html#a6b9d12af476b8fa4b9de87028b0ac27c">xzalloc</a>(<span class="keyword">sizeof</span>(*tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>));</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <span class="comment">/* HANDSHAKE HASH: ^^^ + len if need to save saved_client_hello */</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">client_and_server_rand32</a>, record-&gt;rand32, <span class="keyword">sizeof</span>(record-&gt;rand32));</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">/* HANDSHAKE HASH:</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">    tls-&gt;hsd-&gt;saved_client_hello_size = len;</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="comment">    memcpy(tls-&gt;hsd-&gt;saved_client_hello, record, len);</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&gt;&gt; CLIENT_HELLO\n&quot;</span>);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="comment">/* Can hash immediately only if we know which MAC hash to use.</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="comment">     * So far we do know: it&#39;s sha256:</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a333b9a46277181b82f5053bcf6129d86">sha256_begin</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a087b69ab91f3b4fa570daccc680043af">handshake_hash_ctx</a>);</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa98352b3587a985366c092e548025daa">xwrite_and_update_handshake_hash</a>(tls, len);</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="comment">/* if this would become infeasible: save tls-&gt;hsd-&gt;saved_client_hello,</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">     * use &quot;xwrite_handshake_record(tls, len)&quot; here,</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment">     * and hash saved_client_hello later.</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;}</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160; </div>
<div class="line"><a name="l01695"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2e3afc5d10bf3345d671b82ee8f5fba6"> 1695</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2e3afc5d10bf3345d671b82ee8f5fba6">get_server_hello</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;{</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="keyword">struct </span>server_hello {</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> xhdr;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> len24_hi, len24_mid, len24_lo;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">proto_maj</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d34e2d988fc19f2480bab352b6376d0">proto_min</a>;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> rand32[32]; <span class="comment">/* first 4 bytes are unix time in BE format */</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> session_id_len;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> session_id[32];</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> cipherid_hi, cipherid_lo;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> comprtype;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        <span class="comment">/* extensions may follow, but only those which client offered in its Hello */</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    };</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160; </div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keyword">struct </span>server_hello *hp;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *cipherid;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> cipherid1;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordtype">int</span> len, len24;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160; </div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac3d09a13305957afd7599d4f92dbf0bd">tls_xread_handshake_block</a>(tls, 74 - 32);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160; </div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    hp = (<span class="keywordtype">void</span>*)tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="comment">// 74 bytes:</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="comment">// 02  000046 03|03   58|78|cf|c1 50|a5|49|ee|7e|29|48|71|fe|97|fa|e8|2d|19|87|72|90|84|9d|37|a3|f0|cb|6f|5f|e3|3c|2f |20  |d8|1a|78|96|52|d6|91|01|24|b3|d6|5b|b7|d0|6c|b3|e1|78|4e|3c|95|de|74|a0|ba|eb|a7|3a|ff|bd|a2|bf |00|9c |00|</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <span class="comment">//SvHl len=70 maj.min unixtime^^^ 28randbytes^^^^^^^^^^^^^^^^^^^^^^^^^^^^_^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^_^^^ slen sid32bytes^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ cipSel comprSel</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <a class="code" href="../../db/dd4/sm__loop_8c.html#a45a537235d3d9968fa1c984289b3c3c6">if</a> (hp-&gt;type != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a4d11f3d0264027abeb2a55e2a9a3e40b">HANDSHAKE_SERVER_HELLO</a></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;     || hp-&gt;len24_hi  != 0</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;     || hp-&gt;len24_mid != 0</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;     <span class="comment">/* hp-&gt;len24_lo checked later */</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;     || hp-&gt;proto_maj != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;     || hp-&gt;proto_min != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    ) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;&#39;server hello&#39;&quot;</span>, len);</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    }</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160; </div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    cipherid = &amp;hp-&gt;cipherid_hi;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    len24 = hp-&gt;len24_lo;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <span class="keywordflow">if</span> (hp-&gt;session_id_len != 32) {</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        <span class="keywordflow">if</span> (hp-&gt;session_id_len != 0)</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;&#39;server hello&#39;&quot;</span>, len);</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160; </div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <span class="comment">// session_id_len == 0: no session id</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        <span class="comment">// &quot;The server</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        <span class="comment">// may return an empty session_id to indicate that the session will</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        <span class="comment">// not be cached and therefore cannot be resumed.&quot;</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        cipherid -= 32;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        len24 += 32; <span class="comment">/* what len would be if session id would be present */</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    }</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160; </div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keywordflow">if</span> (len24 &lt; 70)</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;&#39;server hello&#39;&quot;</span>, len);</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&lt;&lt; SERVER_HELLO\n&quot;</span>);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160; </div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">client_and_server_rand32</a> + 32, hp-&gt;rand32, <span class="keyword">sizeof</span>(hp-&gt;rand32));</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160; </div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="comment">/* Set up encryption params based on selected cipher */</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        0xC0,0x09, <span class="comment">// 1 TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA - ok: wget https://is.gd/</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        0xC0,0x0A, <span class="comment">// 2 TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA - ok: wget https://is.gd/</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        0xC0,0x13, <span class="comment">// 3 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA - ok: openssl s_server ... -cipher ECDHE-RSA-AES128-SHA</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        0xC0,0x14, <span class="comment">// 4 TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA - ok: openssl s_server ... -cipher ECDHE-RSA-AES256-SHA (might fail with older openssl)</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="comment">//  0xC0,0x18, //   TLS_ECDH_anon_WITH_AES_128_CBC_SHA</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="comment">//  0xC0,0x19, //   TLS_ECDH_anon_WITH_AES_256_CBC_SHA</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        0xC0,0x23, <span class="comment">// 5 TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 - ok: wget https://is.gd/</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="comment">//  0xC0,0x24, //   TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 - can&#39;t do SHA384 yet</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        0xC0,0x27, <span class="comment">// 6 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 - ok: openssl s_server ... -cipher ECDHE-RSA-AES128-SHA256</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="comment">//  0xC0,0x28, //   TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 - can&#39;t do SHA384 yet</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        0xC0,0x2B, <span class="comment">// 7 TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 - ok: wget https://is.gd/</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="comment">//  0xC0,0x2C, //   TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 - wget https://is.gd/: &quot;TLS error from peer (alert code 20): bad MAC&quot;</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        0xC0,0x2F, <span class="comment">// 8 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 - ok: openssl s_server ... -cipher ECDHE-RSA-AES128-GCM-SHA256</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="comment">//  0xC0,0x30, //   TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 - openssl s_server ... -cipher ECDHE-RSA-AES256-GCM-SHA384: &quot;decryption failed or bad record mac&quot;</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="comment">//possibly these too:</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="comment">//  0xC0,0x35, //   TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="comment">//  0xC0,0x36, //   TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="comment">//  0xC0,0x37, //   TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="comment">//  0xC0,0x38, //   TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA384 - can&#39;t do SHA384 yet</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        0x00,0x2F, <span class="comment">// 9 TLS_RSA_WITH_AES_128_CBC_SHA - ok: openssl s_server ... -cipher AES128-SHA</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        0x00,0x35, <span class="comment">//10 TLS_RSA_WITH_AES_256_CBC_SHA - ok: openssl s_server ... -cipher AES256-SHA</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        0x00,0x3C, <span class="comment">//11 TLS_RSA_WITH_AES_128_CBC_SHA256 - ok: openssl s_server ... -cipher AES128-SHA256</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        0x00,0x3D, <span class="comment">//12 TLS_RSA_WITH_AES_256_CBC_SHA256 - ok: openssl s_server ... -cipher AES256-SHA256</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        0x00,0x9C, <span class="comment">//13 TLS_RSA_WITH_AES_128_GCM_SHA256 - ok: openssl s_server ... -cipher AES128-GCM-SHA256</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="comment">//  0x00,0x9D, //   TLS_RSA_WITH_AES_256_GCM_SHA384 - openssl s_server ... -cipher AES256-GCM-SHA384: &quot;decryption failed or bad record mac&quot;</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        0x00,0x3B, <span class="comment">//   TLS_RSA_WITH_NULL_SHA256</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    cipherid1 = cipherid[1];</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a1d74dab2b4a31237fec264b4ebb3ede6">cipher_id</a> = 0x100 * cipherid[0] + cipherid1;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0aa2ef4fc31647cb6840883c00ec5a49b7">AES256_KEYSIZE</a>;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a> = <a class="code" href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da0bc3102f049b590dff06d0ed0360796e">SHA256_OUTSIZE</a>;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="comment">/*tls-&gt;IV_size = 0; - already is */</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">if</span> (cipherid[0] == 0xC0) {</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        <span class="comment">/* All C0xx are ECDHE */</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> |= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab38dc88e6d70f9206569c50c1d895b85">NEED_EC_KEY</a>;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        <span class="keywordflow">if</span> (cipherid1 &amp; 1) {</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;            <span class="comment">/* Odd numbered C0xx use AES128 (even ones use AES256) */</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad61a29ae1d927dd634c2efbff44b8a18">AES128_KEYSIZE</a>;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        }</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <span class="keywordflow">if</span> (ENABLE_FEATURE_TLS_SHA1 &amp;&amp; cipherid1 &lt;= 0x19) {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a> = <a class="code" href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13daa403a6ccafdf7f0e2d6615f70dfd371d">SHA1_OUTSIZE</a>;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        <span class="keywordflow">if</span> (cipherid1 &gt;= 0x2B &amp;&amp; cipherid1 &lt;= 0x30) {</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            <span class="comment">/* C02B,2C,2F,30 are AES-GCM */</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> |= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2">ENCRYPTION_AESGCM</a>;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a> = 0;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aca4af3524ef06062af2698c9250852df">IV_size</a> = 4;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        }</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <span class="comment">/* All 00xx are RSA */</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        <span class="keywordflow">if</span> ((ENABLE_FEATURE_TLS_SHA1 &amp;&amp; cipherid1 == 0x2F)</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;         || cipherid1 == 0x3C</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;         || cipherid1 == 0x9C</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        ) {</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad61a29ae1d927dd634c2efbff44b8a18">AES128_KEYSIZE</a>;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        }</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <span class="keywordflow">if</span> (ENABLE_FEATURE_TLS_SHA1 &amp;&amp; cipherid1 &lt;= 0x35) {</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a> = <a class="code" href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13daa403a6ccafdf7f0e2d6615f70dfd371d">SHA1_OUTSIZE</a>;</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        <span class="keywordflow">if</span> (cipherid1 == 0x9C <span class="comment">/*|| cipherid1 == 0x9D*/</span>) {</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;            <span class="comment">/* 009C,9D are AES-GCM */</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> |= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2">ENCRYPTION_AESGCM</a>;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a> = 0;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aca4af3524ef06062af2698c9250852df">IV_size</a> = 4;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;server chose cipher %04x\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a1d74dab2b4a31237fec264b4ebb3ede6">cipher_id</a>);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;key_size:%u MAC_size:%u IV_size:%u\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aca4af3524ef06062af2698c9250852df">IV_size</a>);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160; </div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="comment">/* Handshake hash eventually destined to FINISHED record</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment">     * is sha256 regardless of cipher</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">     * (at least for all ciphers defined by RFC5246).</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">     * It&#39;s not sha1 for AES_128_CBC_SHA - only MAC is sha1, not this hash.</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">/* HANDSHAKE HASH:</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment">    sha256_begin(&amp;tls-&gt;hsd-&gt;handshake_hash_ctx);</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">    hash_handshake(tls, &quot;&gt;&gt; client hello hash:%s&quot;,</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">        tls-&gt;hsd-&gt;saved_client_hello, tls-&gt;hsd-&gt;saved_client_hello_size</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">    );</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">    hash_handshake(tls, &quot;&lt;&lt; server hello hash:%s&quot;,</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment">        tls-&gt;inbuf + RECHDR_LEN, len</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">    );</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;}</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160; </div>
<div class="line"><a name="l01838"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af2feecdca663721aca648de25a775a92"> 1838</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af2feecdca663721aca648de25a775a92">get_server_cert</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;{</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> *xhdr;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *certbuf;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="keywordtype">int</span> len, len1;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160; </div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac3d09a13305957afd7599d4f92dbf0bd">tls_xread_handshake_block</a>(tls, 10);</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160; </div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    xhdr = (<span class="keywordtype">void</span>*)tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    certbuf = (<span class="keywordtype">void</span>*)(xhdr + 1);</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    <span class="keywordflow">if</span> (certbuf[0] != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a80578323a028f7c97df09fcf86095374">HANDSHAKE_CERTIFICATE</a>)</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;certificate&quot;</span>, len);</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&lt;&lt; CERTIFICATE\n&quot;</span>);</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="comment">// 4392 bytes:</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="comment">// 0b  00|11|24 00|11|21 00|05|b0 30|82|05|ac|30|82|04|94|a0|03|02|01|02|02|11|00|9f|85|bf|66|4b|0c|dd|af|ca|50|86|79|50|1b|2b|e4|30|0d...</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="comment">//Cert len=4388 ChainLen CertLen^ DER encoded X509 starts here. openssl x509 -in FILE -inform DER -noout -text</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    len1 = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae77ce99bbd9b7699102e28cc744d3825">get24be</a>(certbuf + 1);</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keywordflow">if</span> (len1 &gt; len - 4) <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5606771cd63cad022b13c591fecf4fde">tls_error_die</a>(tls);</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    len = len1;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    len1 = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae77ce99bbd9b7699102e28cc744d3825">get24be</a>(certbuf + 4);</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="keywordflow">if</span> (len1 &gt; len - 3) <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5606771cd63cad022b13c591fecf4fde">tls_error_die</a>(tls);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    len = len1;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    len1 = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae77ce99bbd9b7699102e28cc744d3825">get24be</a>(certbuf + 7);</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="keywordflow">if</span> (len1 &gt; len - 3) <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5606771cd63cad022b13c591fecf4fde">tls_error_die</a>(tls);</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    len = len1;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160; </div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="keywordflow">if</span> (len)</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a36ef8ca992ba3de99b5c988d86211275">find_key_in_der_cert</a>(tls, certbuf + 10, len);</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;}</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160; </div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">/* On input, len is known to be &gt;= 4.</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment"> * The record is known to be SERVER_KEY_EXCHANGE.</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af31e97ebfa62c1b74e19b4c6c4b9fb14"> 1871</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af31e97ebfa62c1b74e19b4c6c4b9fb14">process_server_key</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;{</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a> *xhdr;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> *<a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a>;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordtype">int</span> len1;</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a0a8582351ac627ee8bde2973c825e47f">uint32_t</a> t32;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160; </div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    xhdr = (<span class="keywordtype">void</span>*)tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a> = (<span class="keywordtype">void</span>*)(xhdr + 1);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">//seen from is.gd: it selects curve_x25519:</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">//  0c 00006e //SERVER_KEY_EXCHANGE, len</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">//    03 //curve_type: named curve</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">//    001d //curve_x25519</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">//server-chosen EC point, and then signed_params</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">//      (RFC 8422: &quot;A hash of the params, with the signature</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">//      appropriate to that hash applied.  The private key corresponding</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">//      to the certified public key in the server&#39;s Certificate message is</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">//      used for signing.&quot;)</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">//follow. Format unclear/guessed:</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">//    20 //eccPubKeyLen</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">//      25511923d73b70dd2f60e66ba2f3fda31a9c25170963c7a3a972e481dbb2835d //eccPubKey (32bytes)</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">//    0203 //hashSigAlg: 2:SHA1 (4:SHA256 5:SHA384 6:SHA512), 3:ECDSA (1:RSA)</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">//    0046 //len (16bit)</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">//      30 44 //SEQ, len</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">//        02 20 //INTEGER, len</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">//          2e18e7c2a9badd0a70cd3059a6ab114539b9f5163568911147386cd77ed7c412 //32bytes</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment">//this item ^^^^^ is sometimes 33 bytes (with all container sizes also +1)</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="comment">//        02 20 //INTEGER, len</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment">//          64523d6216cb94c43c9b20e377d8c52c55be6703fd6730a155930c705eaf3af6 //32bytes</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment">//same about this item ^^^^^</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment">//seen from ftp.openbsd.org</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment">//(which only accepts ECDHE-RSA-AESnnn-GCM-SHAnnn and ECDHE-RSA-CHACHA20-POLY1305 ciphers):</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">//  0c 000228 //SERVER_KEY_EXCHANGE, len</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment">//    03 //curve_type: named curve</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">//    001d //curve_x25519</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment">//    20 //eccPubKeyLen</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment">//      eef7a15c43b71a4c7eaa48a39369399cc4332e569ec90a83274cc92596705c1a //eccPubKey</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">//    0401 //hashSigAlg: 4:SHA256, 1:RSA</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">//    0200 //len</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">//      //0x200 bytes follow</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160; </div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="comment">/* Get and verify length */</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    len1 = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae77ce99bbd9b7699102e28cc744d3825">get24be</a>(<a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a> + 1);</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordflow">if</span> (len1 &gt; len - 4) <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5606771cd63cad022b13c591fecf4fde">tls_error_die</a>(tls);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    len = len1;</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="keywordflow">if</span> (len &lt; (1+2+1+32)) <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5606771cd63cad022b13c591fecf4fde">tls_error_die</a>(tls);</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a> += 4;</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160; </div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="preprocessor">#if BB_BIG_ENDIAN</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="preprocessor"># define _0x03001741 0x03001741</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="preprocessor"># define _0x03001d20 0x03001d20</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="preprocessor"># define _0x03001741 0x41170003</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="preprocessor"># define _0x03001d20 0x201d0003</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <a class="code" href="../../de/d03/platform_8h.html#a5b27ff781e21e412705167a70f5cc47a">move_from_unaligned32</a>(t32, <a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a>);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a> += 4;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    <span class="keywordflow">switch</span> (t32) {</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa0314c1e43e00028644ceb32e013a23f">_0x03001d20</a>: <span class="comment">//curve_x25519</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;got x25519 eccPubKey\n&quot;</span>);</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> |= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a971b66d3a2f12dd1f58a1cd048814193">GOT_EC_CURVE_X25519</a>;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a360c5e94b1f215558f06d59c710de87d">ecc_pub_key32</a>, <a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a>, 32);</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ca66c805d202d279faca9feacced57f">_0x03001741</a>: <span class="comment">//curve_secp256r1 (aka P256)</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;got P256 eccPubKey\n&quot;</span>);</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        <span class="comment">/* P256 point can be transmitted odd- or even-compressed</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment">         * (first byte is 3 or 2) or uncompressed (4).</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        <span class="keywordflow">if</span> (*<a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a>++ != 4)</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#aa7873f1b32526ae11612363558a2aa90">bb_simple_error_msg_and_die</a>(<span class="stringliteral">&quot;compressed EC points not supported&quot;</span>);</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a360c5e94b1f215558f06d59c710de87d">ecc_pub_key32</a>, <a class="code" href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a>, 2 * 32);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        <a class="code" href="../../d7/dd7/libbb_8h.html#a1992b68ae7d01f7da91e31e351ca3b33">bb_error_msg_and_die</a>(<span class="stringliteral">&quot;elliptic curve is not x25519 or P256: 0x%08x&quot;</span>, t32);</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    }</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160; </div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> |= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad0b8160a079f0c3fdcfc1f46c68e4b1f">GOT_EC_KEY</a>;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;}</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160; </div>
<div class="line"><a name="l01951"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7543ee146e14655d2038f2262892b775"> 1951</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7543ee146e14655d2038f2262892b775">send_empty_client_cert</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;{</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <span class="keyword">struct </span>client_empty_cert {</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> len24_hi, len24_mid, len24_lo;</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> cert_chain_len24_hi, cert_chain_len24_mid, cert_chain_len24_lo;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    };</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="keyword">struct </span>client_empty_cert *record;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160; </div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    record = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3ecbfa237736e9525fb3bd26bba53f3f">tls_get_zeroed_outbuf</a>(tls, <span class="keyword">sizeof</span>(*record));</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    <span class="comment">//fill_handshake_record_hdr(record, HANDSHAKE_CERTIFICATE, sizeof(*record));</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <span class="comment">//record-&gt;cert_chain_len24_hi = 0;</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="comment">//record-&gt;cert_chain_len24_mid = 0;</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <span class="comment">//record-&gt;cert_chain_len24_lo = 0;</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="comment">// same as above:</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    record-&gt;type = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a80578323a028f7c97df09fcf86095374">HANDSHAKE_CERTIFICATE</a>;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    record-&gt;len24_lo = 3;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160; </div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&gt;&gt; CERTIFICATE\n&quot;</span>);</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa98352b3587a985366c092e548025daa">xwrite_and_update_handshake_hash</a>(tls, <span class="keyword">sizeof</span>(*record));</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;}</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160; </div>
<div class="line"><a name="l01973"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9f0a3442d9f5f618d514c99bbf36e8b7"> 1973</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9f0a3442d9f5f618d514c99bbf36e8b7">send_client_key_exchange</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;{</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    <span class="keyword">struct </span>client_key_exchange {</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> len24_hi, len24_mid, len24_lo;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> key[2 + 4 * 1024]; <span class="comment">// size??</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    };</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">//FIXME: better size estimate</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keyword">struct </span>client_key_exchange *record = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3ecbfa237736e9525fb3bd26bba53f3f">tls_get_zeroed_outbuf</a>(tls, <span class="keyword">sizeof</span>(*record));</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> premaster[<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">RSA_PREMASTER_SIZE</a> &gt; <a class="code" href="../../df/d79/tls_8h.html#a0aa20d80319c3f9cedbac904317ea6e1">EC_CURVE_KEYSIZE</a> ? <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">RSA_PREMASTER_SIZE</a> : <a class="code" href="../../df/d79/tls_8h.html#a0aa20d80319c3f9cedbac904317ea6e1">EC_CURVE_KEYSIZE</a>];</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <span class="keywordtype">int</span> premaster_size;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="keywordtype">int</span> len;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160; </div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="keywordflow">if</span> (!(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab38dc88e6d70f9206569c50c1d895b85">NEED_EC_KEY</a>)) {</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        <span class="comment">/* RSA */</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        <span class="keywordflow">if</span> (!(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ac39e3e35406c535eefd6407179d18a8d">GOT_CERT_RSA_KEY_ALG</a>))</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#aa7873f1b32526ae11612363558a2aa90">bb_simple_error_msg_and_die</a>(<span class="stringliteral">&quot;server cert is not RSA&quot;</span>);</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160; </div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a59d1a3325c8c18009268226036a074a2">tls_get_random</a>(premaster, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">RSA_PREMASTER_SIZE</a>);</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a825fce3f42c85c60e76e7e3d5a779cfb">TLS_DEBUG_FIXED_SECRETS</a>)</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;            <a class="code" href="../../da/d68/apps_2base_2bash_2lib_2sh_2memset_8c.html#a19588d2006eb37347ebae632befc20e5">memset</a>(premaster, 0x44, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">RSA_PREMASTER_SIZE</a>);</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        <span class="comment">// RFC 5246</span></div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        <span class="comment">// &quot;Note: The version number in the PreMasterSecret is the version</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        <span class="comment">// offered by the client in the ClientHello.client_version, not the</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        <span class="comment">// version negotiated for the connection.&quot;</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        premaster[0] = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a>;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        premaster[1] = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a>;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;premaster:%s\n&quot;</span>, premaster, <span class="keyword">sizeof</span>(premaster));</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        len = <a class="code" href="../../d4/df3/tls__rsa_8h.html#a5a8e275c70c5b22d5b5b88c6997950cf">psRsaEncryptPub</a>(<span class="comment">/*pool:*/</span> <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            <span class="comment">/* psRsaKey_t* */</span> &amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">server_rsa_pub_key</a>,</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            premaster, <span class="comment">/*inlen:*/</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">RSA_PREMASTER_SIZE</a>,</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;            record-&gt;key + 2, <span class="keyword">sizeof</span>(record-&gt;key) - 2,</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;            data_param_ignored</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        );</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        <span class="comment">/* keylen16 exists for RSA (in TLS, not in SSL), but not for some other key types */</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        record-&gt;key[0] = len &gt;&gt; 8;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        record-&gt;key[1] = len &amp; 0xff;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        len += 2;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        premaster_size = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">RSA_PREMASTER_SIZE</a>;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <span class="comment">/* ECDHE */</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        <span class="keywordflow">if</span> (!(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad0b8160a079f0c3fdcfc1f46c68e4b1f">GOT_EC_KEY</a>))</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#aa7873f1b32526ae11612363558a2aa90">bb_simple_error_msg_and_die</a>(<span class="stringliteral">&quot;server did not provide EC key&quot;</span>);</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160; </div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a971b66d3a2f12dd1f58a1cd048814193">GOT_EC_CURVE_X25519</a>) {</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;            <span class="comment">/* ECDHE, curve x25519 */</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;computing x25519_premaster\n&quot;</span>);</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;            <a class="code" href="../../df/d79/tls_8h.html#af0e5dd181602edd30facec8f29da9deb">curve_x25519_compute_pubkey_and_premaster</a>(</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                    record-&gt;key + 1, premaster,</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                    <span class="comment">/*point:*/</span> tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a360c5e94b1f215558f06d59c710de87d">ecc_pub_key32</a></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;            );</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;            len = <a class="code" href="../../df/d79/tls_8h.html#a7274bb2f15a34d9c5f7216af7096b796">CURVE25519_KEYSIZE</a>;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            <span class="comment">//record-&gt;key[0] = len;</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            <span class="comment">//len++;</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            <span class="comment">//premaster_size = CURVE25519_KEYSIZE;</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            <span class="comment">/* ECDHE, curve P256 */</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;computing P256_premaster\n&quot;</span>);</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;            <a class="code" href="../../df/d79/tls_8h.html#a0442fa1d28f0e7d3826cbc26d708ce82">curve_P256_compute_pubkey_and_premaster</a>(</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                    record-&gt;key + 2, premaster,</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                    <span class="comment">/*point:*/</span> tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a360c5e94b1f215558f06d59c710de87d">ecc_pub_key32</a></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;            );</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;            record-&gt;key[1] = 4; <span class="comment">/* &quot;uncompressed point&quot; */</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;            len = 1 + <a class="code" href="../../df/d79/tls_8h.html#a425a184a16fed72c4bfd80c8798126ef">P256_KEYSIZE</a> * 2;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        }</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        record-&gt;key[0] = len;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;        len++;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        premaster_size = <a class="code" href="../../df/d79/tls_8h.html#a425a184a16fed72c4bfd80c8798126ef">P256_KEYSIZE</a>; <span class="comment">// = CURVE25519_KEYSIZE = 32</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    }</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160; </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    record-&gt;type = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af6fec2c761a9132b14de85d3fe0ecbb1">HANDSHAKE_CLIENT_KEY_EXCHANGE</a>;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <span class="comment">/* record-&gt;len24_hi = 0; - already is */</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    record-&gt;len24_mid = len &gt;&gt; 8;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    record-&gt;len24_lo  = len &amp; 0xff;</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    len += 4;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160; </div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&gt;&gt; CLIENT_KEY_EXCHANGE\n&quot;</span>);</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa98352b3587a985366c092e548025daa">xwrite_and_update_handshake_hash</a>(tls, len);</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160; </div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <span class="comment">// RFC 5246</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <span class="comment">// For all key exchange methods, the same algorithm is used to convert</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="comment">// the pre_master_secret into the master_secret.  The pre_master_secret</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="comment">// should be deleted from memory once the master_secret has been</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="comment">// computed.</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    <span class="comment">//      master_secret = PRF(pre_master_secret, &quot;master secret&quot;,</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <span class="comment">//                          ClientHello.random + ServerHello.random)</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="comment">//                          [0..47];</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="comment">// The master secret is always exactly 48 bytes in length.  The length</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="comment">// of the premaster secret will vary depending on key exchange method.</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa2dc08633a73a135c328a2ca9f19ae93">prf_hmac_sha256</a>(<span class="comment">/*tls,*/</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>, <span class="keyword">sizeof</span>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>),</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        premaster, premaster_size,</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        <span class="stringliteral">&quot;master secret&quot;</span>,</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">client_and_server_rand32</a>, <span class="keyword">sizeof</span>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">client_and_server_rand32</a>)</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    );</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;master secret:%s\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>, <span class="keyword">sizeof</span>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>));</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160; </div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <span class="comment">// RFC 5246</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="comment">// 6.3.  Key Calculation</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="comment">// The Record Protocol requires an algorithm to generate keys required</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="comment">// by the current connection state (see Appendix A.6) from the security</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="comment">// parameters provided by the handshake protocol.</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <span class="comment">// The master secret is expanded into a sequence of secure bytes, which</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="comment">// is then split to a client write MAC key, a server write MAC key, a</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="comment">// client write encryption key, and a server write encryption key.  Each</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    <span class="comment">// of these is generated from the byte sequence in that order.  Unused</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="comment">// values are empty.  Some AEAD ciphers may additionally require a</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <span class="comment">// client write IV and a server write IV (see Section 6.2.3.3).</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    <span class="comment">// When keys and MAC keys are generated, the master secret is used as an</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="comment">// entropy source.</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    <span class="comment">// To generate the key material, compute</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    <span class="comment">//    key_block = PRF(SecurityParameters.master_secret,</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="comment">//                    &quot;key expansion&quot;,</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    <span class="comment">//                    SecurityParameters.server_random +</span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="comment">//                    SecurityParameters.client_random);</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="comment">// until enough output has been generated.  Then, the key_block is</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="comment">// partitioned as follows:</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    <span class="comment">//    client_write_MAC_key[SecurityParameters.mac_key_length]</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="comment">//    server_write_MAC_key[SecurityParameters.mac_key_length]</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="comment">//    client_write_key[SecurityParameters.enc_key_length]</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    <span class="comment">//    server_write_key[SecurityParameters.enc_key_length]</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    <span class="comment">//    client_write_IV[SecurityParameters.fixed_iv_length]</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <span class="comment">//    server_write_IV[SecurityParameters.fixed_iv_length]</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    {</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> tmp64[64];</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160; </div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;        <span class="comment">/* make &quot;server_rand32 + client_rand32&quot; */</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(&amp;tmp64[0] , &amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">client_and_server_rand32</a>[32], 32);</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        <a class="code" href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a>(&amp;tmp64[32], &amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">client_and_server_rand32</a>[0] , 32);</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160; </div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa2dc08633a73a135c328a2ca9f19ae93">prf_hmac_sha256</a>(<span class="comment">/*tls,*/</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2cdb203347dbcef4eca0eb64e34eaafb">client_write_MAC_key</a>, 2 * (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a> + tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a> + tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aca4af3524ef06062af2698c9250852df">IV_size</a>),</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            <span class="comment">// also fills:</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            <span class="comment">// server_write_MAC_key[]</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;            <span class="comment">// client_write_key[]</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;            <span class="comment">// server_write_key[]</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;            <span class="comment">// client_write_IV[]</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            <span class="comment">// server_write_IV[]</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>, <span class="keyword">sizeof</span>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>),</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;            <span class="stringliteral">&quot;key expansion&quot;</span>,</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            tmp64, 64</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        );</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a892a2d1e073add97dc0a329a2491c8a7">client_write_key</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2cdb203347dbcef4eca0eb64e34eaafb">client_write_MAC_key</a> + (2 * tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a>);</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a40c558ab1e0d19a1daabe3f93ea7f386">server_write_key</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a892a2d1e073add97dc0a329a2491c8a7">client_write_key</a> + tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a>;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8e61995c5e80de8de0758d4e3cd2d813">client_write_IV</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a40c558ab1e0d19a1daabe3f93ea7f386">server_write_key</a> + tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a>;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8a2e906eabcc782224d0052ccd982bac">server_write_IV</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8e61995c5e80de8de0758d4e3cd2d813">client_write_IV</a> + tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aca4af3524ef06062af2698c9250852df">IV_size</a>;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;client_write_MAC_key:%s\n&quot;</span>,</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2cdb203347dbcef4eca0eb64e34eaafb">client_write_MAC_key</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        );</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;client_write_key:%s\n&quot;</span>,</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a892a2d1e073add97dc0a329a2491c8a7">client_write_key</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        );</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;client_write_IV:%s\n&quot;</span>,</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;            tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a8e61995c5e80de8de0758d4e3cd2d813">client_write_IV</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aca4af3524ef06062af2698c9250852df">IV_size</a></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        );</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160; </div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <a class="code" href="../../da/d19/tls__aes_8c.html#ab0532a9a23c65027d3415dc787039111">aes_setkey</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a88fa0c83bbd38b4af978843d8a48070e">aes_decrypt</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a40c558ab1e0d19a1daabe3f93ea7f386">server_write_key</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a>);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        <a class="code" href="../../da/d19/tls__aes_8c.html#ab0532a9a23c65027d3415dc787039111">aes_setkey</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a81d69881a03f3e32b71188d9c9835723">aes_encrypt</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a892a2d1e073add97dc0a329a2491c8a7">client_write_key</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">key_size</a>);</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        {</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;            <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> iv[<a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>];</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;            <a class="code" href="../../da/d68/apps_2base_2bash_2lib_2sh_2memset_8c.html#a19588d2006eb37347ebae632befc20e5">memset</a>(iv, 0, <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>);</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;            <a class="code" href="../../da/d19/tls__aes_8c.html#a7adc23b56bee623cd7a5414445e83000">aes_encrypt_one_block</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a81d69881a03f3e32b71188d9c9835723">aes_encrypt</a>, iv, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a9ea11289d0d3d9ed7c24e05d45641e89">H</a>);</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        }</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    }</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;}</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160; </div>
<div class="line"><a name="l02146"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6fdabf8c5e75c237e9c930b1ec6dbd1a"> 2146</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> rec_CHANGE_CIPHER_SPEC[] <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6fdabf8c5e75c237e9c930b1ec6dbd1a">ALIGN1</a> = {</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#affdc252da7a09312e24f379b8d1f1330">RECORD_TYPE_CHANGE_CIPHER_SPEC</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a>, 00, 01,</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    01</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;};</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160; </div>
<div class="line"><a name="l02151"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa5342199f06c7961763f5a440698f1ab"> 2151</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa5342199f06c7961763f5a440698f1ab">send_change_cipher_spec</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;{</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&gt;&gt; CHANGE_CIPHER_SPEC\n&quot;</span>);</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#a406e6e7d1c51da582c1e82632b1f2bce">xwrite</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#adcd945f007cfde4259ee212d57e5a472">ofd</a>, rec_CHANGE_CIPHER_SPEC, <span class="keyword">sizeof</span>(rec_CHANGE_CIPHER_SPEC));</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;}</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160; </div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="comment">// 7.4.9.  Finished</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">// A Finished message is always sent immediately after a change</span></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="comment">// cipher spec message to verify that the key exchange and</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment">// authentication processes were successful.  It is essential that a</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment">// change cipher spec message be received between the other handshake</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment">// messages and the Finished message.</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="comment">//...</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment">// The Finished message is the first one protected with the just</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="comment">// negotiated algorithms, keys, and secrets.  Recipients of Finished</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment">// messages MUST verify that the contents are correct.  Once a side</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="comment">// has sent its Finished message and received and validated the</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="comment">// Finished message from its peer, it may begin to send and receive</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="comment">// application data over the connection.</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="comment">//...</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="comment">// struct {</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="comment">//     opaque verify_data[verify_data_length];</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="comment">// } Finished;</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="comment">// verify_data</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment">//    PRF(master_secret, finished_label, Hash(handshake_messages))</span></div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="comment">//       [0..verify_data_length-1];</span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="comment">// finished_label</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="comment">//    For Finished messages sent by the client, the string</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="comment">//    &quot;client finished&quot;.  For Finished messages sent by the server,</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;<span class="comment">//    the string &quot;server finished&quot;.</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment">// Hash denotes a Hash of the handshake messages.  For the PRF</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">// defined in Section 5, the Hash MUST be the Hash used as the basis</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment">// for the PRF.  Any cipher suite which defines a different PRF MUST</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment">// also define the Hash to use in the Finished computation.</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="comment">// In previous versions of TLS, the verify_data was always 12 octets</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment">// long.  In the current version of TLS, it depends on the cipher</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="comment">// suite.  Any cipher suite which does not explicitly specify</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="comment">// verify_data_length has a verify_data_length equal to 12.  This</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;<span class="comment">// includes all existing cipher suites.</span></div>
<div class="line"><a name="l02194"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a94091d03ce74d94f9a7139f94e9cd983"> 2194</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a94091d03ce74d94f9a7139f94e9cd983">send_client_finished</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls)</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;{</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d23/wi__stuff_8c.html#a12a98bf5e50456cf27fc53cea0e1898f">finished</a> {</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> <a class="code" href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a>;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> len24_hi, len24_mid, len24_lo;</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> prf_result[12];</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    };</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d23/wi__stuff_8c.html#a12a98bf5e50456cf27fc53cea0e1898f">finished</a> *record = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad08080727341a265d82ff2761fa7bddc">tls_get_outbuf</a>(tls, <span class="keyword">sizeof</span>(*record));</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> handshake_hash[<a class="code" href="../../d7/dd7/libbb_8h.html#a6d262c2876457dc50108802ded585abc">TLS_MAX_MAC_SIZE</a>];</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="keywordtype">unsigned</span> len;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160; </div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2acf5a199836fd199ff326e1446dac84">fill_handshake_record_hdr</a>(record, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac9f5d59963e64f2edd81e2642566eaaf">HANDSHAKE_FINISHED</a>, <span class="keyword">sizeof</span>(*record));</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160; </div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    len = <a class="code" href="../../d7/dd7/libbb_8h.html#a5b67932d25a41873f6841c48833c4778">sha_end</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a087b69ab91f3b4fa570daccc680043af">handshake_hash_ctx</a>, handshake_hash);</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160; </div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa2dc08633a73a135c328a2ca9f19ae93">prf_hmac_sha256</a>(<span class="comment">/*tls,*/</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        record-&gt;prf_result, <span class="keyword">sizeof</span>(record-&gt;prf_result),</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>, <span class="keyword">sizeof</span>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>),</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        <span class="stringliteral">&quot;client finished&quot;</span>,</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        handshake_hash, len</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    );</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;from secret: %s\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>, <span class="keyword">sizeof</span>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">master_secret</a>));</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;from labelSeed: %s&quot;</span>, <span class="stringliteral">&quot;client finished&quot;</span>, <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;client finished&quot;</span>)-1);</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, handshake_hash, <span class="keyword">sizeof</span>(handshake_hash));</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a>(<span class="stringliteral">&quot;=&gt; digest: %s\n&quot;</span>, record-&gt;prf_result, <span class="keyword">sizeof</span>(record-&gt;prf_result));</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160; </div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&gt;&gt; FINISHED\n&quot;</span>);</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a99d80378865343f69b5f50b1414fce94">xwrite_encrypted</a>(tls, <span class="keyword">sizeof</span>(*record), <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a222955be70285ace97b0fffa2b082f5d">RECORD_TYPE_HANDSHAKE</a>);</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;}</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160; </div>
<div class="line"><a name="l02224"></a><span class="lineno"><a class="line" href="../../d7/dd7/libbb_8h.html#aeebc54fb71c726d52c057c695bf36984"> 2224</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/dd7/libbb_8h.html#a9e5609718f2d1fe5ead7714b3d45223b">FAST_FUNC</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7545daeef48814f53e1ed124ed0993fe">tls_handshake</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keyword">const</span> <span class="keywordtype">char</span> *sni)</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;{</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <span class="comment">// Client              RFC 5246                Server</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    <span class="comment">// (*) - optional messages, not always sent</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="comment">// ClientHello          -------&gt;</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <span class="comment">//                                        ServerHello</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="comment">//                                       Certificate*</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    <span class="comment">//                                 ServerKeyExchange*</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    <span class="comment">//                                CertificateRequest*</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="comment">//                      &lt;-------      ServerHelloDone</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    <span class="comment">// Certificate*</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="comment">// ClientKeyExchange</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <span class="comment">// CertificateVerify*</span></div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    <span class="comment">// [ChangeCipherSpec]</span></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <span class="comment">// Finished             -------&gt;</span></div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    <span class="comment">//                                 [ChangeCipherSpec]</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <span class="comment">//                      &lt;-------             Finished</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    <span class="comment">// Application Data     &lt;------&gt;     Application Data</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <span class="keywordtype">int</span> len;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;    <span class="keywordtype">int</span> got_cert_req;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160; </div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a88d1fbaaaab3a6bf00fc377c8bade1e3">send_client_hello_and_alloc_hsd</a>(tls, sni);</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2e3afc5d10bf3345d671b82ee8f5fba6">get_server_hello</a>(tls);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160; </div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    <span class="comment">// RFC 5246</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="comment">// The server MUST send a Certificate message whenever the agreed-</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    <span class="comment">// upon key exchange method uses certificates for authentication</span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    <span class="comment">// (this includes all key exchange methods defined in this document</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="comment">// except DH_anon).  This message will always immediately follow the</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    <span class="comment">// ServerHello message.</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;    <span class="comment">// IOW: in practice, Certificate *always* follows.</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    <span class="comment">// (for example, kernel.org does not even accept DH_anon cipher id)</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af2feecdca663721aca648de25a775a92">get_server_cert</a>(tls);</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160; </div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac3d09a13305957afd7599d4f92dbf0bd">tls_xread_handshake_block</a>(tls, 4);</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>[<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>] == <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a04e8d99b04258c8ba86e7a02aa9c97ee">HANDSHAKE_SERVER_KEY_EXCHANGE</a>) {</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        <span class="comment">// 459 bytes:</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="comment">// 0c   00|01|c7 03|00|17|41|04|87|94|2e|2f|68|d0|c9|f4|97|a8|2d|ef|ed|67|ea|c6|f3|b3|56|47|5d|27|b6|bd|ee|70|25|30|5e|b0|8e|f6|21|5a...</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        <span class="comment">//SvKey len=455^</span></div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        <span class="comment">// with TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA: 461 bytes:</span></div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        <span class="comment">// 0c   00|01|c9 03|00|17|41|04|cd|9b|b4|29|1f|f6|b0|c2|84|82|7f|29|6a|47|4e|ec|87|0b|c1|9c|69|e1|f8|c6|d0|53|e9|27|90|a5|c8|02|15|75...</span></div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        <span class="comment">// RFC 8422 5.4. Server Key Exchange</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;        <span class="comment">// This message is sent when using the ECDHE_ECDSA, ECDHE_RSA, and</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;        <span class="comment">// ECDH_anon key exchange algorithms.</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;        <span class="comment">// This message is used to convey the server&#39;s ephemeral ECDH public key</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;        <span class="comment">// (and the corresponding elliptic curve domain parameters) to the</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        <span class="comment">// client.</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&lt;&lt; SERVER_KEY_EXCHANGE len:%u\n&quot;</span>, len);</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a333b9382c44248475f73712fea669957">dump_raw_in</a>(<span class="stringliteral">&quot;&lt;&lt; %s\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a> + len);</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab38dc88e6d70f9206569c50c1d895b85">NEED_EC_KEY</a>)</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af31e97ebfa62c1b74e19b4c6c4b9fb14">process_server_key</a>(tls, len);</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160; </div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <span class="comment">// read next handshake block</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac3d09a13305957afd7599d4f92dbf0bd">tls_xread_handshake_block</a>(tls, 4);</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    }</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160; </div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    got_cert_req = (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>[<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>] == <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac9e8bf191ea759b5700441d0a9d807dd">HANDSHAKE_CERTIFICATE_REQUEST</a>);</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="keywordflow">if</span> (got_cert_req) {</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&lt;&lt; CERTIFICATE_REQUEST\n&quot;</span>);</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        <span class="comment">// RFC 5246: &quot;If no suitable certificate is available,</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;        <span class="comment">// the client MUST send a certificate message containing no</span></div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        <span class="comment">// certificates.  That is, the certificate_list structure has a</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        <span class="comment">// length of zero. ...</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        <span class="comment">// Client certificates are sent using the Certificate structure</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        <span class="comment">// defined in Section 7.4.2.&quot;</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="comment">// (i.e. the same format as server certs)</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160; </div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        <span class="comment">/*send_empty_client_cert(tls); - WRONG (breaks handshake hash calc) */</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        <span class="comment">/* need to hash _all_ server replies first, up to ServerHelloDone */</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac3d09a13305957afd7599d4f92dbf0bd">tls_xread_handshake_block</a>(tls, 4);</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    }</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160; </div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>[<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>] != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab20655e202f5053dec1ab4671afb04b2">HANDSHAKE_SERVER_HELLO_DONE</a>) {</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;&#39;server hello done&#39;&quot;</span>, len);</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    }</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="comment">// 0e 000000 (len:0)</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&lt;&lt; SERVER_HELLO_DONE\n&quot;</span>);</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160; </div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    <span class="keywordflow">if</span> (got_cert_req)</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7543ee146e14655d2038f2262892b775">send_empty_client_cert</a>(tls);</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160; </div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9f0a3442d9f5f618d514c99bbf36e8b7">send_client_key_exchange</a>(tls);</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160; </div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa5342199f06c7961763f5a440698f1ab">send_change_cipher_spec</a>(tls);</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="comment">/* from now on we should send encrypted */</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <span class="comment">/* tls-&gt;write_seq64_be = 0; - already is */</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> |= <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a341620e2929e799f062087e23e49d5e1">ENCRYPT_ON_WRITE</a>;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160; </div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a94091d03ce74d94f9a7139f94e9cd983">send_client_finished</a>(tls);</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160; </div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    <span class="comment">/* Get CHANGE_CIPHER_SPEC */</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ced00f2b51163b6af88d6de7673cebc">tls_xread_record</a>(tls, <span class="stringliteral">&quot;switch to encrypted traffic&quot;</span>);</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <span class="keywordflow">if</span> (len != 1 || <a class="code" href="../../d6/d32/musl_2include_2string_8h.html#a0849c52baadd8269575bc57e2273d862">memcmp</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>, rec_CHANGE_CIPHER_SPEC, 6) != 0)</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;switch to encrypted traffic&quot;</span>, len);</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&lt;&lt; CHANGE_CIPHER_SPEC\n&quot;</span>);</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160; </div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af60cb3c889da6403866b3087adf587c3">ALLOW_RSA_NULL_SHA256</a></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;     &amp;&amp; tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a1d74dab2b4a31237fec264b4ebb3ede6">cipher_id</a> == <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae388fc0dbac04b3d5717fd447eaec61d">TLS_RSA_WITH_NULL_SHA256</a></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    ) {</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">min_encrypted_len_on_read</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">MAC_size</a>;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    <span class="keywordflow">if</span> (!(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">flags</a> &amp; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2">ENCRYPTION_AESGCM</a>)) {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        <span class="keywordtype">unsigned</span> mac_blocks = (unsigned)(<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">TLS_MAC_SIZE</a>(tls) + <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>-1) / <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        <span class="comment">/* all incoming packets now should be encrypted and have</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="comment">         * at least IV + (MAC padded to blocksize):</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">min_encrypted_len_on_read</a> = <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a> + (mac_blocks * <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>);</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;        tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">min_encrypted_len_on_read</a> = 8 + <a class="code" href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a>;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    }</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;min_encrypted_len_on_read: %u\n&quot;</span>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">min_encrypted_len_on_read</a>);</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160; </div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    <span class="comment">/* Get (encrypted) FINISHED from the server */</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    len = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ced00f2b51163b6af88d6de7673cebc">tls_xread_record</a>(tls, <span class="stringliteral">&quot;&#39;server finished&#39;&quot;</span>);</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="keywordflow">if</span> (len &lt; 4 || tls-&gt;<a class="code" href="../../de/dc7/chat_8c.html#aa28364b44ea5d1bde8c124cb01039175">inbuf</a>[<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>] != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac9f5d59963e64f2edd81e2642566eaaf">HANDSHAKE_FINISHED</a>)</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;        <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;&#39;server finished&#39;&quot;</span>, len);</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&lt;&lt; FINISHED\n&quot;</span>);</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <span class="comment">/* application data can be sent/received */</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160; </div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <span class="comment">/* free handshake data */</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <a class="code" href="../../d4/df3/tls__rsa_8h.html#a307028cfdbae5ee7a1b91c56070cd78c">psRsaKey_clear</a>(&amp;tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>-&gt;<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">server_rsa_pub_key</a>);</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment">//  if (PARANOIA)</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment">//      memset(tls-&gt;hsd, 0, tls-&gt;hsd-&gt;hsd_size);</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <a class="code" href="../../d5/db0/dynlink_8c.html#a2c6efa7679f8cd9f61af96e105017560">free</a>(tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a>);</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">hsd</a> = <a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;}</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160; </div>
<div class="line"><a name="l02354"></a><span class="lineno"><a class="line" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac03bf5d8be4418a97222bad938852021"> 2354</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac03bf5d8be4418a97222bad938852021">tls_xwrite</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">int</span> len)</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;{</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;&gt;&gt; DATA\n&quot;</span>);</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a99d80378865343f69b5f50b1414fce94">xwrite_encrypted</a>(tls, len, <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6535ec67b879b714910dd2318b2aee41">RECORD_TYPE_APPLICATION_DATA</a>);</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;}</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160; </div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="comment">// To run a test server using openssl:</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="comment">// openssl req -x509 -newkey rsa:$((4096/4*3)) -keyout key.pem -out server.pem -nodes -days 99999 -subj &#39;/CN=localhost&#39;</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="comment">// openssl s_server -key key.pem -cert server.pem -debug -tls1_2</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment">// Unencryped SHA256 example:</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="comment">// openssl req -x509 -newkey rsa:$((4096/4*3)) -keyout key.pem -out server.pem -nodes -days 99999 -subj &#39;/CN=localhost&#39;</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment">// openssl s_server -key key.pem -cert server.pem -debug -tls1_2 -cipher NULL</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="comment">// openssl s_client -connect 127.0.0.1:4433 -debug -tls1_2 -cipher NULL-SHA256</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160; </div>
<div class="line"><a name="l02369"></a><span class="lineno"><a class="line" href="../../d7/dd7/libbb_8h.html#a8d5fb49c0e9ec0811d66b93291f647f3"> 2369</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/dd7/libbb_8h.html#a9e5609718f2d1fe5ead7714b3d45223b">FAST_FUNC</a> <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a435ac9529fae91027f18582ada731a48">tls_run_copy_loop</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state_t</a> *tls, <span class="keywordtype">unsigned</span> <a class="code" href="../../db/d66/dumpkmap_8c.html#abb0829cce9dd20a40ae0d86890ae85c6">flags</a>)</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;{</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="keywordtype">int</span> inbuf_size;</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> INBUF_STEP = 4 * 1024;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/da4/include_2poll_8h.html#de/dd7/structpollfd">pollfd</a> pfds[2];</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160; </div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment">// Debug aid for comparing P256 implementations.</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment">// Enable this, set SP_DEBUG and FIXED_SECRET to 1,</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment">// and add</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">//  tls_run_copy_loop(NULL, 0);</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">// e.g. at the very beginning of wget_main()</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;{</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> ecc_pub_key32[2 * 32];</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> pubkey2x32[2 * 32];</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <a class="code" href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a> premaster32[32];</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160; </div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment">//Fixed input key:</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="comment">//  memset(ecc_pub_key32, 0xee, sizeof(ecc_pub_key32));</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment">//Fixed 000000000000000000000000000000000000ab000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="comment">//  memset(ecc_pub_key32, 0x00, sizeof(ecc_pub_key32));</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="comment">//  ecc_pub_key32[18] = 0xab;</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">//Random key:</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">//  tls_get_random(ecc_pub_key32, sizeof(ecc_pub_key32));</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment">//Biased random (almost all zeros or almost all ones):</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <a class="code" href="../../d4/daf/musl_2include_2stdlib_8h.html#aa7cb61cef6d19542fccc5cabf47f96eb">srand</a>(<a class="code" href="../../d4/d02/musl_2include_2time_8h.html#aae026724f73c36340024c657f4f44dab">time</a>(<a class="code" href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ^ <a class="code" href="../../d3/d3a/jobs_8h.html#add1dc6545057b7f1c7f91352536fb060">getpid</a>());</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/daf/musl_2include_2stdlib_8h.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a>() &amp; 1)</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;        <a class="code" href="../../da/d68/apps_2base_2bash_2lib_2sh_2memset_8c.html#a19588d2006eb37347ebae632befc20e5">memset</a>(ecc_pub_key32, 0x00, <span class="keyword">sizeof</span>(ecc_pub_key32));</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;        <a class="code" href="../../da/d68/apps_2base_2bash_2lib_2sh_2memset_8c.html#a19588d2006eb37347ebae632befc20e5">memset</a>(ecc_pub_key32, 0xff, <span class="keyword">sizeof</span>(ecc_pub_key32));</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    ecc_pub_key32[<a class="code" href="../../d4/daf/musl_2include_2stdlib_8h.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a>() &amp; 0x3f] = <a class="code" href="../../d4/daf/musl_2include_2stdlib_8h.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a>();</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160; </div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#ad480de907b2c37655e34b8aa0ee3f158">xmove_fd</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#aa3e94e3ec137f40660b168c9f0840027">xopen</a>(<span class="stringliteral">&quot;p256.OLD&quot;</span>, <a class="code" href="../../d2/d44/musl_2include_2fcntl_8h.html#a11b644a8526139c4cc1850dac1271ced">O_WRONLY</a> | <a class="code" href="../../d7/d86/musl_2arch_2aarch64_2bits_2fcntl_8h.html#a1cf6b1de1fffedaa1d26b189e9a8d2cc">O_CREAT</a> | <a class="code" href="../../d7/d86/musl_2arch_2aarch64_2bits_2fcntl_8h.html#ad1d67e453fb3031f40f8cd3403773813">O_TRUNC</a>), 2);</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    <a class="code" href="../../df/d79/tls_8h.html#a0442fa1d28f0e7d3826cbc26d708ce82">curve_P256_compute_pubkey_and_premaster</a>(</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;            pubkey2x32, premaster32,</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;            <span class="comment">/*point:*/</span> ecc_pub_key32</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    );</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;    <a class="code" href="../../d7/dd7/libbb_8h.html#ad480de907b2c37655e34b8aa0ee3f158">xmove_fd</a>(<a class="code" href="../../d7/dd7/libbb_8h.html#aa3e94e3ec137f40660b168c9f0840027">xopen</a>(<span class="stringliteral">&quot;p256.NEW&quot;</span>, <a class="code" href="../../d2/d44/musl_2include_2fcntl_8h.html#a11b644a8526139c4cc1850dac1271ced">O_WRONLY</a> | <a class="code" href="../../d7/d86/musl_2arch_2aarch64_2bits_2fcntl_8h.html#a1cf6b1de1fffedaa1d26b189e9a8d2cc">O_CREAT</a> | <a class="code" href="../../d7/d86/musl_2arch_2aarch64_2bits_2fcntl_8h.html#ad1d67e453fb3031f40f8cd3403773813">O_TRUNC</a>), 2);</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    <a class="code" href="../../df/d79/tls_8h.html#a5856547b4cfd5097964fa1507bf76536">curve_P256_compute_pubkey_and_premaster_NEW</a>(</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;            pubkey2x32, premaster32,</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;            <span class="comment">/*point:*/</span> ecc_pub_key32</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;    );</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    <a class="code" href="../../d9/df8/include_2ansi__stdlib_8h.html#a358d2e2397ca11ccd17553e3c40e7901">exit</a>(1);</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;}</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160; </div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    pfds[0].<a class="code" href="../../d1/da4/include_2poll_8h.html#a57e1c316fb063e468d680b6246147861">fd</a> = <a class="code" href="../../d6/d4f/excallback_8c.html#afcf80a6d91178952d107ad00b165752b">STDIN_FILENO</a>;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    pfds[0].<a class="code" href="../../d1/da4/include_2poll_8h.html#ac9b2f2c5b1f9a7487eb57e67cd4960ef">events</a> = <a class="code" href="../../d1/da4/include_2poll_8h.html#a52ac479a805051f59643588b096024ff">POLLIN</a>;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;    pfds[1].<a class="code" href="../../d1/da4/include_2poll_8h.html#a57e1c316fb063e468d680b6246147861">fd</a> = tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#a24e6feeade1f420ae684358c71ede5cc">ifd</a>;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;    pfds[1].<a class="code" href="../../d1/da4/include_2poll_8h.html#ac9b2f2c5b1f9a7487eb57e67cd4960ef">events</a> = <a class="code" href="../../d1/da4/include_2poll_8h.html#a52ac479a805051f59643588b096024ff">POLLIN</a>;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160; </div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    inbuf_size = INBUF_STEP;</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;        <span class="keywordtype">int</span> nread;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160; </div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/libbb_8h.html#a17790c4da72b3cd02302e9e352b63ab2">safe_poll</a>(pfds, 2, -1) &lt; 0)</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#a908d5535f4c6167da1ac613b29f4b7e4">bb_simple_perror_msg_and_die</a>(<span class="stringliteral">&quot;poll&quot;</span>);</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160; </div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <span class="keywordflow">if</span> (pfds[0].<a class="code" href="../../d1/da4/include_2poll_8h.html#aafb457d11cac415faf0e1e2b825118c2">revents</a>) {</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;            <span class="keywordtype">void</span> *<a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>;</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160; </div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;STDIN HAS DATA\n&quot;</span>);</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a> = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad08080727341a265d82ff2761fa7bddc">tls_get_outbuf</a>(tls, inbuf_size);</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;            nread = <a class="code" href="../../d7/dd7/libbb_8h.html#afd9749b5c9728a4e5d0f2c00663a89af">safe_read</a>(<a class="code" href="../../d6/d4f/excallback_8c.html#afcf80a6d91178952d107ad00b165752b">STDIN_FILENO</a>, <a class="code" href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a>, inbuf_size);</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;            <span class="keywordflow">if</span> (nread &lt; 1) {</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                <span class="comment">/* We&#39;d want to do this: */</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                <span class="comment">/* Close outgoing half-connection so they get EOF,</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;<span class="comment">                 * but leave incoming alone so we can see response</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                <span class="comment">//shutdown(tls-&gt;ofd, SHUT_WR);</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                <span class="comment">/* But TLS has no way to encode this,</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="comment">                 * doubt it&#39;s ok to do it &quot;raw&quot;</span></div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                pfds[0].<a class="code" href="../../d1/da4/include_2poll_8h.html#a57e1c316fb063e468d680b6246147861">fd</a> = -1;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3127dcb28fa0efcf6be6157085ce1dd6">tls_free_outbuf</a>(tls); <span class="comment">/* mem usage optimization */</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../db/d66/dumpkmap_8c.html#abb0829cce9dd20a40ae0d86890ae85c6">flags</a> &amp; <a class="code" href="../../d7/dd7/libbb_8h.html#ad72136bbc3cff66a5995570da1b17dd7">TLSLOOP_EXIT_ON_LOCAL_EOF</a>)</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                <span class="keywordflow">if</span> (nread == inbuf_size) {</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                    <span class="comment">/* TLS has per record overhead, if input comes fast,</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;<span class="comment">                     * read, encrypt and send bigger chunks</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;<span class="comment">                     */</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                    inbuf_size += INBUF_STEP;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                    <span class="keywordflow">if</span> (inbuf_size &gt; <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8e5b1766844eb48b2a9fdacb9ce26f14">TLS_MAX_OUTBUF</a>)</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                        inbuf_size = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8e5b1766844eb48b2a9fdacb9ce26f14">TLS_MAX_OUTBUF</a>;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                }</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac03bf5d8be4418a97222bad938852021">tls_xwrite</a>(tls, nread);</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;            }</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        }</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;        <span class="keywordflow">if</span> (pfds[1].<a class="code" href="../../d1/da4/include_2poll_8h.html#aafb457d11cac415faf0e1e2b825118c2">revents</a>) {</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;            <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<span class="stringliteral">&quot;NETWORK HAS DATA\n&quot;</span>);</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160; read_record:</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;            nread = <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ced00f2b51163b6af88d6de7673cebc">tls_xread_record</a>(tls, <span class="stringliteral">&quot;encrypted data&quot;</span>);</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;            <span class="keywordflow">if</span> (nread &lt; 1) {</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                <span class="comment">/* TLS protocol has no real concept of one-sided shutdowns:</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="comment">                 * if we get &quot;TLS EOF&quot; from the peer, writes will fail too</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                <span class="comment">//pfds[1].fd = -1;</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                <span class="comment">//close(STDOUT_FILENO);</span></div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                <span class="comment">//tls_free_inbuf(tls); /* mem usage optimization */</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                <span class="comment">//continue;</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;            }</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;            <span class="keywordflow">if</span> (tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a>[0] != <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6535ec67b879b714910dd2318b2aee41">RECORD_TYPE_APPLICATION_DATA</a>)</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a>(tls, <span class="stringliteral">&quot;encrypted data&quot;</span>, nread);</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            <a class="code" href="../../d7/dd7/libbb_8h.html#a406e6e7d1c51da582c1e82632b1f2bce">xwrite</a>(<a class="code" href="../../de/d97/musl_2include_2unistd_8h.html#abd165ee6474b5b75bf075842fff13a04">STDOUT_FILENO</a>, tls-&gt;<a class="code" href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">inbuf</a> + <a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a>, nread);</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;            <span class="comment">/* We may already have a complete next record buffered,</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="comment">             * can process it without network reads (and possible blocking)</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aaf98a8ebe0ffc4e0179476f6535a9c10">tls_has_buffered_record</a>(tls))</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                <span class="keywordflow">goto</span> read_record;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        }</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;    }</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;}</div>
<div class="ttc" id="aapps_2base_2bash_2lib_2sh_2memset_8c_html_a19588d2006eb37347ebae632befc20e5"><div class="ttname"><a href="../../da/d68/apps_2base_2bash_2lib_2sh_2memset_8c.html#a19588d2006eb37347ebae632befc20e5">memset</a></div><div class="ttdeci">char * memset(char *str, int c, unsigned int len)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d68/apps_2base_2bash_2lib_2sh_2memset_8c_source.html#l00022">memset.c:22</a></div></div>
<div class="ttc" id="aapps_2base_2bash_2lib_2sh_2snprintf_8c_html_a1ac817b5f23758eecbaa62dde9068b70"><div class="ttname"><a href="../../d4/db1/apps_2base_2bash_2lib_2sh_2snprintf_8c.html#a1ac817b5f23758eecbaa62dde9068b70">itoa</a></div><div class="ttdeci">#define itoa(n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/db1/apps_2base_2bash_2lib_2sh_2snprintf_8c_source.html#l00223">snprintf.c:223</a></div></div>
<div class="ttc" id="aapps_2base_2bash_2lib_2sh_2strnlen_8c_html_afc92d2231e45d19988c7894aa2a07f0c"><div class="ttname"><a href="../../d1/d45/apps_2base_2bash_2lib_2sh_2strnlen_8c.html#afc92d2231e45d19988c7894aa2a07f0c">strnlen</a></div><div class="ttdeci">size_t strnlen(const char *s, size_t maxlen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d45/apps_2base_2bash_2lib_2sh_2strnlen_8c_source.html#l00038">strnlen.c:38</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2coreutils_2stat_8c_html_aa29b866765bdc5bdf87b7eb666d66093"><div class="ttname"><a href="../../d7/d2f/apps_2base_2busybox_2coreutils_2stat_8c.html#aa29b866765bdc5bdf87b7eb666d66093">buf</a></div><div class="ttdeci">#define buf</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a04e8d99b04258c8ba86e7a02aa9c97ee"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a04e8d99b04258c8ba86e7a02aa9c97ee">HANDSHAKE_SERVER_KEY_EXCHANGE</a></div><div class="ttdeci">#define HANDSHAKE_SERVER_KEY_EXCHANGE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00086">tls.c:86</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a0681bb67727c2a6f8c87aa71b3ea692f"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0681bb67727c2a6f8c87aa71b3ea692f">ALLOW_RSA_WITH_AES_128_GCM_SHA256</a></div><div class="ttdeci">#define ALLOW_RSA_WITH_AES_128_GCM_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00034">tls.c:34</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a087b69ab91f3b4fa570daccc680043af"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a087b69ab91f3b4fa570daccc680043af">tls_handshake_data::handshake_hash_ctx</a></div><div class="ttdeci">md5sha_ctx_t handshake_hash_ctx</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00258">tls.c:258</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a091527eb31e6f2ec4e81aea8a7249b33"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a091527eb31e6f2ec4e81aea8a7249b33">hmac_begin</a></div><div class="ttdeci">#define hmac_begin(pre, key, key_size, begin)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00413">tls.c:413</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a0d3a7ba9c02b5936c01bfec5968cf701"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0d3a7ba9c02b5936c01bfec5968cf701">hmac_precomputed::hashed_key_xor_ipad</a></div><div class="ttdeci">md5sha_ctx_t hashed_key_xor_ipad</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00407">tls.c:407</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a0ed4142828e820e1aa9bea863a34a288"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a0ed4142828e820e1aa9bea863a34a288">ALLOW_CURVE_X25519</a></div><div class="ttdeci">#define ALLOW_CURVE_X25519</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00036">tls.c:36</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a1220507db99ba87bb7b45b03ec9b9f0b"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1220507db99ba87bb7b45b03ec9b9f0b">RECORD_TYPE_ALERT</a></div><div class="ttdeci">#define RECORD_TYPE_ALERT</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00076">tls.c:76</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a148c12e9a5cdf45e8af24cdd4765306f"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a148c12e9a5cdf45e8af24cdd4765306f">COUNTER</a></div><div class="ttdeci">#define COUNTER(v)</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a152bb318366725ff282862bdb879c4ba"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a152bb318366725ff282862bdb879c4ba">ALLOW_ECDHE_RSA_WITH_AES_128_CBC_SHA256</a></div><div class="ttdeci">#define ALLOW_ECDHE_RSA_WITH_AES_128_CBC_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00029">tls.c:29</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a161e5e32461eaeb74bad1a262fc31113"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a161e5e32461eaeb74bad1a262fc31113">hmac_sha_precomputed</a></div><div class="ttdeci">static unsigned hmac_sha_precomputed(hmac_precomputed_t *pre_init, uint8_t *out,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00482">tls.c:482</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a17587c084c1a5cc32cb438327af2fe28"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a17587c084c1a5cc32cb438327af2fe28">tls_handshake_data::client_and_server_rand32</a></div><div class="ttdeci">uint8_t client_and_server_rand32[2 *32]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00260">tls.c:260</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a1ca66c805d202d279faca9feacced57f"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ca66c805d202d279faca9feacced57f">_0x03001741</a></div><div class="ttdeci">#define _0x03001741</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a1ced00f2b51163b6af88d6de7673cebc"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1ced00f2b51163b6af88d6de7673cebc">tls_xread_record</a></div><div class="ttdeci">static int tls_xread_record(tls_state_t *tls, const char *expected)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01041">tls.c:1041</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a1d003e8e5e2a2e18a384832bc9eeb425"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d003e8e5e2a2e18a384832bc9eeb425">record_hdr::len16_lo</a></div><div class="ttdeci">uint8_t len16_lo</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00253">tls.c:253</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a1d34e2d988fc19f2480bab352b6376d0"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a1d34e2d988fc19f2480bab352b6376d0">record_hdr::proto_min</a></div><div class="ttdeci">uint8_t proto_min</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00252">tls.c:252</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a222955be70285ace97b0fffa2b082f5d"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a222955be70285ace97b0fffa2b082f5d">RECORD_TYPE_HANDSHAKE</a></div><div class="ttdeci">#define RECORD_TYPE_HANDSHAKE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00077">tls.c:77</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a28b6aee24119df52de6eafae6008208e"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a28b6aee24119df52de6eafae6008208e">enter_der_item</a></div><div class="ttdeci">static uint8_t * enter_der_item(uint8_t *der, uint8_t **endp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01250">tls.c:1250</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a2a404bab8b6e8c6c7d0a4039dd91b99b"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2a404bab8b6e8c6c7d0a4039dd91b99b">dump_raw_out</a></div><div class="ttdeci">#define dump_raw_out(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00050">tls.c:50</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a2acf5a199836fd199ff326e1446dac84"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2acf5a199836fd199ff326e1446dac84">fill_handshake_record_hdr</a></div><div class="ttdeci">static ALWAYS_INLINE void fill_handshake_record_hdr(void *buf, unsigned type, unsigned len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01486">tls.c:1486</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a2b239b202d79a7f1ce309d36d4221d31"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2b239b202d79a7f1ce309d36d4221d31">dbg_der</a></div><div class="ttdeci">#define dbg_der(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00067">tls.c:67</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a2e3afc5d10bf3345d671b82ee8f5fba6"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2e3afc5d10bf3345d671b82ee8f5fba6">get_server_hello</a></div><div class="ttdeci">static void get_server_hello(tls_state_t *tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01695">tls.c:1695</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a2f3a2adc76a0f9a7727eb21b7f3f0b24"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a2f3a2adc76a0f9a7727eb21b7f3f0b24">ALLOW_ECDHE_RSA_WITH_AES_128_GCM_SHA256</a></div><div class="ttdeci">#define ALLOW_ECDHE_RSA_WITH_AES_128_GCM_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00031">tls.c:31</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a3127dcb28fa0efcf6be6157085ce1dd6"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3127dcb28fa0efcf6be6157085ce1dd6">tls_free_outbuf</a></div><div class="ttdeci">static void tls_free_outbuf(tls_state_t *tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00632">tls.c:632</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a32829e624b2b9c8af7f8ae93ac1885cb"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a32829e624b2b9c8af7f8ae93ac1885cb">get_der_len</a></div><div class="ttdeci">static unsigned get_der_len(uint8_t **bodyp, uint8_t *der, uint8_t *end)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01208">tls.c:1208</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a333b9382c44248475f73712fea669957"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a333b9382c44248475f73712fea669957">dump_raw_in</a></div><div class="ttdeci">#define dump_raw_in(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00055">tls.c:55</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a3470fab88480f3122875e6bf12972147"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3470fab88480f3122875e6bf12972147">hmac_precomputed_t</a></div><div class="ttdeci">struct hmac_precomputed hmac_precomputed_t</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a360c5e94b1f215558f06d59c710de87d"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a360c5e94b1f215558f06d59c710de87d">tls_handshake_data::ecc_pub_key32</a></div><div class="ttdeci">uint8_t ecc_pub_key32[2 *32]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00270">tls.c:270</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a36ef8ca992ba3de99b5c988d86211275"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a36ef8ca992ba3de99b5c988d86211275">find_key_in_der_cert</a></div><div class="ttdeci">static void find_key_in_der_cert(tls_state_t *tls, uint8_t *der, int len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01279">tls.c:1279</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a3737e635cffa96318a9f77a759b21cef"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3737e635cffa96318a9f77a759b21cef">binary_to_pstm</a></div><div class="ttdeci">static void binary_to_pstm(pstm_int *pstm_n, uint8_t *bin_ptr, unsigned len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01198">tls.c:1198</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a38c44fdb132d2ba680999ec2eb004354"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a38c44fdb132d2ba680999ec2eb004354">TLS_MAC_SIZE</a></div><div class="ttdeci">#define TLS_MAC_SIZE(tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00391">tls.c:391</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a398a3c9c7f69709d0f6473e82d8a3a67"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a398a3c9c7f69709d0f6473e82d8a3a67">xwrite_encrypted_and_hmac_signed</a></div><div class="ttdeci">static void xwrite_encrypted_and_hmac_signed(tls_state_t *tls, unsigned size, unsigned type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00658">tls.c:658</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a3ecbfa237736e9525fb3bd26bba53f3f"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a3ecbfa237736e9525fb3bd26bba53f3f">tls_get_zeroed_outbuf</a></div><div class="ttdeci">static void * tls_get_zeroed_outbuf(tls_state_t *tls, int len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00651">tls.c:651</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a4035149b7cdecc1ceac5879991677acd"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a4035149b7cdecc1ceac5879991677acd">hmac</a></div><div class="ttdeci">#define hmac(tls, out, key, key_size,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00496">tls.c:496</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a435ac9529fae91027f18582ada731a48"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a435ac9529fae91027f18582ada731a48">tls_run_copy_loop</a></div><div class="ttdeci">void FAST_FUNC tls_run_copy_loop(tls_state_t *tls, unsigned flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l02369">tls.c:2369</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a4d11f3d0264027abeb2a55e2a9a3e40b"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a4d11f3d0264027abeb2a55e2a9a3e40b">HANDSHAKE_SERVER_HELLO</a></div><div class="ttdeci">#define HANDSHAKE_SERVER_HELLO</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00082">tls.c:82</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a5606771cd63cad022b13c591fecf4fde"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a5606771cd63cad022b13c591fecf4fde">tls_error_die</a></div><div class="ttdeci">#define tls_error_die(tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00619">tls.c:619</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a58e6839560679f7f99491ed40f73231e"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a58e6839560679f7f99491ed40f73231e">xorbuf_aligned_AES_BLOCK_SIZE</a></div><div class="ttdeci">void FAST_FUNC xorbuf_aligned_AES_BLOCK_SIZE(void *dst, const void *src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00352">tls.c:352</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a58e7212b6d8f7451aeaa2c52883afa56"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a58e7212b6d8f7451aeaa2c52883afa56">alert_text</a></div><div class="ttdeci">static const char * alert_text(int code)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00949">tls.c:949</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a59d1a3325c8c18009268226036a074a2"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a59d1a3325c8c18009268226036a074a2">tls_get_random</a></div><div class="ttdeci">void FAST_FUNC tls_get_random(void *buf, unsigned len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00332">tls.c:332</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a61b51ee42d556e44523b538afffe1e98"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a61b51ee42d556e44523b538afffe1e98">record_hdr::len16_hi</a></div><div class="ttdeci">uint8_t len16_hi</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00253">tls.c:253</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a6535ec67b879b714910dd2318b2aee41"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6535ec67b879b714910dd2318b2aee41">RECORD_TYPE_APPLICATION_DATA</a></div><div class="ttdeci">#define RECORD_TYPE_APPLICATION_DATA</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00078">tls.c:78</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a68c6144816dda1e31ee6b895663959ca"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a68c6144816dda1e31ee6b895663959ca">NUM_CIPHERS</a></div><div class="ttdeci">#define NUM_CIPHERS</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a68e5b663cedb46bb2fe35d546fe8dd29"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a68e5b663cedb46bb2fe35d546fe8dd29">ALLOW_RSA_WITH_AES_128_CBC_SHA256</a></div><div class="ttdeci">#define ALLOW_RSA_WITH_AES_128_CBC_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00032">tls.c:32</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a6a30ed926de7c078a4d0e034eb714a7f"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6a30ed926de7c078a4d0e034eb714a7f">ALLOW_CURVE_P256</a></div><div class="ttdeci">#define ALLOW_CURVE_P256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00035">tls.c:35</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a6fdabf8c5e75c237e9c930b1ec6dbd1a"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a6fdabf8c5e75c237e9c930b1ec6dbd1a">ALIGN1</a></div><div class="ttdeci">static const uint8_t rec_CHANGE_CIPHER_SPEC[] ALIGN1</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l02146">tls.c:2146</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a7543ee146e14655d2038f2262892b775"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7543ee146e14655d2038f2262892b775">send_empty_client_cert</a></div><div class="ttdeci">static void send_empty_client_cert(tls_state_t *tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01951">tls.c:1951</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a7545daeef48814f53e1ed124ed0993fe"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7545daeef48814f53e1ed124ed0993fe">tls_handshake</a></div><div class="ttdeci">void FAST_FUNC tls_handshake(tls_state_t *tls, const char *sni)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l02224">tls.c:2224</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a7b7c641b39c389c7ad89c6ef9b1b4d8e"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7b7c641b39c389c7ad89c6ef9b1b4d8e">record_hdr::proto_maj</a></div><div class="ttdeci">uint8_t proto_maj</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00252">tls.c:252</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a7f94151579cdfcbc800f105f34eb4002"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a7f94151579cdfcbc800f105f34eb4002">ALLOW_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</a></div><div class="ttdeci">#define ALLOW_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00028">tls.c:28</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a80578323a028f7c97df09fcf86095374"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a80578323a028f7c97df09fcf86095374">HANDSHAKE_CERTIFICATE</a></div><div class="ttdeci">#define HANDSHAKE_CERTIFICATE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00085">tls.c:85</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a825fce3f42c85c60e76e7e3d5a779cfb"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a825fce3f42c85c60e76e7e3d5a779cfb">TLS_DEBUG_FIXED_SECRETS</a></div><div class="ttdeci">#define TLS_DEBUG_FIXED_SECRETS</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00046">tls.c:46</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a859e8181c002d45232991f43512b7246"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a859e8181c002d45232991f43512b7246">hash_handshake</a></div><div class="ttdeci">#define hash_handshake(tls, fmt, buffer, len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00367">tls.c:367</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a85db9cd6dd46798be3af1b9bca54e029"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a85db9cd6dd46798be3af1b9bca54e029">tls_handshake_data::master_secret</a></div><div class="ttdeci">uint8_t master_secret[48]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00261">tls.c:261</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a881321125cb88fad13a72edfcdee9302"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a881321125cb88fad13a72edfcdee9302">dump_hex</a></div><div class="ttdeci">#define dump_hex(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00328">tls.c:328</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a88d1fbaaaab3a6bf00fc377c8bade1e3"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a88d1fbaaaab3a6bf00fc377c8bade1e3">send_client_hello_and_alloc_hsd</a></div><div class="ttdeci">static void send_client_hello_and_alloc_hsd(tls_state_t *tls, const char *sni)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01500">tls.c:1500</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a8b23bd21169a87e8428ccb874e441264"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8b23bd21169a87e8428ccb874e441264">TLS_MIN</a></div><div class="ttdeci">#define TLS_MIN</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00073">tls.c:73</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a8c778ab2ff373b34a0c2fe098b251d61"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8c778ab2ff373b34a0c2fe098b251d61">bad_record_die</a></div><div class="ttdeci">static void bad_record_die(tls_state_t *tls, const char *expected, int len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00598">tls.c:598</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a8dabadc98219d027206899deb1561143"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8dabadc98219d027206899deb1561143">HANDSHAKE_CLIENT_HELLO</a></div><div class="ttdeci">#define HANDSHAKE_CLIENT_HELLO</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00081">tls.c:81</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a8e5b1766844eb48b2a9fdacb9ce26f14"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a8e5b1766844eb48b2a9fdacb9ce26f14">TLS_MAX_OUTBUF</a></div><div class="ttdeci">#define TLS_MAX_OUTBUF</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00188">tls.c:188</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a92c445bf59ecea2f4453d2d90d4abd75"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a92c445bf59ecea2f4453d2d90d4abd75">xorbuf</a></div><div class="ttdeci">void FAST_FUNC xorbuf(void *dst, const void *src, unsigned count)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00347">tls.c:347</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a94091d03ce74d94f9a7139f94e9cd983"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a94091d03ce74d94f9a7139f94e9cd983">send_client_finished</a></div><div class="ttdeci">static void send_client_finished(tls_state_t *tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l02194">tls.c:2194</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a955f504eccf76b4eb2489c0adab03121"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a955f504eccf76b4eb2489c0adab03121">A</a></div><div class="ttdeci">#define A</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a99d80378865343f69b5f50b1414fce94"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a99d80378865343f69b5f50b1414fce94">xwrite_encrypted</a></div><div class="ttdeci">static void xwrite_encrypted(tls_state_t *tls, unsigned size, unsigned type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00896">tls.c:896</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a9b7722837b5b510ec2aa4e126afc403a"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9b7722837b5b510ec2aa4e126afc403a">md5sha_begin_func</a></div><div class="ttdeci">void md5sha_begin_func(md5sha_ctx_t *ctx) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00411">tls.c:411</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_a9f0a3442d9f5f618d514c99bbf36e8b7"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#a9f0a3442d9f5f618d514c99bbf36e8b7">send_client_key_exchange</a></div><div class="ttdeci">static void send_client_key_exchange(tls_state_t *tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01973">tls.c:1973</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aa0314c1e43e00028644ceb32e013a23f"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa0314c1e43e00028644ceb32e013a23f">_0x03001d20</a></div><div class="ttdeci">#define _0x03001d20</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aa2dc08633a73a135c328a2ca9f19ae93"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa2dc08633a73a135c328a2ca9f19ae93">prf_hmac_sha256</a></div><div class="ttdeci">static void prf_hmac_sha256(uint8_t *outbuf, unsigned outbuf_size, uint8_t *secret, unsigned secret_size, const char *label, uint8_t *seed, unsigned seed_size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00556">tls.c:556</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aa5342199f06c7961763f5a440698f1ab"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa5342199f06c7961763f5a440698f1ab">send_change_cipher_spec</a></div><div class="ttdeci">static void send_change_cipher_spec(tls_state_t *tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l02151">tls.c:2151</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aa6756696bd68e8b60d37f7c5a68aec3d"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6756696bd68e8b60d37f7c5a68aec3d">begin</a></div><div class="ttdeci">#define begin</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00415">tls.c:415</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aa6f27a434f9d903a806798e640b84a24"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa6f27a434f9d903a806798e640b84a24">xwrite_encrypted_aesgcm</a></div><div class="ttdeci">static void xwrite_encrypted_aesgcm(tls_state_t *tls, unsigned size, unsigned type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00825">tls.c:825</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aa98352b3587a985366c092e548025daa"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aa98352b3587a985366c092e548025daa">xwrite_and_update_handshake_hash</a></div><div class="ttdeci">static void xwrite_and_update_handshake_hash(tls_state_t *tls, unsigned size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00920">tls.c:920</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aadf47595f4fdb31176441bb4415eecac"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aadf47595f4fdb31176441bb4415eecac">dbg</a></div><div class="ttdeci">#define dbg(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00061">tls.c:61</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aae81cd08d01440ba7f9489e3141aa349"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aae81cd08d01440ba7f9489e3141aa349">xwrite_handshake_record</a></div><div class="ttdeci">static void xwrite_handshake_record(tls_state_t *tls, unsigned size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00905">tls.c:905</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aaf98a8ebe0ffc4e0179476f6535a9c10"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aaf98a8ebe0ffc4e0179476f6535a9c10">tls_has_buffered_record</a></div><div class="ttdeci">static int tls_has_buffered_record(tls_state_t *tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00934">tls.c:934</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ab20655e202f5053dec1ab4671afb04b2"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab20655e202f5053dec1ab4671afb04b2">HANDSHAKE_SERVER_HELLO_DONE</a></div><div class="ttdeci">#define HANDSHAKE_SERVER_HELLO_DONE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00088">tls.c:88</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ab517f4a374d088f9545c1af5136a20e1"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ab517f4a374d088f9545c1af5136a20e1">xorbuf3</a></div><div class="ttdeci">static void xorbuf3(void *dst, const void *src1, const void *src2, unsigned count)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00338">tls.c:338</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ac03bf5d8be4418a97222bad938852021"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac03bf5d8be4418a97222bad938852021">tls_xwrite</a></div><div class="ttdeci">static void tls_xwrite(tls_state_t *tls, int len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l02354">tls.c:2354</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ac3d09a13305957afd7599d4f92dbf0bd"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac3d09a13305957afd7599d4f92dbf0bd">tls_xread_handshake_block</a></div><div class="ttdeci">static int tls_xread_handshake_block(tls_state_t *tls, int min_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01471">tls.c:1471</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ac9e8bf191ea759b5700441d0a9d807dd"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac9e8bf191ea759b5700441d0a9d807dd">HANDSHAKE_CERTIFICATE_REQUEST</a></div><div class="ttdeci">#define HANDSHAKE_CERTIFICATE_REQUEST</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00087">tls.c:87</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ac9f5d59963e64f2edd81e2642566eaaf"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ac9f5d59963e64f2edd81e2642566eaaf">HANDSHAKE_FINISHED</a></div><div class="ttdeci">#define HANDSHAKE_FINISHED</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00091">tls.c:91</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_acf589aa5fda0a6286daf7786663c9988"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#acf589aa5fda0a6286daf7786663c9988">skip_der_item</a></div><div class="ttdeci">static uint8_t * skip_der_item(uint8_t *der, uint8_t *end)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01260">tls.c:1260</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad08080727341a265d82ff2761fa7bddc"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad08080727341a265d82ff2761fa7bddc">tls_get_outbuf</a></div><div class="ttdeci">static void * tls_get_outbuf(tls_state_t *tls, int len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00639">tls.c:639</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a004be8a72e42bf7304e3d73404cdd5b2">ENCRYPTION_AESGCM</a></div><div class="ttdeci">@ ENCRYPTION_AESGCM</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00246">tls.c:246</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0a341620e2929e799f062087e23e49d5e1"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a341620e2929e799f062087e23e49d5e1">ENCRYPT_ON_WRITE</a></div><div class="ttdeci">@ ENCRYPT_ON_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00247">tls.c:247</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a3a028714ec535641a270c840bf552092">RECHDR_LEN</a></div><div class="ttdeci">@ RECHDR_LEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00198">tls.c:198</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a53c7e9ad76be667bd0abc4439bb65fca">RSA_PREMASTER_SIZE</a></div><div class="ttdeci">@ RSA_PREMASTER_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00196">tls.c:196</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a69be1971f8d1c8baf4f29b4bf3dd40ee">OUTBUF_PFX</a></div><div class="ttdeci">@ OUTBUF_PFX</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00201">tls.c:201</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a806bda7e4f4c08be071a0f20bc300538">SHA_INSIZE</a></div><div class="ttdeci">@ SHA_INSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00191">tls.c:191</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0a971b66d3a2f12dd1f58a1cd048814193"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0a971b66d3a2f12dd1f58a1cd048814193">GOT_EC_CURVE_X25519</a></div><div class="ttdeci">@ GOT_EC_CURVE_X25519</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00245">tls.c:245</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0aa2ef4fc31647cb6840883c00ec5a49b7"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0aa2ef4fc31647cb6840883c00ec5a49b7">AES256_KEYSIZE</a></div><div class="ttdeci">@ AES256_KEYSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00194">tls.c:194</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0aae97981bebec903c5e016514d81ee11e"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0aae97981bebec903c5e016514d81ee11e">GOT_CERT_ECDSA_KEY_ALG</a></div><div class="ttdeci">@ GOT_CERT_ECDSA_KEY_ALG</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00243">tls.c:243</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0ab38dc88e6d70f9206569c50c1d895b85"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab38dc88e6d70f9206569c50c1d895b85">NEED_EC_KEY</a></div><div class="ttdeci">@ NEED_EC_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00241">tls.c:241</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ab5339db5b80caaefbcc1d5500182026d">MAX_INBUF</a></div><div class="ttdeci">@ MAX_INBUF</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00238">tls.c:238</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0ac39e3e35406c535eefd6407179d18a8d"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ac39e3e35406c535eefd6407179d18a8d">GOT_CERT_RSA_KEY_ALG</a></div><div class="ttdeci">@ GOT_CERT_RSA_KEY_ALG</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00242">tls.c:242</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0ad0b8160a079f0c3fdcfc1f46c68e4b1f"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad0b8160a079f0c3fdcfc1f46c68e4b1f">GOT_EC_KEY</a></div><div class="ttdeci">@ GOT_EC_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00244">tls.c:244</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0ad61a29ae1d927dd634c2efbff44b8a18"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad61a29ae1d927dd634c2efbff44b8a18">AES128_KEYSIZE</a></div><div class="ttdeci">@ AES128_KEYSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00193">tls.c:193</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad1df9dc2600f2dda7e99d31c00fd73e0ad6a2447a142236ed15d5c103c8d22075"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad1df9dc2600f2dda7e99d31c00fd73e0ad6a2447a142236ed15d5c103c8d22075">OUTBUF_SFX</a></div><div class="ttdeci">@ OUTBUF_SFX</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00202">tls.c:202</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad350bae49f72ba58d73027f1316e38b8"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad350bae49f72ba58d73027f1316e38b8">SEED</a></div><div class="ttdeci">#define SEED</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ad688a0955360a4c03d1134b154e93913"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ad688a0955360a4c03d1134b154e93913">hmac_precomputed::hashed_key_xor_opad</a></div><div class="ttdeci">md5sha_ctx_t hashed_key_xor_opad</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00408">tls.c:408</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ae00dcdfc46a1dc668a87478b16476c73"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae00dcdfc46a1dc668a87478b16476c73">hmac_sha_precomputed_v</a></div><div class="ttdeci">static unsigned hmac_sha_precomputed_v(hmac_precomputed_t *pre, uint8_t *out, va_list va)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00459">tls.c:459</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ae0a1798db233a0f1cf8fbdb25017a879"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae0a1798db233a0f1cf8fbdb25017a879">tls_handshake_data::server_rsa_pub_key</a></div><div class="ttdeci">psRsaKey_t server_rsa_pub_key</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00265">tls.c:265</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ae388fc0dbac04b3d5717fd447eaec61d"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae388fc0dbac04b3d5717fd447eaec61d">TLS_RSA_WITH_NULL_SHA256</a></div><div class="ttdeci">#define TLS_RSA_WITH_NULL_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00112">tls.c:112</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ae6eb035c662d7e6d4a4e0dcf863fec8d"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae6eb035c662d7e6d4a4e0dcf863fec8d">ALLOW_RSA_WITH_AES_256_CBC_SHA256</a></div><div class="ttdeci">#define ALLOW_RSA_WITH_AES_256_CBC_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00033">tls.c:33</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_ae77ce99bbd9b7699102e28cc744d3825"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#ae77ce99bbd9b7699102e28cc744d3825">get24be</a></div><div class="ttdeci">static unsigned get24be(const uint8_t *p)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00278">tls.c:278</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aeb93440f0b18431d1be9f5b0d98904ee"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb93440f0b18431d1be9f5b0d98904ee">TLS_MAX_CRYPTBLOCK_SIZE</a></div><div class="ttdeci">#define TLS_MAX_CRYPTBLOCK_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00187">tls.c:187</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aeb998f09619dd4fbe2a5e43364f9c813"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aeb998f09619dd4fbe2a5e43364f9c813">TLS_MAJ</a></div><div class="ttdeci">#define TLS_MAJ</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00072">tls.c:72</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_aed3e2cf47e9fb0e450f57fa5ecb66ad4"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#aed3e2cf47e9fb0e450f57fa5ecb66ad4">ALLOW_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</a></div><div class="ttdeci">#define ALLOW_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00030">tls.c:30</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_af2f7e6ef152a4947a46b0a367ae69909"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af2f7e6ef152a4947a46b0a367ae69909">dump_tls_record</a></div><div class="ttdeci">#define dump_tls_record(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00329">tls.c:329</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_af2feecdca663721aca648de25a775a92"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af2feecdca663721aca648de25a775a92">get_server_cert</a></div><div class="ttdeci">static void get_server_cert(tls_state_t *tls)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01838">tls.c:1838</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_af31e97ebfa62c1b74e19b4c6c4b9fb14"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af31e97ebfa62c1b74e19b4c6c4b9fb14">process_server_key</a></div><div class="ttdeci">static void process_server_key(tls_state_t *tls, int len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01871">tls.c:1871</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_af60cb3c889da6403866b3087adf587c3"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af60cb3c889da6403866b3087adf587c3">ALLOW_RSA_NULL_SHA256</a></div><div class="ttdeci">#define ALLOW_RSA_NULL_SHA256</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00041">tls.c:41</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_af61569d30fcfe8fc128c0f021bc9ccc6"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af61569d30fcfe8fc128c0f021bc9ccc6">record_hdr::type</a></div><div class="ttdeci">uint8_t type</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00251">tls.c:251</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_af6fec2c761a9132b14de85d3fe0ecbb1"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af6fec2c761a9132b14de85d3fe0ecbb1">HANDSHAKE_CLIENT_KEY_EXCHANGE</a></div><div class="ttdeci">#define HANDSHAKE_CLIENT_KEY_EXCHANGE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00090">tls.c:90</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_af73b278cbf5e785605d467071ea344d8"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#af73b278cbf5e785605d467071ea344d8">der_binary_to_pstm</a></div><div class="ttdeci">static void der_binary_to_pstm(pstm_int *pstm_n, uint8_t *der, uint8_t *end)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l01270">tls.c:1270</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_afa7392a2c6f6c8a1f596942b27ca9725"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afa7392a2c6f6c8a1f596942b27ca9725">SIGALGS</a></div><div class="ttdeci">#define SIGALGS</div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_afc398ad29c76454f6a4ae795a471881b"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#afc398ad29c76454f6a4ae795a471881b">tls_aesgcm_decrypt</a></div><div class="ttdeci">static void tls_aesgcm_decrypt(tls_state_t *tls, uint8_t *buf, int size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00996">tls.c:996</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_affdc252da7a09312e24f379b8d1f1330"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#affdc252da7a09312e24f379b8d1f1330">RECORD_TYPE_CHANGE_CIPHER_SPEC</a></div><div class="ttdeci">#define RECORD_TYPE_CHANGE_CIPHER_SPEC</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00075">tls.c:75</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_d5/de3/structtls__handshake__data"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d5/de3/structtls__handshake__data">tls_handshake_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00256">tls.c:256</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_d8/d80/structrecord__hdr"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#d8/d80/structrecord__hdr">record_hdr</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00250">tls.c:250</a></div></div>
<div class="ttc" id="aapps_2base_2busybox_2networking_2tls_8c_html_db/dcc/structhmac__precomputed"><div class="ttname"><a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html#db/dcc/structhmac__precomputed">hmac_precomputed</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c_source.html#l00406">tls.c:406</a></div></div>
<div class="ttc" id="aarping_8c_html_a21e72f66ad6f15c4dcb2c8afbb57d7dd"><div class="ttname"><a href="../../df/d84/arping_8c.html#a21e72f66ad6f15c4dcb2c8afbb57d7dd">dst</a></div><div class="ttdeci">#define dst</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d84/arping_8c_source.html#l00089">arping.c:89</a></div></div>
<div class="ttc" id="aarping_8c_html_a858376c0918f93e656c8c0d76c63dbe8"><div class="ttname"><a href="../../df/d84/arping_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a></div><div class="ttdeci">#define src</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d84/arping_8c_source.html#l00088">arping.c:88</a></div></div>
<div class="ttc" id="aarpping_8c_html_ac9562ee4ecb3b8aeebeb04656e7e57a9"><div class="ttname"><a href="../../df/d19/arpping_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a></div><div class="ttdeci">#define s</div></div>
<div class="ttc" id="aawk_8c_html_aa887dc9b7db48419c8d0dcaf198f8d2c"><div class="ttname"><a href="../../de/dcc/awk_8c.html#aa887dc9b7db48419c8d0dcaf198f8d2c">seed</a></div><div class="ttdeci">#define seed</div></div>
<div class="ttc" id="achat_8c_html_aa28364b44ea5d1bde8c124cb01039175"><div class="ttname"><a href="../../de/dc7/chat_8c.html#aa28364b44ea5d1bde8c124cb01039175">inbuf</a></div><div class="ttdeci">#define inbuf</div></div>
<div class="ttc" id="acompress_8c_html_a814f6dab3b0678113d97a3684282934a"><div class="ttname"><a href="../../d0/d6b/compress_8c.html#a814f6dab3b0678113d97a3684282934a">code</a></div><div class="ttdeci">#define code</div></div>
<div class="ttc" id="aconspy_8c_html_aefe32ef375f5da1974e7a36782d99c50"><div class="ttname"><a href="../../d5/d8e/conspy_8c.html#aefe32ef375f5da1974e7a36782d99c50">keybuf</a></div><div class="ttdeci">#define keybuf</div></div>
<div class="ttc" id="adcigettext_8c_html_a58257445f1a929304e537613b62ebb35"><div class="ttname"><a href="../../d0/d32/dcigettext_8c.html#a58257445f1a929304e537613b62ebb35">n</a></div><div class="ttdeci">unsigned long int n</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d32/dcigettext_8c_source.html#l00441">dcigettext.c:441</a></div></div>
<div class="ttc" id="add_8c_html_ac74ae34e9c58234aacabb6867b245c58"><div class="ttname"><a href="../../d2/dd6/dd_8c.html#ac74ae34e9c58234aacabb6867b245c58">count</a></div><div class="ttdeci">#define count</div></div>
<div class="ttc" id="adiff_8c_html_a194c3fb843a8ae50f9ed19d4ee4f42de"><div class="ttname"><a href="../../d6/dff/diff_8c.html#a194c3fb843a8ae50f9ed19d4ee4f42de">label</a></div><div class="ttdeci">#define label</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dff/diff_8c_source.html#l00176">diff.c:176</a></div></div>
<div class="ttc" id="adumpkmap_8c_html_abb0829cce9dd20a40ae0d86890ae85c6"><div class="ttname"><a href="../../db/d66/dumpkmap_8c.html#abb0829cce9dd20a40ae0d86890ae85c6">flags</a></div><div class="ttdeci">#define flags</div></div>
<div class="ttc" id="adynlink_8c_html_a2c6efa7679f8cd9f61af96e105017560"><div class="ttname"><a href="../../d5/db0/dynlink_8c.html#a2c6efa7679f8cd9f61af96e105017560">free</a></div><div class="ttdeci">#define free</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/db0/dynlink_8c_source.html#l00036">dynlink.c:36</a></div></div>
<div class="ttc" id="aexcallback_8c_html_afcf80a6d91178952d107ad00b165752b"><div class="ttname"><a href="../../d6/d4f/excallback_8c.html#afcf80a6d91178952d107ad00b165752b">STDIN_FILENO</a></div><div class="ttdeci">#define STDIN_FILENO</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4f/excallback_8c_source.html#l00062">excallback.c:62</a></div></div>
<div class="ttc" id="afcts_8c_html_a14938524dcbeb59d7117ba5e151ad1b1"><div class="ttname"><a href="../../d4/d7b/fcts_8c.html#a14938524dcbeb59d7117ba5e151ad1b1">memcpy</a></div><div class="ttdeci">void * memcpy(void *dest, const void *src, size_t n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7b/fcts_8c_source.html#l00090">fcts.c:90</a></div></div>
<div class="ttc" id="afixdep_8c_html_a23b26cdb3a71f525caf03b57f68d47fa"><div class="ttname"><a href="../../de/db1/fixdep_8c.html#a23b26cdb3a71f525caf03b57f68d47fa">target</a></div><div class="ttdeci">char * target</div><div class="ttdef"><b>Definition:</b> <a href="../../de/db1/fixdep_8c_source.html#l00125">fixdep.c:125</a></div></div>
<div class="ttc" id="afsck__minix_8c_html_a0f905d3903a7c8ea53ab56ac0f8df0a7"><div class="ttname"><a href="../../dc/d72/fsck__minix_8c.html#a0f905d3903a7c8ea53ab56ac0f8df0a7">total</a></div><div class="ttdeci">#define total</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d72/fsck__minix_8c_source.html#l00204">fsck_minix.c:204</a></div></div>
<div class="ttc" id="ageneral_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../d9/d14/general_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d14/general_8h_source.html#l00053">general.h:53</a></div></div>
<div class="ttc" id="agetpwent_8c_html_a854352f53b148adc24983a58a1866d66"><div class="ttname"><a href="../../d7/d06/getpwent_8c.html#a854352f53b148adc24983a58a1866d66">size</a></div><div class="ttdeci">static size_t size</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d06/getpwent_8c_source.html#l00006">getpwent.c:6</a></div></div>
<div class="ttc" id="agettextP_8h_html_a68428151ad44e31b19041cdeb8972a91"><div class="ttname"><a href="../../dd/d71/gettextP_8h.html#a68428151ad44e31b19041cdeb8972a91">i</a></div><div class="ttdeci">static nls_uint32 nls_uint32 i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d71/gettextP_8h_source.html#l00074">gettextP.h:74</a></div></div>
<div class="ttc" id="aglob__loop_8c_html_ac483f6ce851c9ecd9fb835ff7551737c"><div class="ttname"><a href="../../d8/d64/glob__loop_8c.html#ac483f6ce851c9ecd9fb835ff7551737c">p</a></div><div class="ttdeci">p</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d64/glob__loop_8c_source.html#l00031">glob_loop.c:31</a></div></div>
<div class="ttc" id="ainclude_2ansi__stdlib_8h_html_a358d2e2397ca11ccd17553e3c40e7901"><div class="ttname"><a href="../../d9/df8/include_2ansi__stdlib_8h.html#a358d2e2397ca11ccd17553e3c40e7901">exit</a></div><div class="ttdeci">void exit()</div></div>
<div class="ttc" id="ainclude_2arpa_2inet_8h_html_afa0e455458258ff4741c5c3b2c737756"><div class="ttname"><a href="../../d8/d16/include_2arpa_2inet_8h.html#afa0e455458258ff4741c5c3b2c737756">htonl</a></div><div class="ttdeci">uint32_t htonl(uint32_t)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df7/htonl_8c_source.html#l00004">htonl.c:4</a></div></div>
<div class="ttc" id="ainclude_2poll_8h_html_a52ac479a805051f59643588b096024ff"><div class="ttname"><a href="../../d1/da4/include_2poll_8h.html#a52ac479a805051f59643588b096024ff">POLLIN</a></div><div class="ttdeci">#define POLLIN</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/include_2poll_8h_source.html#l00012">poll.h:12</a></div></div>
<div class="ttc" id="ainclude_2poll_8h_html_a57e1c316fb063e468d680b6246147861"><div class="ttname"><a href="../../d1/da4/include_2poll_8h.html#a57e1c316fb063e468d680b6246147861">pollfd::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/include_2poll_8h_source.html#l00032">poll.h:32</a></div></div>
<div class="ttc" id="ainclude_2poll_8h_html_aafb457d11cac415faf0e1e2b825118c2"><div class="ttname"><a href="../../d1/da4/include_2poll_8h.html#aafb457d11cac415faf0e1e2b825118c2">pollfd::revents</a></div><div class="ttdeci">short revents</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/include_2poll_8h_source.html#l00034">poll.h:34</a></div></div>
<div class="ttc" id="ainclude_2poll_8h_html_ac9b2f2c5b1f9a7487eb57e67cd4960ef"><div class="ttname"><a href="../../d1/da4/include_2poll_8h.html#ac9b2f2c5b1f9a7487eb57e67cd4960ef">pollfd::events</a></div><div class="ttdeci">short events</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/include_2poll_8h_source.html#l00033">poll.h:33</a></div></div>
<div class="ttc" id="ainclude_2poll_8h_html_de/dd7/structpollfd"><div class="ttname"><a href="../../d1/da4/include_2poll_8h.html#de/dd7/structpollfd">pollfd</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/include_2poll_8h_source.html#l00031">poll.h:31</a></div></div>
<div class="ttc" id="ajobs_8h_html_add1dc6545057b7f1c7f91352536fb060"><div class="ttname"><a href="../../d3/d3a/jobs_8h.html#add1dc6545057b7f1c7f91352536fb060">getpid</a></div><div class="ttdeci">pid_t getpid()</div></div>
<div class="ttc" id="algamma__r_8c_html_a1ff9ee3251659529629e761b307fada6"><div class="ttname"><a href="../../d3/d84/lgamma__r_8c.html#a1ff9ee3251659529629e761b307fada6">s1</a></div><div class="ttdeci">static const double s1</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d84/lgamma__r_8c_source.html#l00128">lgamma_r.c:128</a></div></div>
<div class="ttc" id="algamma__r_8c_html_a6f99aff13f96e26313f4fdfb4fbe5b1d"><div class="ttname"><a href="../../d3/d84/lgamma__r_8c.html#a6f99aff13f96e26313f4fdfb4fbe5b1d">s2</a></div><div class="ttdeci">static const double s2</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d84/lgamma__r_8c_source.html#l00129">lgamma_r.c:129</a></div></div>
<div class="ttc" id="alibbb_8h_html_a0dbd8f58654dfb2a07a1944c18a4afe5"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a0dbd8f58654dfb2a07a1944c18a4afe5">fputc</a></div><div class="ttdeci">#define fputc(c, stream)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00231">libbb.h:231</a></div></div>
<div class="ttc" id="alibbb_8h_html_a0fc08f11f6c83dbc94a75ca49d29fae8"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a0fc08f11f6c83dbc94a75ca49d29fae8">BUILD_BUG_ON</a></div><div class="ttdeci">#define BUILD_BUG_ON(condition)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l02418">libbb.h:2418</a></div></div>
<div class="ttc" id="alibbb_8h_html_a17790c4da72b3cd02302e9e352b63ab2"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a17790c4da72b3cd02302e9e352b63ab2">safe_poll</a></div><div class="ttdeci">int safe_poll(struct pollfd *ufds, nfds_t nfds, int timeout_ms) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d1d/safe__poll_8c_source.html#l00014">safe_poll.c:14</a></div></div>
<div class="ttc" id="alibbb_8h_html_a1812ab31015cef0a41c6d4f3ae07f13da0bc3102f049b590dff06d0ed0360796e"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da0bc3102f049b590dff06d0ed0360796e">SHA256_OUTSIZE</a></div><div class="ttdeci">@ SHA256_OUTSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l02187">libbb.h:2187</a></div></div>
<div class="ttc" id="alibbb_8h_html_a1812ab31015cef0a41c6d4f3ae07f13daa403a6ccafdf7f0e2d6615f70dfd371d"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a1812ab31015cef0a41c6d4f3ae07f13daa403a6ccafdf7f0e2d6615f70dfd371d">SHA1_OUTSIZE</a></div><div class="ttdeci">@ SHA1_OUTSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l02186">libbb.h:2186</a></div></div>
<div class="ttc" id="alibbb_8h_html_a1992b68ae7d01f7da91e31e351ca3b33"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a1992b68ae7d01f7da91e31e351ca3b33">bb_error_msg_and_die</a></div><div class="ttdeci">void bb_error_msg_and_die(const char *s,...) __attribute__((noreturn</div></div>
<div class="ttc" id="alibbb_8h_html_a1d74dab2b4a31237fec264b4ebb3ede6"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a1d74dab2b4a31237fec264b4ebb3ede6">tls_state::cipher_id</a></div><div class="ttdeci">uint16_t cipher_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00851">libbb.h:851</a></div></div>
<div class="ttc" id="alibbb_8h_html_a24e6feeade1f420ae684358c71ede5cc"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a24e6feeade1f420ae684358c71ede5cc">tls_state::ifd</a></div><div class="ttdeci">int ifd</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00848">libbb.h:848</a></div></div>
<div class="ttc" id="alibbb_8h_html_a2cdb203347dbcef4eca0eb64e34eaafb"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a2cdb203347dbcef4eca0eb64e34eaafb">tls_state::client_write_MAC_key</a></div><div class="ttdeci">uint8_t client_write_MAC_key[TLS_MAX_MAC_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00881">libbb.h:881</a></div></div>
<div class="ttc" id="alibbb_8h_html_a2e70fdebc0ae22e4baaf9306b02f764f"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a2e70fdebc0ae22e4baaf9306b02f764f">tls_state::MAC_size</a></div><div class="ttdeci">unsigned MAC_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00852">libbb.h:852</a></div></div>
<div class="ttc" id="alibbb_8h_html_a333b9a46277181b82f5053bcf6129d86"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a333b9a46277181b82f5053bcf6129d86">sha256_begin</a></div><div class="ttdeci">void sha256_begin(sha256_ctx_t *ctx) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d05/hash__md5__sha_8c_source.html#l01224">hash_md5_sha.c:1224</a></div></div>
<div class="ttc" id="alibbb_8h_html_a406e6e7d1c51da582c1e82632b1f2bce"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a406e6e7d1c51da582c1e82632b1f2bce">xwrite</a></div><div class="ttdeci">void xwrite(int fd, const void *buf, size_t count) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd6/xfuncs__printf_8c_source.html#l00247">xfuncs_printf.c:247</a></div></div>
<div class="ttc" id="alibbb_8h_html_a40c558ab1e0d19a1daabe3f93ea7f386"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a40c558ab1e0d19a1daabe3f93ea7f386">tls_state::server_write_key</a></div><div class="ttdeci">uint8_t * server_write_key</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00878">libbb.h:878</a></div></div>
<div class="ttc" id="alibbb_8h_html_a42bf5406f0aa223cb210c2669a9ec40b"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a42bf5406f0aa223cb210c2669a9ec40b">tls_state::outbuf_size</a></div><div class="ttdeci">int outbuf_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00857">libbb.h:857</a></div></div>
<div class="ttc" id="alibbb_8h_html_a5a4d3816142588e0e452454e4760bcc0"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a5a4d3816142588e0e452454e4760bcc0">tls_state::ofs_to_buffered</a></div><div class="ttdeci">int ofs_to_buffered</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00860">libbb.h:860</a></div></div>
<div class="ttc" id="alibbb_8h_html_a5a8110cf4e98a5771f7ab5fccc70f9bf"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a5a8110cf4e98a5771f7ab5fccc70f9bf">tls_state::inbuf_size</a></div><div class="ttdeci">int inbuf_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00859">libbb.h:859</a></div></div>
<div class="ttc" id="alibbb_8h_html_a5b67932d25a41873f6841c48833c4778"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a5b67932d25a41873f6841c48833c4778">sha_end</a></div><div class="ttdeci">#define sha_end</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l02183">libbb.h:2183</a></div></div>
<div class="ttc" id="alibbb_8h_html_a65a9ae23f5b755bc8359625657a5efda"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a65a9ae23f5b755bc8359625657a5efda">tls_state::outbuf</a></div><div class="ttdeci">uint8_t * outbuf</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00856">libbb.h:856</a></div></div>
<div class="ttc" id="alibbb_8h_html_a6b9d12af476b8fa4b9de87028b0ac27c"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a6b9d12af476b8fa4b9de87028b0ac27c">xzalloc</a></div><div class="ttdeci">void * xzalloc(size_t size) FAST_FUNC RETURNS_MALLOC</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd6/xfuncs__printf_8c_source.html#l00069">xfuncs_printf.c:69</a></div></div>
<div class="ttc" id="alibbb_8h_html_a6d262c2876457dc50108802ded585abc"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a6d262c2876457dc50108802ded585abc">TLS_MAX_MAC_SIZE</a></div><div class="ttdeci">#define TLS_MAX_MAC_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00840">libbb.h:840</a></div></div>
<div class="ttc" id="alibbb_8h_html_a6ffb4d8440cea152d8cc2bdb2dd8d54b"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a6ffb4d8440cea152d8cc2bdb2dd8d54b">tls_state::min_encrypted_len_on_read</a></div><div class="ttdeci">unsigned min_encrypted_len_on_read</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00850">libbb.h:850</a></div></div>
<div class="ttc" id="alibbb_8h_html_a81d69881a03f3e32b71188d9c9835723"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a81d69881a03f3e32b71188d9c9835723">tls_state::aes_encrypt</a></div><div class="ttdeci">struct tls_aes aes_encrypt</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00886">libbb.h:888</a></div></div>
<div class="ttc" id="alibbb_8h_html_a88fa0c83bbd38b4af978843d8a48070e"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a88fa0c83bbd38b4af978843d8a48070e">tls_state::aes_decrypt</a></div><div class="ttdeci">struct tls_aes aes_decrypt</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00886">libbb.h:889</a></div></div>
<div class="ttc" id="alibbb_8h_html_a892a2d1e073add97dc0a329a2491c8a7"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a892a2d1e073add97dc0a329a2491c8a7">tls_state::client_write_key</a></div><div class="ttdeci">uint8_t * client_write_key</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00877">libbb.h:877</a></div></div>
<div class="ttc" id="alibbb_8h_html_a8a2e906eabcc782224d0052ccd982bac"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a8a2e906eabcc782224d0052ccd982bac">tls_state::server_write_IV</a></div><div class="ttdeci">uint8_t * server_write_IV</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00880">libbb.h:880</a></div></div>
<div class="ttc" id="alibbb_8h_html_a8c34aa7cb37e568a3c571396a1f7a819"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a8c34aa7cb37e568a3c571396a1f7a819">tls_state::write_seq64_be</a></div><div class="ttdeci">uint64_t write_seq64_be</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00874">libbb.h:874</a></div></div>
<div class="ttc" id="alibbb_8h_html_a8e61995c5e80de8de0758d4e3cd2d813"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a8e61995c5e80de8de0758d4e3cd2d813">tls_state::client_write_IV</a></div><div class="ttdeci">uint8_t * client_write_IV</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00879">libbb.h:879</a></div></div>
<div class="ttc" id="alibbb_8h_html_a908d5535f4c6167da1ac613b29f4b7e4"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a908d5535f4c6167da1ac613b29f4b7e4">bb_simple_perror_msg_and_die</a></div><div class="ttdeci">void bb_simple_perror_msg_and_die(const char *s) NORETURN FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d45/perror__msg_8c_source.html#l00037">perror_msg.c:37</a></div></div>
<div class="ttc" id="alibbb_8h_html_a94a607b4c69c9d6883ee67ee8d46aec4"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a94a607b4c69c9d6883ee67ee8d46aec4">xfunc_die</a></div><div class="ttdeci">void xfunc_die(void) NORETURN FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d42/xfunc__die_8c_source.html#l00016">xfunc_die.c:16</a></div></div>
<div class="ttc" id="alibbb_8h_html_a9acf0ed0d96489152914d089c778713a"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a9acf0ed0d96489152914d089c778713a">md5sha_hash</a></div><div class="ttdeci">#define md5sha_hash</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l02182">libbb.h:2182</a></div></div>
<div class="ttc" id="alibbb_8h_html_a9e5609718f2d1fe5ead7714b3d45223b"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a9e5609718f2d1fe5ead7714b3d45223b">FAST_FUNC</a></div><div class="ttdeci">void FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l01427">libbb.h:1427</a></div></div>
<div class="ttc" id="alibbb_8h_html_a9ea11289d0d3d9ed7c24e05d45641e89"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#a9ea11289d0d3d9ed7c24e05d45641e89">tls_state::H</a></div><div class="ttdeci">uint8_t H[16]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00890">libbb.h:890</a></div></div>
<div class="ttc" id="alibbb_8h_html_aa3e94e3ec137f40660b168c9f0840027"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#aa3e94e3ec137f40660b168c9f0840027">xopen</a></div><div class="ttdeci">int xopen(const char *pathname, int flags) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd6/xfuncs__printf_8c_source.html#l00155">xfuncs_printf.c:155</a></div></div>
<div class="ttc" id="alibbb_8h_html_aa7873f1b32526ae11612363558a2aa90"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#aa7873f1b32526ae11612363558a2aa90">bb_simple_error_msg_and_die</a></div><div class="ttdeci">void bb_simple_error_msg_and_die(const char *s) NORETURN FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/db5/verror__msg_8c_source.html#l00212">verror_msg.c:212</a></div></div>
<div class="ttc" id="alibbb_8h_html_aba4c17d55349c5804f6cedfb7aebe6d4"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#aba4c17d55349c5804f6cedfb7aebe6d4">tls_state::key_size</a></div><div class="ttdeci">unsigned key_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00853">libbb.h:853</a></div></div>
<div class="ttc" id="alibbb_8h_html_abc474d81aeba7a3eb57220e8a69c24c2"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#abc474d81aeba7a3eb57220e8a69c24c2">tls_state::hsd</a></div><div class="ttdeci">struct tls_handshake_data * hsd</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00864">libbb.h:864</a></div></div>
<div class="ttc" id="alibbb_8h_html_aca4af3524ef06062af2698c9250852df"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#aca4af3524ef06062af2698c9250852df">tls_state::IV_size</a></div><div class="ttdeci">unsigned IV_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00854">libbb.h:854</a></div></div>
<div class="ttc" id="alibbb_8h_html_ad069bd9aa4a41a4c95e408882a67ca1a"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#ad069bd9aa4a41a4c95e408882a67ca1a">tls_state::buffered_size</a></div><div class="ttdeci">int buffered_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00861">libbb.h:861</a></div></div>
<div class="ttc" id="alibbb_8h_html_ad3b9a4415e25d8fb7e9980347357dc95"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#ad3b9a4415e25d8fb7e9980347357dc95">bb_perror_msg_and_die</a></div><div class="ttdeci">void bb_perror_msg_and_die(const char *s,...) __attribute__((noreturn</div></div>
<div class="ttc" id="alibbb_8h_html_ad480de907b2c37655e34b8aa0ee3f158"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#ad480de907b2c37655e34b8aa0ee3f158">xmove_fd</a></div><div class="ttdeci">void xmove_fd(int, int) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd6/xfuncs__printf_8c_source.html#l00238">xfuncs_printf.c:238</a></div></div>
<div class="ttc" id="alibbb_8h_html_ad59d217eb0f8bd6b37a479f827a7b187"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#ad59d217eb0f8bd6b37a479f827a7b187">tls_state::inbuf</a></div><div class="ttdeci">uint8_t * inbuf</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00862">libbb.h:862</a></div></div>
<div class="ttc" id="alibbb_8h_html_ad72136bbc3cff66a5995570da1b17dd7"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#ad72136bbc3cff66a5995570da1b17dd7">TLSLOOP_EXIT_ON_LOCAL_EOF</a></div><div class="ttdeci">#define TLSLOOP_EXIT_ON_LOCAL_EOF</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00899">libbb.h:899</a></div></div>
<div class="ttc" id="alibbb_8h_html_ad7e1cf2847c357f97a6d0cb88baa7d94"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#ad7e1cf2847c357f97a6d0cb88baa7d94">tls_state::flags</a></div><div class="ttdeci">unsigned flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00845">libbb.h:845</a></div></div>
<div class="ttc" id="alibbb_8h_html_adb46d65124188e0a902aa1e0cb2f6b58"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#adb46d65124188e0a902aa1e0cb2f6b58">sha1_begin</a></div><div class="ttdeci">void sha1_begin(sha1_ctx_t *ctx) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d05/hash__md5__sha_8c_source.html#l01166">hash_md5_sha.c:1166</a></div></div>
<div class="ttc" id="alibbb_8h_html_adcd945f007cfde4259ee212d57e5a472"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#adcd945f007cfde4259ee212d57e5a472">tls_state::ofd</a></div><div class="ttdeci">int ofd</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00847">libbb.h:847</a></div></div>
<div class="ttc" id="alibbb_8h_html_aecf5d6000202e19c5831942dd4c87a87"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#aecf5d6000202e19c5831942dd4c87a87">bb_error_msg</a></div><div class="ttdeci">void bb_error_msg(const char *s,...) __attribute__((format(printf</div></div>
<div class="ttc" id="alibbb_8h_html_aee37d677b0719b1ffcefe1406c7c47f5"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#aee37d677b0719b1ffcefe1406c7c47f5">open_read_close</a></div><div class="ttdeci">ssize_t open_read_close(const char *filename, void *buf, size_t maxsz) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df8/apps_2base_2busybox_2libbb_2read_8c_source.html#l00074">read.c:74</a></div></div>
<div class="ttc" id="alibbb_8h_html_afd9749b5c9728a4e5d0f2c00663a89af"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#afd9749b5c9728a4e5d0f2c00663a89af">safe_read</a></div><div class="ttdeci">ssize_t safe_read(int fd, void *buf, size_t count) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df8/apps_2base_2busybox_2libbb_2read_8c_source.html#l00011">read.c:11</a></div></div>
<div class="ttc" id="alibbb_8h_html_afe523b6f7b92441d4dc28a330d46c245"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#afe523b6f7b92441d4dc28a330d46c245">bin2hex</a></div><div class="ttdeci">char * bin2hex(char *dst, const char *src, int count) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d6d/xfuncs_8c_source.html#l00132">xfuncs.c:132</a></div></div>
<div class="ttc" id="alibbb_8h_html_d1/d93/structtls__state"><div class="ttname"><a href="../../d7/dd7/libbb_8h.html#d1/d93/structtls__state">tls_state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l00844">libbb.h:844</a></div></div>
<div class="ttc" id="alibc_2include_2errno_8h_html_ab03f640d90fbc5bcb75285d08a0f25ed"><div class="ttname"><a href="../../d7/d8c/libc_2include_2errno_8h.html#ab03f640d90fbc5bcb75285d08a0f25ed">errno</a></div><div class="ttdeci">#define errno</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d8c/libc_2include_2errno_8h_source.html#l00135">errno.h:135</a></div></div>
<div class="ttc" id="alibc_2include_2inttypes_8h_html_a0a8582351ac627ee8bde2973c825e47f"><div class="ttname"><a href="../../d4/df0/libc_2include_2inttypes_8h.html#a0a8582351ac627ee8bde2973c825e47f">uint32_t</a></div><div class="ttdeci">__UINT32_TYPE__ uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df0/libc_2include_2inttypes_8h_source.html#l00010">inttypes.h:10</a></div></div>
<div class="ttc" id="alibc_2include_2inttypes_8h_html_a2095b9bffea4b2656950c6c0419edbf1"><div class="ttname"><a href="../../d4/df0/libc_2include_2inttypes_8h.html#a2095b9bffea4b2656950c6c0419edbf1">uint64_t</a></div><div class="ttdeci">__UINT64_TYPE__ uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df0/libc_2include_2inttypes_8h_source.html#l00011">inttypes.h:11</a></div></div>
<div class="ttc" id="alibc_2include_2inttypes_8h_html_a3cb4a16b0e8d6af0af86d4fd6ba5fd9d"><div class="ttname"><a href="../../d4/df0/libc_2include_2inttypes_8h.html#a3cb4a16b0e8d6af0af86d4fd6ba5fd9d">uint8_t</a></div><div class="ttdeci">__UINT8_TYPE__ uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df0/libc_2include_2inttypes_8h_source.html#l00008">inttypes.h:8</a></div></div>
<div class="ttc" id="alibc_2include_2stdarg_8h_html_a81ebe6ea6253b0c6618e29de70fe10eb"><div class="ttname"><a href="../../d1/dba/libc_2include_2stdarg_8h.html#a81ebe6ea6253b0c6618e29de70fe10eb">va_arg</a></div><div class="ttdeci">#define va_arg(ap, type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dba/libc_2include_2stdarg_8h_source.html#l00010">stdarg.h:10</a></div></div>
<div class="ttc" id="alibc_2include_2stdarg_8h_html_acd9b3b9085ec072324c5fdac2b40304e"><div class="ttname"><a href="../../d1/dba/libc_2include_2stdarg_8h.html#acd9b3b9085ec072324c5fdac2b40304e">va_end</a></div><div class="ttdeci">#define va_end(ap)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dba/libc_2include_2stdarg_8h_source.html#l00009">stdarg.h:9</a></div></div>
<div class="ttc" id="alibc_2include_2stdarg_8h_html_ade24ac546ea93fde2353ed2db8e89c66"><div class="ttname"><a href="../../d1/dba/libc_2include_2stdarg_8h.html#ade24ac546ea93fde2353ed2db8e89c66">va_start</a></div><div class="ttdeci">#define va_start(ap, last)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dba/libc_2include_2stdarg_8h_source.html#l00008">stdarg.h:8</a></div></div>
<div class="ttc" id="alibc_2include_2stdarg_8h_html_af53f622e3b6c080daeb167c1955d7ec1"><div class="ttname"><a href="../../d1/dba/libc_2include_2stdarg_8h.html#af53f622e3b6c080daeb167c1955d7ec1">va_list</a></div><div class="ttdeci">__builtin_va_list va_list</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dba/libc_2include_2stdarg_8h_source.html#l00005">stdarg.h:5</a></div></div>
<div class="ttc" id="alibc_2include_2stdio_8h_html_a5ce35bd5ba5021fd3b2e951e8f497656"><div class="ttname"><a href="../../dc/d4d/libc_2include_2stdio_8h.html#a5ce35bd5ba5021fd3b2e951e8f497656">stderr</a></div><div class="ttdeci">#define stderr</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d4d/libc_2include_2stdio_8h_source.html#l00058">stdio.h:58</a></div></div>
<div class="ttc" id="alibc_2include_2stdio_8h_html_ad9291335f34e874c8431285d705bc3aa"><div class="ttname"><a href="../../dc/d4d/libc_2include_2stdio_8h.html#ad9291335f34e874c8431285d705bc3aa">fprintf</a></div><div class="ttdeci">int fprintf(FILE *stream, const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/file_8c_source.html#l00097">file.c:97</a></div></div>
<div class="ttc" id="alibc_2include_2string_8h_html_a008e171a518fe0e0352f31b245e03875"><div class="ttname"><a href="../../dc/da4/libc_2include_2string_8h.html#a008e171a518fe0e0352f31b245e03875">strlen</a></div><div class="ttdeci">size_t strlen(const char *str)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db0/string_8c_source.html#l00005">string.c:5</a></div></div>
<div class="ttc" id="alibc_2include_2string_8h_html_a802c986820d3866639922b6bc9484f90"><div class="ttname"><a href="../../dc/da4/libc_2include_2string_8h.html#a802c986820d3866639922b6bc9484f90">memmove</a></div><div class="ttdeci">void * memmove(void *dest, const void *src, size_t n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de5/memop_8c_source.html#l00290">memop.c:290</a></div></div>
<div class="ttc" id="alzop_8c_html_a56dee7158d9de89b23535bf5ad318261"><div class="ttname"><a href="../../dc/d76/lzop_8c.html#a56dee7158d9de89b23535bf5ad318261">h</a></div><div class="ttdeci">#define h</div></div>
<div class="ttc" id="amempcpy_8c_html_a7ac7c0f43132e3acf013e0c71a58cdc9"><div class="ttname"><a href="../../d0/dfd/mempcpy_8c.html#a7ac7c0f43132e3acf013e0c71a58cdc9">mempcpy</a></div><div class="ttdeci">void * mempcpy(void *dest, const void *src, size_t n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfd/mempcpy_8c_source.html#l00004">mempcpy.c:4</a></div></div>
<div class="ttc" id="amusl_2arch_2aarch64_2bits_2fcntl_8h_html_a1cf6b1de1fffedaa1d26b189e9a8d2cc"><div class="ttname"><a href="../../d7/d86/musl_2arch_2aarch64_2bits_2fcntl_8h.html#a1cf6b1de1fffedaa1d26b189e9a8d2cc">O_CREAT</a></div><div class="ttdeci">#define O_CREAT</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d86/musl_2arch_2aarch64_2bits_2fcntl_8h_source.html#l00001">fcntl.h:1</a></div></div>
<div class="ttc" id="amusl_2arch_2aarch64_2bits_2fcntl_8h_html_ad1d67e453fb3031f40f8cd3403773813"><div class="ttname"><a href="../../d7/d86/musl_2arch_2aarch64_2bits_2fcntl_8h.html#ad1d67e453fb3031f40f8cd3403773813">O_TRUNC</a></div><div class="ttdeci">#define O_TRUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d86/musl_2arch_2aarch64_2bits_2fcntl_8h_source.html#l00004">fcntl.h:4</a></div></div>
<div class="ttc" id="amusl_2include_2fcntl_8h_html_a11b644a8526139c4cc1850dac1271ced"><div class="ttname"><a href="../../d2/d44/musl_2include_2fcntl_8h.html#a11b644a8526139c4cc1850dac1271ced">O_WRONLY</a></div><div class="ttdeci">#define O_WRONLY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d44/musl_2include_2fcntl_8h_source.html#l00045">fcntl.h:45</a></div></div>
<div class="ttc" id="amusl_2include_2stdlib_8h_html_aa7cb61cef6d19542fccc5cabf47f96eb"><div class="ttname"><a href="../../d4/daf/musl_2include_2stdlib_8h.html#aa7cb61cef6d19542fccc5cabf47f96eb">srand</a></div><div class="ttdeci">void srand(unsigned)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df4/rand_8c_source.html#l00006">rand.c:6</a></div></div>
<div class="ttc" id="amusl_2include_2stdlib_8h_html_ae23144bcbb8e3742b00eb687c36654d1"><div class="ttname"><a href="../../d4/daf/musl_2include_2stdlib_8h.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a></div><div class="ttdeci">int rand(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df4/rand_8c_source.html#l00011">rand.c:11</a></div></div>
<div class="ttc" id="amusl_2include_2string_8h_html_a0849c52baadd8269575bc57e2273d862"><div class="ttname"><a href="../../d6/d32/musl_2include_2string_8h.html#a0849c52baadd8269575bc57e2273d862">memcmp</a></div><div class="ttdeci">int memcmp(const void *, const void *, size_t)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d21/memcmp_8c_source.html#l00003">memcmp.c:3</a></div></div>
<div class="ttc" id="amusl_2include_2time_8h_html_aae026724f73c36340024c657f4f44dab"><div class="ttname"><a href="../../d4/d02/musl_2include_2time_8h.html#aae026724f73c36340024c657f4f44dab">time</a></div><div class="ttdeci">time_t time(time_t *)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de6/musl_2src_2time_2time_8c_source.html#l00004">time.c:4</a></div></div>
<div class="ttc" id="amusl_2include_2unistd_8h_html_abd165ee6474b5b75bf075842fff13a04"><div class="ttname"><a href="../../de/d97/musl_2include_2unistd_8h.html#abd165ee6474b5b75bf075842fff13a04">STDOUT_FILENO</a></div><div class="ttdeci">#define STDOUT_FILENO</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d97/musl_2include_2unistd_8h_source.html#l00011">unistd.h:11</a></div></div>
<div class="ttc" id="amusl_2src_2malloc_2mallocng_2malloc_8c_html_aaabfc6451d990d9a5312948a8f4d8473"><div class="ttname"><a href="../../d1/ddc/musl_2src_2malloc_2mallocng_2malloc_8c.html#aaabfc6451d990d9a5312948a8f4d8473">ctx</a></div><div class="ttdeci">struct malloc_context ctx</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/ddc/musl_2src_2malloc_2mallocng_2malloc_8c_source.html#l00038">malloc.c:40</a></div></div>
<div class="ttc" id="anmeter_8c_html_a9f42c0960c4e20484468e09947a3f876"><div class="ttname"><a href="../../d4/dcd/nmeter_8c.html#a9f42c0960c4e20484468e09947a3f876">outbuf</a></div><div class="ttdeci">#define outbuf</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dcd/nmeter_8c_source.html#l00114">nmeter.c:114</a></div></div>
<div class="ttc" id="aplatform_8h_html_a3154d0c2e8d9f1dd3410e9408cad21a2"><div class="ttname"><a href="../../de/d03/platform_8h.html#a3154d0c2e8d9f1dd3410e9408cad21a2">SWAP_LE32</a></div><div class="ttdeci">#define SWAP_LE32(x)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d03/platform_8h_source.html#l00217">platform.h:217</a></div></div>
<div class="ttc" id="aplatform_8h_html_a5b27ff781e21e412705167a70f5cc47a"><div class="ttname"><a href="../../de/d03/platform_8h.html#a5b27ff781e21e412705167a70f5cc47a">move_from_unaligned32</a></div><div class="ttdeci">#define move_from_unaligned32(v, u32p)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d03/platform_8h_source.html#l00253">platform.h:253</a></div></div>
<div class="ttc" id="aplatform_8h_html_a903630c9a9341ff79b33bcdf3f133fb4"><div class="ttname"><a href="../../de/d03/platform_8h.html#a903630c9a9341ff79b33bcdf3f133fb4">move_to_unaligned64</a></div><div class="ttdeci">#define move_to_unaligned64(u64p, v)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d03/platform_8h_source.html#l00263">platform.h:263</a></div></div>
<div class="ttc" id="aplatform_8h_html_aa1dec568e79152c892dcf63f445cbd7a"><div class="ttname"><a href="../../de/d03/platform_8h.html#aa1dec568e79152c892dcf63f445cbd7a">ALWAYS_INLINE</a></div><div class="ttdeci">#define ALWAYS_INLINE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d03/platform_8h_source.html#l00084">platform.h:84</a></div></div>
<div class="ttc" id="aplatform_8h_html_ab25ec83fd461ee2a3c98f6abdfad0e23"><div class="ttname"><a href="../../de/d03/platform_8h.html#ab25ec83fd461ee2a3c98f6abdfad0e23">SWAP_BE64</a></div><div class="ttdeci">#define SWAP_BE64(x)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d03/platform_8h_source.html#l00215">platform.h:215</a></div></div>
<div class="ttc" id="apowertop_8c_html_d4/d85/structline"><div class="ttname"><a href="../../dd/d7b/powertop_8c.html#d4/d85/structline">line</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dff/diff_8c_source.html#l00351">diff.c:351</a></div></div>
<div class="ttc" id="asetxid_8c_html_d5/d06/structctx"><div class="ttname"><a href="../../d0/dd6/setxid_8c.html#d5/d06/structctx">ctx</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/ddf/setgroups_8c_source.html#l00007">setgroups.c:7</a></div></div>
<div class="ttc" id="asm__loop_8c_html_a45a537235d3d9968fa1c984289b3c3c6"><div class="ttname"><a href="../../db/dd4/sm__loop_8c.html#a45a537235d3d9968fa1c984289b3c3c6">if</a></div><div class="ttdeci">if(return(GMATCH(string==0||pattern==0)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd4/sm__loop_8c_source.html#l00046">sm_loop.c:46</a></div></div>
<div class="ttc" id="asm__loop_8c_html_ac27eda88ff3c79f2d9f14fb5c682c418"><div class="ttname"><a href="../../db/dd4/sm__loop_8c.html#ac27eda88ff3c79f2d9f14fb5c682c418">vp</a></div><div class="ttdeci">INT * vp</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd4/sm__loop_8c_source.html#l00384">sm_loop.c:384</a></div></div>
<div class="ttc" id="astructmd5__ctx__t_html"><div class="ttname"><a href="../../d3/dd3/structmd5__ctx__t.html">md5_ctx_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd7/libbb_8h_source.html#l02147">libbb.h:2147</a></div></div>
<div class="ttc" id="atermcap_8c_html_dd/da2/structbuffer"><div class="ttname"><a href="../../d6/dc6/termcap_8c.html#dd/da2/structbuffer">buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dc6/termcap_8c_source.html#l00384">termcap.c:385</a></div></div>
<div class="ttc" id="atls_8h_html"><div class="ttname"><a href="../../df/d79/tls_8h.html">tls.h</a></div></div>
<div class="ttc" id="atls_8h_html_a0442fa1d28f0e7d3826cbc26d708ce82"><div class="ttname"><a href="../../df/d79/tls_8h.html#a0442fa1d28f0e7d3826cbc26d708ce82">curve_P256_compute_pubkey_and_premaster</a></div><div class="ttdeci">void curve_P256_compute_pubkey_and_premaster(uint8_t *pubkey2x32, uint8_t *premaster32, const uint8_t *peerkey2x32) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da8/tls__sp__c32_8c_source.html#l01484">tls_sp_c32.c:1484</a></div></div>
<div class="ttc" id="atls_8h_html_a0aa20d80319c3f9cedbac904317ea6e1"><div class="ttname"><a href="../../df/d79/tls_8h.html#a0aa20d80319c3f9cedbac904317ea6e1">EC_CURVE_KEYSIZE</a></div><div class="ttdeci">#define EC_CURVE_KEYSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00108">tls.h:108</a></div></div>
<div class="ttc" id="atls_8h_html_a425a184a16fed72c4bfd80c8798126ef"><div class="ttname"><a href="../../df/d79/tls_8h.html#a425a184a16fed72c4bfd80c8798126ef">P256_KEYSIZE</a></div><div class="ttdeci">#define P256_KEYSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00109">tls.h:109</a></div></div>
<div class="ttc" id="atls_8h_html_a5856547b4cfd5097964fa1507bf76536"><div class="ttname"><a href="../../df/d79/tls_8h.html#a5856547b4cfd5097964fa1507bf76536">curve_P256_compute_pubkey_and_premaster_NEW</a></div><div class="ttdeci">void curve_P256_compute_pubkey_and_premaster_NEW(uint8_t *pubkey2x32, uint8_t *premaster32, const uint8_t *peerkey2x32) FAST_FUNC</div></div>
<div class="ttc" id="atls_8h_html_a7274bb2f15a34d9c5f7216af7096b796"><div class="ttname"><a href="../../df/d79/tls_8h.html#a7274bb2f15a34d9c5f7216af7096b796">CURVE25519_KEYSIZE</a></div><div class="ttdeci">#define CURVE25519_KEYSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00110">tls.h:110</a></div></div>
<div class="ttc" id="atls_8h_html_aaec8c82c4cf6763030d4e6d0c96dd4fe"><div class="ttname"><a href="../../df/d79/tls_8h.html#aaec8c82c4cf6763030d4e6d0c96dd4fe">ALIGNED_long</a></div><div class="ttdeci">#define ALIGNED_long</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00087">tls.h:87</a></div></div>
<div class="ttc" id="atls_8h_html_af0e5dd181602edd30facec8f29da9deb"><div class="ttname"><a href="../../df/d79/tls_8h.html#af0e5dd181602edd30facec8f29da9deb">curve_x25519_compute_pubkey_and_premaster</a></div><div class="ttdeci">void curve_x25519_compute_pubkey_and_premaster(uint8_t *pubkey32, uint8_t *premaster32, const uint8_t *peerkey32) FAST_FUNC</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d11/tls__fe_8c_source.html#l00612">tls_fe.c:612</a></div></div>
<div class="ttc" id="atls_8h_html_af19ab913a847ad1e91c5291215116de1"><div class="ttname"><a href="../../df/d79/tls_8h.html#af19ab913a847ad1e91c5291215116de1">AES_BLOCK_SIZE</a></div><div class="ttdeci">#define AES_BLOCK_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d79/tls_8h_source.html#l00081">tls.h:81</a></div></div>
<div class="ttc" id="atls__aes_8c_html_a34a82569675a176e57996083ad34608f"><div class="ttname"><a href="../../da/d19/tls__aes_8c.html#a34a82569675a176e57996083ad34608f">aes_cbc_encrypt</a></div><div class="ttdeci">void FAST_FUNC aes_cbc_encrypt(struct tls_aes *aes, void *iv, const void *data, size_t len, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d19/tls__aes_8c_source.html#l00366">tls_aes.c:366</a></div></div>
<div class="ttc" id="atls__aes_8c_html_a7adc23b56bee623cd7a5414445e83000"><div class="ttname"><a href="../../da/d19/tls__aes_8c.html#a7adc23b56bee623cd7a5414445e83000">aes_encrypt_one_block</a></div><div class="ttdeci">void FAST_FUNC aes_encrypt_one_block(struct tls_aes *aes, const void *data, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d19/tls__aes_8c_source.html#l00351">tls_aes.c:351</a></div></div>
<div class="ttc" id="atls__aes_8c_html_ab0532a9a23c65027d3415dc787039111"><div class="ttname"><a href="../../da/d19/tls__aes_8c.html#ab0532a9a23c65027d3415dc787039111">aes_setkey</a></div><div class="ttdeci">void FAST_FUNC aes_setkey(struct tls_aes *aes, const void *key, unsigned key_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d19/tls__aes_8c_source.html#l00346">tls_aes.c:346</a></div></div>
<div class="ttc" id="atls__aes_8c_html_ada549d14f782d402febbb2c5a5099afa"><div class="ttname"><a href="../../da/d19/tls__aes_8c.html#ada549d14f782d402febbb2c5a5099afa">aes_cbc_decrypt</a></div><div class="ttdeci">void FAST_FUNC aes_cbc_decrypt(struct tls_aes *aes, void *iv, const void *data, size_t len, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d19/tls__aes_8c_source.html#l00431">tls_aes.c:431</a></div></div>
<div class="ttc" id="atls__aesgcm_8c_html_ab44e9d0fcf31a177ee3a1d782dc2d386"><div class="ttname"><a href="../../d5/dd2/tls__aesgcm_8c.html#ab44e9d0fcf31a177ee3a1d782dc2d386">aesgcm_GHASH</a></div><div class="ttdeci">void FAST_FUNC aesgcm_GHASH(byte *h, const byte *a, const byte *c, unsigned cSz, byte *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd2/tls__aesgcm_8c_source.html#l00134">tls_aesgcm.c:134</a></div></div>
<div class="ttc" id="atls__pstm_8c_html_a19b8a04f00f931070fd700037d4f6017"><div class="ttname"><a href="../../d2/db1/tls__pstm_8c.html#a19b8a04f00f931070fd700037d4f6017">pstm_read_unsigned_bin</a></div><div class="ttdeci">int32 FAST_FUNC pstm_read_unsigned_bin(pstm_int *a, unsigned char *b, int32 c)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db1/tls__pstm_8c_source.html#l00406">tls_pstm.c:406</a></div></div>
<div class="ttc" id="atls__pstm_8c_html_aa9328c5801bb852e3fd2170bb33598e6"><div class="ttname"><a href="../../d2/db1/tls__pstm_8c.html#aa9328c5801bb852e3fd2170bb33598e6">pstm_unsigned_bin_size</a></div><div class="ttdeci">int32 FAST_FUNC pstm_unsigned_bin_size(pstm_int *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db1/tls__pstm_8c_source.html#l00503">tls_pstm.c:503</a></div></div>
<div class="ttc" id="atls__pstm_8h_html_a361367bd256cf6bb7e1b0ce3c359eb2f"><div class="ttname"><a href="../../d4/de5/tls__pstm_8h.html#a361367bd256cf6bb7e1b0ce3c359eb2f">pstm_init_for_read_unsigned_bin</a></div><div class="ttdeci">#define pstm_init_for_read_unsigned_bin(pool, a, len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/de5/tls__pstm_8h_source.html#l00162">tls_pstm.h:162</a></div></div>
<div class="ttc" id="atls__pstm_8h_html_db/d47/structpstm__int"><div class="ttname"><a href="../../d4/de5/tls__pstm_8h.html#db/d47/structpstm__int">pstm_int</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/de5/tls__pstm_8h_source.html#l00124">tls_pstm.h:124</a></div></div>
<div class="ttc" id="atls__rsa_8h_html_a142358ea657b08ae6cf5525bb092f12c"><div class="ttname"><a href="../../d4/df3/tls__rsa_8h.html#a142358ea657b08ae6cf5525bb092f12c">psRsaKey_t::e</a></div><div class="ttdeci">pstm_int e</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df3/tls__rsa_8h_source.html#l00010">tls_rsa.h:10</a></div></div>
<div class="ttc" id="atls__rsa_8h_html_a307028cfdbae5ee7a1b91c56070cd78c"><div class="ttname"><a href="../../d4/df3/tls__rsa_8h.html#a307028cfdbae5ee7a1b91c56070cd78c">psRsaKey_clear</a></div><div class="ttdeci">static ALWAYS_INLINE void psRsaKey_clear(psRsaKey_t *key)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df3/tls__rsa_8h_source.html#l00016">tls_rsa.h:16</a></div></div>
<div class="ttc" id="atls__rsa_8h_html_a5a8e275c70c5b22d5b5b88c6997950cf"><div class="ttname"><a href="../../d4/df3/tls__rsa_8h.html#a5a8e275c70c5b22d5b5b88c6997950cf">psRsaEncryptPub</a></div><div class="ttdeci">#define psRsaEncryptPub(pool, key, in, inlen, out, outlen, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df3/tls__rsa_8h_source.html#l00028">tls_rsa.h:28</a></div></div>
<div class="ttc" id="atls__rsa_8h_html_a8f2f8a55979096b94b0a7658a756c484"><div class="ttname"><a href="../../d4/df3/tls__rsa_8h.html#a8f2f8a55979096b94b0a7658a756c484">psRsaKey_t::size</a></div><div class="ttdeci">uint32 size</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df3/tls__rsa_8h_source.html#l00011">tls_rsa.h:11</a></div></div>
<div class="ttc" id="atls__rsa_8h_html_aed5d7d3cfb979efaa3c34f6bf311cee8"><div class="ttname"><a href="../../d4/df3/tls__rsa_8h.html#aed5d7d3cfb979efaa3c34f6bf311cee8">psRsaKey_t::N</a></div><div class="ttdeci">pstm_int N</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df3/tls__rsa_8h_source.html#l00010">tls_rsa.h:10</a></div></div>
<div class="ttc" id="atls__rsa_8h_html_d2/d73/structpsRsaKey__t"><div class="ttname"><a href="../../d4/df3/tls__rsa_8h.html#d2/d73/structpsRsaKey__t">psRsaKey_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df3/tls__rsa_8h_source.html#l00009">tls_rsa.h:9</a></div></div>
<div class="ttc" id="atre_8h_html_a40740062faf2d95d4935112447c464ef"><div class="ttname"><a href="../../db/d0a/tre_8h.html#a40740062faf2d95d4935112447c464ef">xrealloc</a></div><div class="ttdeci">#define xrealloc</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d0a/tre_8h_source.html#l00230">tre.h:230</a></div></div>
<div class="ttc" id="avfprintf_8c_html_ad834e8db1d9c585ad9e072f5256c24b2"><div class="ttname"><a href="../../d3/d61/vfprintf_8c.html#ad834e8db1d9c585ad9e072f5256c24b2">out</a></div><div class="ttdeci">static void out(FILE *f, const char *s, size_t l)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d61/vfprintf_8c_source.html#l00133">vfprintf.c:133</a></div></div>
<div class="ttc" id="avi_8c_html_a1144b296168b3bd3f9c04d75f4d5b94c"><div class="ttname"><a href="../../d4/d49/vi_8c.html#a1144b296168b3bd3f9c04d75f4d5b94c">text</a></div><div class="ttdeci">#define text</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d49/vi_8c_source.html#l00468">vi.c:468</a></div></div>
<div class="ttc" id="avi_8c_html_a176a37bacb55f480893e743ae5bb55db"><div class="ttname"><a href="../../d4/d49/vi_8c.html#a176a37bacb55f480893e743ae5bb55db">text_size</a></div><div class="ttdeci">#define text_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d49/vi_8c_source.html#l00469">vi.c:469</a></div></div>
<div class="ttc" id="avi_8c_html_a2fb839951208a8400aa14d71d7c6f974"><div class="ttname"><a href="../../d4/d49/vi_8c.html#a2fb839951208a8400aa14d71d7c6f974">end</a></div><div class="ttdeci">#define end</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d49/vi_8c_source.html#l00470">vi.c:470</a></div></div>
<div class="ttc" id="awi__stuff_8c_html_a12a98bf5e50456cf27fc53cea0e1898f"><div class="ttname"><a href="../../d6/d23/wi__stuff_8c.html#a12a98bf5e50456cf27fc53cea0e1898f">finished</a></div><div class="ttdeci">static patch_t * finished</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d23/wi__stuff_8c_source.html#l00357">wi_stuff.c:357</a></div></div>
<div class="ttc" id="awi__stuff_8c_html_a6fd173f304efa919e66bbe8a265da9e8"><div class="ttname"><a href="../../d6/d23/wi__stuff_8c.html#a6fd173f304efa919e66bbe8a265da9e8">secret</a></div><div class="ttdeci">static patch_t * secret</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d23/wi__stuff_8c_source.html#l00367">wi_stuff.c:367</a></div></div>
<div class="ttc" id="awi__stuff_8c_html_a9cfbb269728dc4185236d28be58d9eab"><div class="ttname"><a href="../../d6/d23/wi__stuff_8c.html#a9cfbb269728dc4185236d28be58d9eab">cnt</a></div><div class="ttdeci">static int cnt</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d23/wi__stuff_8c_source.html#l00317">wi_stuff.c:317</a></div></div>
<div class="ttc" id="axatonum_8c_html_a53155e22eaa05190346890241be3367c"><div class="ttname"><a href="../../d1/d80/xatonum_8c.html#a53155e22eaa05190346890241be3367c">type</a></div><div class="ttdeci">#define type</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/xatonum_8c_source.html#l00011">xatonum.c:11</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_97d86ce2f18c7710ea326fa47777d7d7.html">Userspace</a></li><li class="navelem"><a class="el" href="../../dir_0276b9b7d706caf6f8b101518c949f15.html">apps</a></li><li class="navelem"><a class="el" href="../../dir_825a5fc57f8484006531699dcb39fa0d.html">base</a></li><li class="navelem"><a class="el" href="../../dir_87e330aa425985c7f88c27f5b355b004.html">busybox</a></li><li class="navelem"><a class="el" href="../../dir_e8fbedeaf6f588ea7cb6456e98eed78d.html">networking</a></li><li class="navelem"><a class="el" href="../../d3/d47/apps_2base_2busybox_2networking_2tls_8c.html">tls.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
