<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fennix Userspace: Shellmath</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fennix Userspace
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Fennix Userspace Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dc/d96/md_Userspace_apps_base_bash_examples_shellmath_README.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Shellmath </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Introducing decimal arithmetic libraries for the Bash shell, because they said it couldn't be done... and because:</p>
<p><img src="../.././image.png" alt="image info" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Quick-start guide</h1>
<p>Download this project and source the file <code>shellmath.sh</code> into your shell script, then fire away at the shellmath API!</p>
<p>The ___basic___ API looks like this: </p><div class="fragment"><div class="line">_shellmath_add        arg1   arg2  [...]  argN</div>
<div class="line">_shellmath_subtract   arg1   arg2               # means arg1 - arg2</div>
<div class="line">_shellmath_multiply   arg1   arg2  [...]  argN</div>
<div class="line">_shellmath_divide     arg1   arg2               # means arg1 / arg2</div>
</div><!-- fragment --><p>The ___extended___ API introduces one more function: </p><div class="fragment"><div class="line">_shellmath_getReturnValue   arg</div>
</div><!-- fragment --><p>This function optimizes away the need for ___$(___ subshelling ___)___ in order to capture <code>shellmath</code>'s output. To use this feature, just be sure to set <code>__shellmath_isOptimized=1</code> at the top of your script. (You can find an example in <code>faster_e_demo.sh</code>.)</p>
<p>Operands to the <em>shellmath</em> functions can be integers or decimal numbers presented in either standard or scientific notation: </p><div class="fragment"><div class="line">_shellmath_add   1.009   4.223e-2</div>
<div class="line">_shellmath_getReturnValue   sum</div>
<div class="line">echo &quot;The sum is $sum&quot;</div>
</div><!-- fragment --><p> Addition and multiplication are of arbitrary arity; try this on for size: </p><div class="fragment"><div class="line">_shellmath_multiply  1  2  3  4  5  6</div>
<div class="line">_shellmath_getReturnValue   sixFactorial</div>
<div class="line">echo &quot;6 factorial is $sixFactorial&quot;</div>
</div><!-- fragment --><p> Subtraction and division, OTOH, are exclusively binary operations.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
The demos</h1>
<p>For a gentle introduction to <code>shellmath</code> run the demo <code>slower_e_demo.sh</code> with a small whole-number argument, say 15: </p><div class="fragment"><div class="line">$ slower_e_demo.sh 15</div>
<div class="line">e = 2.7182818284589936</div>
</div><!-- fragment --><p>This script uses a few <code>shellmath</code> API calls to calculate <em>e</em>, the mathematical constant also known as <a href="https://oeis.org/A001113">Euler's number</a>. The argument <em>15</em> tells the script to evaluate the <em>15th-degree</em> Maclaurin polynomial for <em>e</em>. (That's the Taylor polynomial centered at 0.) Take a look inside the script to see how it uses the <code>shellmath</code> APIs.</p>
<p>There is another demo script very much like this one but <em>different</em>, and the sensitive user can <em>feel</em> the difference. Try the following, but don't blink or you'll miss it ;) </p><div class="fragment"><div class="line">$ faster_e_demo.sh 15</div>
<div class="line">e = 2.7182818284589936</div>
</div><!-- fragment --><p>Did you feel the difference? Try the <code>-t</code> option with both scripts; this will produce timing statistics. Here are my results when running from my minGW64 command prompt on Windows 10 with an Intel i3 Core CPU: </p><div class="fragment"><div class="line">$ for n in {1..5}; do faster_e_demo.sh -t 15 2&gt;&amp;1; done | awk &#39;/^real/ {print $2}&#39;</div>
<div class="line">0m0.055s</div>
<div class="line">0m0.051s</div>
<div class="line">0m0.056s</div>
<div class="line">0m0.054s</div>
<div class="line">0m0.054s</div>
<div class="line"> </div>
<div class="line">$ for n in {1..5}; do slower_e_demo.sh -t 15 2&gt;&amp;1; done | awk &#39;/^real/ {print $2}&#39;</div>
<div class="line">0m0.498s</div>
<div class="line">0m0.594s</div>
<div class="line">0m0.536s</div>
<div class="line">0m0.511s</div>
<div class="line">0m0.580s</div>
</div><!-- fragment --><p>(When sizing up these timings, do keep in mind that ___we are timing the calculation of e from its Maclaurin polynomial. Every invocation of either script is exercising the shellmath arithmetic subroutines 31 times.___)</p>
<p>The comment header in <code>faster_e_demo.sh</code> explains the optimization and shows how to put this faster version to work for you.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Runtime efficiency competitive with awk and bc</h1>
<p>The file <code>timingData.txt</code> captures the results of some timing experiments that compare <code>shellmath</code> against the GNU versions of the calculators <code>awk</code> and <code>bc</code>. The experiments exercised each of the arithmetic operations and captured the results in a shell variable. The result summary below shows that <code>shellmath</code> is competitive with <code>awk</code> and runs faster than <code>bc</code> in these experiments. (One commenter noted that the differences in execution speed can be partially explained by the fact that <code>shellmath</code> and <code>awk</code> use finite precision whereas <code>bc</code> uses arbitrary precision. Another factor in these measurements is the need to subshell 'awk' and 'bc' to capture their results, whereas 'shellmath' writes directly to the shell's global memory.)</p>
<p>Here are the run times of <code>shellmath</code> as a percentage of the <code>awk</code> and <code>bc</code> equivalents: </p><div class="fragment"><div class="line">                 versus awk    versus bc</div>
<div class="line">Addition:          82.2%         40.6%</div>
<div class="line">Subtraction:       95.9%         50.5%</div>
<div class="line">Multiplication:   135.9%         73.3%</div>
<div class="line">Division:          80.3%         43.2%</div>
</div><!-- fragment --><p>Astute observers will note the experiments provide approximations to the sum, difference, product, and quotient of <em>pi</em> and <em>e</em>. Unfortunately I did not gain insight as to which of these values, if any, are <a href="https://en.wikipedia.org/wiki/Transcendental_number#Possible_transcendental_numbers">transcendental</a>.</p>
<p>You can find a deeper discussion of shellmath's runtime efficiency <a href="https://github.com/clarity20/shellmath/wiki/Shellmath-and-runtime-efficiency">here</a>.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Background</h1>
<p>The Bash shell does not have built-in operators for decimal arithmetic, making it something of an oddity among well-known, widely-used programming languages. For the most part, practitioners in need of powerful computational building blocks have naturally opted for <em>other</em> languages and tools. Their widespread availability has diverted attention from the possibility of <em>implementing</em> decimal arithmetic in Bash and it's easy to assume that this <em><b>cannot</b></em> be done:</p>
<ul>
<li>From the indispensable <em>Bash FAQ</em> (on <em>Greg's Wiki</em>): <a href="http://mywiki.wooledge.org/BashFAQ/022">How can I calculate with floating point numbers?</a> <br  />
 *"For most operations... an external program must be used."*</li>
<li>From Mendel Cooper's wonderful and encyclopedic <em>Advanced Bash Scripting Guide</em>: <br  />
 <a href="https://tldp.org/LDP/abs/html/ops.html#NOFLOATINGPOINT">Bash does not understand floating point arithmetic. Use bc instead.</a></li>
<li>From a community discussion on Stack Overflow, <em>How do I use floating point division in bash?</em> <br  />
 The user's <a href="https://stackoverflow.com/questions/12722095/how-do-i-use-floating-point-division-in-bash#12722107">preferred answer</a> is a good example of <em>prevailing thought</em> on this subject.</li>
</ul>
<p>Meanwhile,</p>
<ul>
<li>Bash maintainer (BDFL?) Chet Ramey sounds a (brighter?) note in <a href="https://tiswww.case.edu/php/chet/bash/bashref.html#Shell-Arithmetic">The Bash Reference Guide, Section 6.5</a> by emphasizing what the built-in arithmetic operators <em><b>can</b></em> do.</li>
</ul>
<p>But finally, a glimmer of hope:</p>
<ul>
<li>A <a href="http://stackoverflow.com/a/24431665/3776858">diamond-in-the-rough</a> buried elsewhere on Stack Overflow. <br  />
 This down-and-dirty milestone computes the decimal quotient of two integer arguments. At a casual glance, it seems to have drawn inspiration from the <a href="https://mathworld.wolfram.com/EuclideanAlgorithm.html">Euclidean algorithm</a> for computing GCDs, an entirely different approach than <code>shellmath</code>'s.</li>
</ul>
<p>Please try <code>shellmath</code> on for size and draw your own conclusions!</p>
<h1><a class="anchor" id="autotoc_md5"></a>
How it works</h1>
<p><code>shellmath</code> splits decimal numbers into their integer and fractional parts, performs the appropriate integer operations on the parts, and recombines the results. (In the spirit of Bash, numerical overflow is silently ignored.)</p>
<p>Because if we can get carrying, borrowing, place value, and the distributive law right, then the sky's the limit! As they say&ndash;erm, as they ___said___ in Rome, </p><pre class="fragment">    Ad astra per aspera.
</pre> <h1><a class="anchor" id="autotoc_md6"></a>
And now...</h1>
<p>You can run your floating-point calculations directly in Bash!</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Please see also:</h1>
<p><a href="https://github.com/clarity20/shellmath/wiki/Shellmath-and-arbitrary-precision-arithmetic">A short discussion on arbitrary precision and shellmath</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
